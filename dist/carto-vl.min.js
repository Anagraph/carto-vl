/*!
 * CARTO VL js https://carto.com/
 * Version: 0.2.0
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carto=t():e.carto=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=37)}([function(e,t,r){"use strict";var i=r(1),a=r(2),n=r(7);let s=0;t.a=class{constructor(e){this.childrenNames=Object.keys(e),Object.keys(e).map(t=>this[t]=Object(i.l)(e[t])),this._getChildren().map(e=>e.parent=this),this._metaBindings=[],this.preface="",this._shaderBindings=new Map,this._uid=s++}_bind(e){return this._metaBindings.push(e),this._compile(e),this}_prefaceCode(e){return`\n        #ifndef DEF_${this._uid}\n        #define DEF_${this._uid}\n        ${e}\n        #endif\n        `}_getDependencies(){return this._getChildren().map(e=>e._getDependencies()).reduce((e,t)=>e.concat(t),[])}_resolveAliases(e){this._getChildren().map(t=>t._resolveAliases(e))}_updateDrawMetadata(e){this._getChildren().map(t=>t._updateDrawMetadata(e))}_compile(e){this._getChildren().map(t=>t._compile(e))}_setGenericGLSL(e,t){this.inlineMaker=e,this.preface=t||""}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};return t.map((e,t)=>r[this.childrenNames[t]]=e.inline),{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+this.preface),inline:this.inlineMaker(r,e)}}_postShaderCompile(e,t){this.childrenNames.forEach(r=>this[r]._postShaderCompile(e,t))}_getBinding(e){return this._shaderBindings.has(e)||this._shaderBindings.set(e,{}),this._shaderBindings.get(e)}_getDrawMetadataRequirements(){return this._getChildren().map(e=>e._getDrawMetadataRequirements()).reduce(n.union,n.IDENTITY)}_setTimestamp(e){this.childrenNames.forEach(t=>this[t]._setTimestamp(e))}_preDraw(...e){this.childrenNames.forEach(t=>this[t]._preDraw(...e))}isAnimated(){return this._getChildren().some(e=>e.isAnimated())}replaceChild(e,t){this[this.childrenNames.find(t=>this[t]==e)]=t,t.parent=this,t.notify=e.notify}notify(){this.parent.notify()}blendTo(e,t=500){e=Object(i.l)(e);const r=this.parent,n=Object(a.blend)(this,e,Object(a.animate)(t));return this._metaBindings.map(e=>n._bind(e)),r.replaceChild(this,n),n.notify(),e}blendFrom(e,t=500,r=null){e=Object(i.l)(e);const n=this.parent,s=Object(a.blend)(e,this,Object(a.animate)(t),r);this._metaBindings.map(e=>s._bind(e)),n.replaceChild(this,s),s.notify()}_getChildren(){return this.childrenNames.map(e=>this[e])}_getMinimumNeededSchema(){return this._getChildren().map(e=>e._getMinimumNeededSchema()).reduce(n.union,n.IDENTITY)}eval(e){throw new Error("Unimplemented")}}},function(e,t,r){"use strict";t.l=function(e){if(Number.isFinite(e))return Object(i.float)(e);if("string"==typeof e)return Object(i.category)(e);if(Array.isArray(e))return Object(i.customPalette)(...e);return e},t.k=function(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1};if(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e))return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:1};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)/255};throw new Error("Invalid hexadecimal color")},t.i=n,t.j=s,t.d=function(e,t,r,i,a){o(e,t,r,a),void 0!==a.type&&c(e,t,r,i,a)},t.b=o,t.g=c,t.c=function(e,t,r,i,a){o(e,t,r,a),a instanceof i||function(e,t,r,i,a){throw new Error(`${s(e,t,r)}\n    '${a}' is not an instance of '${i.name}'`)}(e,t,r,i,a.type)},t.e=function(e,t,r,i){Number.isFinite(i)||function(e,t,r,i){throw new Error(`${s(e,t,r)}\n    '${i}' is not a finite number`)}(e,t,r,i)},t.f=function(e,t,r,i){"string"!=typeof i&&function(e,t,r,i){throw new Error(`${s(e,t,r)}\n    '${i}' is not a string`)}(e,t,r,i)},t.h=function(e,t,r){return Math.min(Math.max(e,t),r)},t.m=function(e,t,r){return e*(1-r)+t*r};var i=r(2),a=r(0);function n(e){return{1:"first",2:"second",3:"third",4:"fourth"}[e]||String(e)}function s(e,t,r){return`${e}(): invalid ${n(r+1)} parameter '${t}'`}function o(e,t,r,i){if(!(i instanceof a.a))throw new Error(`${s(e,t,r)}\n        '${i}' is not of type Expression`)}function c(e,t,r,i,a){if(o(e,t,r,a),Array.isArray(i)){if(!i.some(e=>a.type==e))throw new Error(`${s(e,t,r)}\n            expected type was one of ${i.join()}, actual type was '${a.type}'`)}else a.type!=i&&function(e,t,r,i,a){throw new Error(`${s(e,t,r)}\nexpected type was '${i}', actual type was '${a}'`)}(e,t,r,i,a.type)}t.a=void 0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"var",function(){return G}),r.d(t,"in",function(){return ae});var i=r(38),a=r(12),n=r(15),s=r(43),o=r(44),c=r(16),f=r(17),u=r(18),l=r(45),h=r(46),d=r(47),p=r(9),b=r(48),g=r(49),m=r(51),y=r(52),_=r(53),v=r(54),x=r(19),w=r(20),E=r(55),T=r(5),C=r(3),A=r(8),F=r(56),S=r(21),D=r(57),O=r(58),R=r(59),M=r(60),B=r(22),k=r(23);r.d(t,"Cubic",function(){return S.a});var L=r(61),$=r(62);r.d(t,"palettes",function(){return i.c}),r.d(t,"Asc",function(){return $.a}),r.d(t,"Desc",function(){return $.b});t.asc=((...e)=>new $.a(...e));t.desc=((...e)=>new $.b(...e));t.noOrder=((...e)=>new $.c(...e));t.width=((...e)=>new $.d(...e));const j=(...e)=>new C.f(...e);t.floatMul=j;const P=(...e)=>new C.d(...e);t.floatDiv=P;const I=(...e)=>new C.c(...e);t.floatAdd=I;const U=(...e)=>new C.h(...e);t.floatSub=U;const N=(...e)=>new C.g(...e);t.floatPow=N;const q=(...e)=>new C.e(...e);t.floatMod=q;t.log=((...e)=>new T.c(...e));t.sqrt=((...e)=>new T.g(...e));t.sin=((...e)=>new T.f(...e));t.cos=((...e)=>new T.b(...e));t.tan=((...e)=>new T.h(...e));t.sign=((...e)=>new T.e(...e));t.near=((...e)=>new h.a(...e));t.blend=((...e)=>new n.a(...e));t.rgba=((...e)=>new O.b(...e));t.rgb=((...e)=>new O.a(...e));t.hex=((...e)=>new B.a(...e));const z=(...e)=>new p.a(...e);t.property=z;const G=(...e)=>new b.a(...e);t.variable=G;t.animate=((...e)=>new a.a(...e));t.hsv=((...e)=>new R.a(...e));t.hsva=((...e)=>new R.b(...e));t.hsl=((...e)=>new M.a(...e));t.hsla=((...e)=>new M.b(...e));t.namedColor=((...e)=>new k.c(...e));t.opacity=((...e)=>new m.a(...e));t.ramp=((...e)=>new g.a(...e));const V=(...e)=>new c.a(...e);t.float=V;t.category=((...e)=>new u.a(...e));t.max=((...e)=>new A.b(...e));t.min=((...e)=>new A.c(...e));t.sum=((...e)=>new A.e(...e));t.avg=((...e)=>new A.a(...e));t.mode=((...e)=>new A.d(...e));t.top=((...e)=>new y.a(...e));t.linear=((...e)=>new l.a(...e));t.cubic=((...e)=>new S.a(...e));t.ilinear=((...e)=>new S.b(...e));t.now=((...e)=>new d.a(...e));t.zoom=((...e)=>new v.a(...e));t.cielab=((...e)=>new o.a(...e));t.xyz=((...e)=>new _.a(...e));t.abs=((...e)=>new T.a(...e));const W=(...e)=>new C.i(...e);t.greaterThan=W;const X=(...e)=>new C.j(...e);t.greaterThanOrEqualTo=X;const H=(...e)=>new C.k(...e);t.lessThan=H;const Y=(...e)=>new C.l(...e);t.lessThanOrEqualTo=Y;const Z=(...e)=>new C.b(...e);t.equals=Z;const K=(...e)=>new C.m(...e);t.notEquals=K;t.buckets=((...e)=>new s.a(...e));t.quantiles=((...e)=>new F.b(...e));t.globalQuantiles=((...e)=>new F.a(...e));t.viewportMax=((...e)=>new L.i(...e));t.viewportMin=((...e)=>new L.j(...e));t.viewportAvg=((...e)=>new L.g(...e));t.viewportSum=((...e)=>new L.l(...e));t.viewportCount=((...e)=>new L.h(...e));t.viewportPercentile=((...e)=>new L.k(...e));t.globalPercentile=((...e)=>new L.e(...e));t.globalMax=((...e)=>new L.c(...e));t.globalMin=((...e)=>new L.d(...e));t.globalAvg=((...e)=>new L.a(...e));t.globalSum=((...e)=>new L.f(...e));t.globalCount=((...e)=>new L.b(...e));t.inverse=((...e)=>new i.b(...e));t.floatConstant=((...e)=>new f.a(...e));t.torque=((...e)=>new D.b(...e));t.fade=((...e)=>new D.a(...e));t.time=((...e)=>new E.a(...e));t.customPalette=((...e)=>new i.a(...e));const J=new f.a(1);t.TRUE=J;const Q=new f.a(0);t.FALSE=Q;t.and=((...e)=>new C.a(...e));t.or=((...e)=>new C.n(...e));t.not=((...e)=>new T.d(...e));const ee=W;t.gt=ee;const te=X;t.gte=te;const re=H;t.lt=re;const ie=Y;t.lte=ie;const ae=(...e)=>new x.a(...e),ne=V;t.number=ne;const se=I;t.add=se;const oe=U;t.sub=oe;const ce=j;t.mul=ce;const fe=P;t.div=fe;const ue=N;t.pow=ue;const le=q;t.mod=le;const he=z;t.prop=he;const de=Z;t.eq=de;const pe=K;t.neq=pe;t.nin=((...e)=>new x.b(...e));t.between=((...e)=>new w.a(...e))},function(e,t,r){"use strict";var i=r(2),a=r(1),n=r(0);const s=0,o=1,c=2,f=4,u=8,l=C("mul",o|c|f,(e,t)=>e*t,(e,t)=>`(${e} * ${t})`);t.f=l;const h=C("div",o|c|f,(e,t)=>e/t,(e,t)=>`(${e} / ${t})`);t.d=h;const d=C("add",o|f,(e,t)=>e+t,(e,t)=>`(${e} + ${t})`);t.c=d;const p=C("sub",o|f,(e,t)=>e-t,(e,t)=>`(${e} - ${t})`);t.h=p;const b=C("mod",o,(e,t)=>e%t,(e,t)=>`mod(${e}, ${t})`);t.e=b;const g=C("pow",o,(e,t)=>Math.pow(e,t),(e,t)=>`pow(${e}, ${t})`);t.g=g;const m=C("greaterThan",o,(e,t)=>e>t?1:0,(e,t)=>`(${e}>${t}? 1.:0.)`);t.i=m;const y=C("greaterThanOrEqualTo",o,(e,t)=>e>=t?1:0,(e,t)=>`(${e}>=${t}? 1.:0.)`);t.j=y;const _=C("lessThan",o,(e,t)=>e<t?1:0,(e,t)=>`(${e}<${t}? 1.:0.)`);t.k=_;const v=C("lessThanOrEqualTo",o,(e,t)=>e<=t?1:0,(e,t)=>`(${e}<=${t}? 1.:0.)`);t.l=v;const x=C("equals",o|u,(e,t)=>e==t?1:0,(e,t)=>`(${e}==${t}? 1.:0.)`);t.b=x;const w=C("notEquals",o|u,(e,t)=>e!=t?1:0,(e,t)=>`(${e}!=${t}? 1.:0.)`);t.m=w;const E=C("or",o,(e,t)=>Math.min(e+t,1),(e,t)=>`min(${e} + ${t}, 1.)`);t.n=E;const T=C("and",o,(e,t)=>Math.min(e*t,1),(e,t)=>`min(${e} * ${t}, 1.)`);function C(e,t,r,o){return class extends n.a{constructor(n,o){if(Number.isFinite(n)&&Number.isFinite(o))return Object(i.float)(r(n,o));const c=A(n=Object(a.l)(n),o=Object(a.l)(o));if(!(void 0===c||c!=s&&c&t))throw new Error(`${e}(): invalid parameter types\n'x' type was ${n.type}, 'y' type was ${o.type}`);super({a:n,b:o}),this.type=F(c)}_compile(r){super._compile(r);const[i,a]=[this.a,this.b],n=A(i,a);if(n==s||!(n&t))throw new Error(`${e}(): invalid parameter types\n'x' type was ${i.type}, 'y' type was ${a.type}`);this.type=F(n),this.inlineMaker=(e=>o(e.a,e.b))}eval(e){return r(this.a.eval(e),this.b.eval(e))}}}function A(e,t){return e.type&&t.type?"float"==e.type&&"float"==t.type?o:"float"==e.type&&"color"==t.type?c:"color"==e.type&&"float"==t.type?c:"color"==e.type&&"color"==t.type?f:"category"==e.type&&"category"==t.type?u:s:void 0}function F(e){switch(e){case o:return"float";case c:case f:return"color";case u:return"float";default:return}}t.a=T},function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return s}),r.d(t,"g",function(){return o}),r.d(t,"f",function(){return c}),r.d(t,"e",function(){return f}),r.d(t,"c",function(){return u}),r.d(t,"d",function(){return l});const i=Math.PI/180,a=6378137,n=a*Math.PI,s=2*n;function o(e){let t=e.lat*i;return{x:e.lng*i*a,y:Math.log(Math.tan(t/2+Math.PI/4))*a}}function c(e){return void 0===e}function f(e){return"string"==typeof e}function u(e){return"number"==typeof e}function l(e){const t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){"use strict";var i=r(1),a=r(0);const n=d("log",e=>Math.log(e),e=>`log(${e})`);t.c=n;const s=d("sqrt",e=>Math.sqrt(e),e=>`sqrt(${e})`);t.g=s;const o=d("sin",e=>Math.sin(e),e=>`sin(${e})`);t.f=o;const c=d("cos",e=>Math.cos(e),e=>`cos(${e})`);t.b=c;const f=d("tan",e=>Math.tan(e),e=>`tan(${e})`);t.h=f;const u=d("sign",e=>Math.sign(e),e=>`sign(${e})`);t.e=u;const l=d("abs",e=>Math.abs(e),e=>`abs(${e})`);t.a=l;const h=d("not",e=>1-e,e=>`(1.0 - ${e})`);function d(e,t,r){return class extends a.a{constructor(t){t=Object(i.l)(t),Object(i.d)(e,"x",0,"float",t),super({a:t}),this.type="float"}_compile(t){if(super._compile(t),Object(i.g)(e,"x",0,"float",this.a),"float"!=this.a.type)throw new Error(`Unary operation cannot be performed to '${this.a.type}'`);this.inlineMaker=(e=>r(e.a))}eval(e){return t(this.a.eval(e))}}}t.d=h},function(e,t,r){"use strict";var i=r(73);t.a=class extends i.a{constructor(e,t){super({origin:"validation",type:e,message:t})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.union=function(e,t){const r=e.columns.concat(t.columns);return{columns:r.filter((e,t)=>r.indexOf(e)==t)}},t.equals=function(e,t){if(!e||!t)return!1;return e.columns.length==t.columns.length&&e.columns.every(e=>t.columns.includes(e))};t.IDENTITY={columns:[]};const i=new RegExp("^_cdb_agg_[a-zA-Z0-9]+_"),a={isAggregated:function(e){return e.startsWith("_cdb_agg_")},getBase:function(e){return e.replace(i,"")},getAggFN:function(e){let t=e.substr("_cdb_agg_".length);return t.substr(0,t.indexOf("_"))},aggColumn:(e,t)=>`_cdb_agg_${t}_${e}`};t.column=a},function(e,t,r){"use strict";var i=r(0),a=r(7),n=r(9),s=r(1);const o=h("max","float");t.b=o;const c=h("min","float");t.c=c;const f=h("avg","float");t.a=f;const u=h("sum","float");t.e=u;const l=h("mode","category");function h(e,t){return class extends i.a{constructor(r){Object(s.c)(e,"property",0,n.a,r),super({property:r}),this._aggName=e,this.type=t}get name(){return this.property.name}get aggName(){return this._aggName}get numCategories(){return this.property.numCategories}eval(t){return t[a.column.aggColumn(this.property.name,e)]}_compile(r){super._compile(r),Object(s.g)(e,"property",0,t,this.property)}_applyToShaderSource(t){return{preface:"",inline:`${t(a.column.aggColumn(this.property.name,e))}`}}_postShaderCompile(){}_getMinimumNeededSchema(){return{columns:[a.column.aggColumn(this.property.name,e)]}}}}t.d=l},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){if(Object(a.f)("property","name",0,e),""==e)throw new Error("property(): invalid parameter, zero-length string");super({}),this.name=e}_compile(e){const t=e.columns.find(e=>e.name==this.name);if(!t)throw new Error(`Property '${this.name}' does not exist`);this.type=t.type,"category"==this.type&&(this.numCategories=t.categoryNames.length),super._setGenericGLSL((e,t)=>t(this.name))}_applyToShaderSource(e){return{preface:"",inline:e(this.name)}}_getMinimumNeededSchema(){return{columns:[this.name]}}eval(e){return e[this.name]}}},function(e,t,r){"use strict";r.d(t,"b",function(){return u});var i=r(24),a=r(7),n=r(25),s=r(2);r.d(t,"a",function(){return n.a}),r.d(t,"c",function(){return a});const o=1e3,c=Date.now(),f=1024;class u{constructor(e){if(e){if(this.gl=e.getContext("webgl"),!this.gl)throw new Error("WebGL 1 is unsupported");this._initGL(this.gl)}this._center={x:0,y:0},this._zoom=1,this.RTT_WIDTH=f,this.dataframes=[]}_initGL(e){if(this.gl=e,!e.getExtension("OES_texture_float"))throw new Error("WebGL extension OES_texture_float is unsupported");const t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);if(t<f)throw new Error(`WebGL parameter 'gl.MAX_RENDERBUFFER_SIZE' is below the requirement: ${t} < ${f}`);this._initShaders(),this.auxFB=e.createFramebuffer(),this.bigTriangleVBO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.bigTriangleVBO);e.bufferData(e.ARRAY_BUFFER,new Float32Array([10,-10,0,10,-10,-10]),e.STATIC_DRAW),this.zeroTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.zeroTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this._AATex=e.createTexture(),this._AAFB=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,this.zeroTex)}getCenter(){return{x:this._center.x,y:this._center.y}}setCenter(e,t){this._center.x=e,this._center.y=t}getBounds(){const e=this.getCenter(),t=this.getZoom()*this.getAspect(),r=this.getZoom();return[e.x-t,e.y-r,e.x+t,e.y+r]}getZoom(){return this._zoom}setZoom(e){this._zoom=e}getAspect(){return this.gl?this.gl.canvas.width/this.gl.canvas.height:1}_computeDrawMetadata(e){const t=e.getActiveDataframes(),r=e.viz,i=this.getAspect();let n={zoom:1/this._zoom,columns:[]};const s=r.getColor()._getDrawMetadataRequirements(),c=r.getWidth()._getDrawMetadataRequirements(),f=r.getStrokeColor()._getDrawMetadataRequirements(),u=r.getStrokeWidth()._getDrawMetadataRequirements(),l=r.getFilter()._getDrawMetadataRequirements(),h=Object.values(r.variables);let d=[c,s,f,u,l].concat(h.map(e=>e._getDrawMetadataRequirements())).reduce(a.union,a.IDENTITY).columns;if(0==d.length)return n;d.forEach(e=>{n.columns.push({name:e,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,avg:void 0,count:0,sum:0,histogramBuckets:o,histogram:Array.from({length:o},()=>0),accumHistogram:Array.from({length:o},()=>0)})});const p=1/this._zoom;return t.forEach(e=>{e.vertexScale=[p/i*e.scale,p*e.scale],e.vertexOffset=[p/i*(this._center.x-e.center.x),p*(this._center.y-e.center.y)];const t=(-1+e.vertexOffset[0])/e.vertexScale[0],a=(1+e.vertexOffset[0])/e.vertexScale[0],s=(-1+e.vertexOffset[1])/e.vertexScale[1],o=(1+e.vertexOffset[1])/e.vertexScale[1],c=r.getFilter()._getMinimumNeededSchema().columns,f={};for(let i=0;i<e.numFeatures;i++){const u=e.geom[2*i+0],l=e.geom[2*i+1];if(u>t&&u<a&&l>s&&l<o){if(r.getFilter()&&(c.forEach(t=>{f[t]=e.properties[t][i]}),r.getFilter().eval(f)<.5))continue;d.forEach(t=>{const r=e.properties[t][i],a=n.columns.find(e=>e.name==t);a.min=Math.min(r,a.min),a.max=Math.max(r,a.max),a.count++,a.sum+=r})}}}),d.forEach(e=>{const t=n.columns.find(t=>t.name==e);t.avg=t.sum/t.count}),t.forEach(e=>{d.forEach(t=>{const r=e.properties[t],a=n.columns.find(e=>e.name==t);e.vertexScale=[p/i*e.scale,p*e.scale],e.vertexOffset=[p/i*(this._center.x-e.center.x),p*(this._center.y-e.center.y)];const s=(-1+e.vertexOffset[0])/e.vertexScale[0],o=(1+e.vertexOffset[0])/e.vertexScale[0],c=(-1+e.vertexOffset[1])/e.vertexScale[1],f=(1+e.vertexOffset[1])/e.vertexScale[1],u=a.min,l=a.max-u;for(let t=0;t<e.numFeatures;t++){const i=e.geom[2*t+0],n=e.geom[2*t+1];if(i>s&&i<o&&n>c&&n<f){const e=r[t];if(!Number.isFinite(e))continue;a.histogram[Math.ceil(999*(e-u)/l)]++}}})}),d.forEach(e=>{const t=n.columns.find(t=>t.name==e);for(let e=1;e<t.histogramBuckets;e++)t.accumHistogram[e]=t.accumHistogram[e-1]+t.histogram[e]}),n}renderLayer(e){const t=e.getActiveDataframes(),r=e.viz,i=this.gl,a=this.getAspect();if(!t.length)return;i.enable(i.CULL_FACE),i.disable(i.BLEND),i.disable(i.DEPTH_TEST),i.disable(i.STENCIL_TEST),i.depthMask(!1),i.bindFramebuffer(i.FRAMEBUFFER,this.auxFB);const n=this._computeDrawMetadata(e);Object.values(r.variables).map(e=>{e._updateDrawMetadata(n)});const o=(e,t,r,a,s)=>{i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),i.viewport(0,0,f,e.height),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(r.program),n.freeTexUnit=Object.keys(s).length,a._setTimestamp((Date.now()-c)/1e3),a._updateDrawMetadata(n),a._preDraw(r.program,n,i),Object.keys(s).forEach((t,r)=>{i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e.propertyTex[e.propertyID[t]]),i.uniform1i(s[t],r)}),i.enableVertexAttribArray(r.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(r.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(r.vertexAttribute)};if(t.map(e=>o(e,e.texColor,r.colorShader,r.getColor(),r.propertyColorTID)),t.map(e=>o(e,e.texWidth,r.widthShader,r.getWidth(),r.propertyWidthTID)),t.map(e=>o(e,e.texStrokeColor,r.strokeColorShader,r.getStrokeColor(),r.propertyStrokeColorTID)),t.map(e=>o(e,e.texStrokeWidth,r.strokeWidthShader,r.getStrokeWidth(),r.propertyStrokeWidthTID)),t.map(e=>o(e,e.texFilter,r.filterShader,r.getFilter(),r.propertyFilterTID)),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.enable(i.BLEND),i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),"point"!=e.type){const e=(window.devicePixelRatio||1)>=2?1:2;i.bindFramebuffer(i.FRAMEBUFFER,this._AAFB);const[t,r]=[i.drawingBufferWidth,i.drawingBufferHeight];t==this._width&&r==this._height||(i.bindTexture(i.TEXTURE_2D,this._AATex),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t*e,r*e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._AATex,0),[this._width,this._height]=[t,r]),i.viewport(0,0,t*e,r*e),i.clear(i.COLOR_BUFFER_BIT)}const u=1/this._zoom,{orderingMins:l,orderingMaxs:h}=function(e){const t=e.viz.getOrder();let r=[0],i=[1e3];t instanceof s.Asc?(r=Array.from({length:16},(e,t)=>2*(15-t)),i=Array.from({length:16},(e,t)=>0==t?1e3:2*(15-t+1))):t instanceof s.Desc&&(r=Array.from({length:16},(e,t)=>2*t),i=Array.from({length:16},(e,t)=>15==t?1e3:2*(t+1)));return{orderingMins:r,orderingMaxs:i}}(e),d=e=>t.forEach(t=>{let r=null;r="point"==t.type?this.finalRendererProgram:"line"==t.type?this.lineRendererProgram:this.triRendererProgram,i.useProgram(r.program),i.uniform1f(r.orderMinWidth,l[e]),i.uniform1f(r.orderMaxWidth,h[e]),i.uniform2f(r.vertexScaleUniformLocation,u/a*t.scale,u*t.scale),i.uniform2f(r.vertexOffsetUniformLocation,u/a*(this._center.x-t.center.x),u*(this._center.y-t.center.y)),"line"==t.type?i.uniform2f(r.normalScale,1/i.canvas.clientWidth,1/i.canvas.clientHeight):"point"==t.type&&i.uniform1f(r.devicePixelRatio,window.devicePixelRatio||1),t.vertexScale=[u/a*t.scale,u*t.scale],t.vertexOffset=[u/a*(this._center.x-t.center.x),u*(this._center.y-t.center.y)],i.enableVertexAttribArray(r.vertexPositionAttribute),i.bindBuffer(i.ARRAY_BUFFER,t.vertexBuffer),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(r.featureIdAttr),i.bindBuffer(i.ARRAY_BUFFER,t.featureIDBuffer),i.vertexAttribPointer(r.featureIdAttr,2,i.FLOAT,!1,0,0),"line"==t.type&&(i.enableVertexAttribArray(r.normalAttr),i.bindBuffer(i.ARRAY_BUFFER,t.normalBuffer),i.vertexAttribPointer(r.normalAttr,2,i.FLOAT,!1,0,0)),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texColor),i.uniform1i(r.colorTexture,0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t.texWidth),i.uniform1i(r.widthTexture,1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.texFilter),i.uniform1i(r.filterTexture,2),"point"==t.type&&(i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,t.texStrokeColor),i.uniform1i(r.colorStrokeTexture,3),i.activeTexture(i.TEXTURE4),i.bindTexture(i.TEXTURE_2D,t.texStrokeWidth),i.uniform1i(r.strokeWidthTexture,4)),i.drawArrays("point"==t.type?i.POINTS:i.TRIANGLES,0,t.numVertex),i.disableVertexAttribArray(r.vertexPositionAttribute),i.disableVertexAttribArray(r.featureIdAttr),"line"==t.type&&i.disableVertexAttribArray(r.normalAttr)});l.map((e,t)=>{d(t)}),"point"!=e.type&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.useProgram(this._aaBlendShader.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._AATex),i.uniform1i(this._aaBlendShader.readTU,0),i.enableVertexAttribArray(this._aaBlendShader.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(this._aaBlendShader.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(this._aaBlendShader.vertexAttribute)),i.disable(i.CULL_FACE)}_initShaders(){this.finalRendererProgram=i.b.createPointShader(this.gl),this.triRendererProgram=i.b.createTriShader(this.gl),this.lineRendererProgram=i.b.createLineShader(this.gl),this._aaBlendShader=new i.a(this.gl)}}},function(e,t,r){"use strict";function i(e,t,r){return{x:(e-r.center.x)/r.scale,y:(t-r.center.y)/r.scale}}function a(e){return function(e,t){const[r,i,a,n]=t,s=1<<e,o=e=>Math.min(Math.max(e,0),s-1),c=o(Math.floor(s*(r+1)*.5)),f=o(Math.ceil(s*(a+1)*.5)-1),u=o(Math.floor(s*(1-n)*.5)),l=o(Math.ceil(s*(1-i)*.5)-1);let h=[];for(let t=c;t<=f;++t)for(let r=u;r<=l;++r)h.push({x:t,y:r,z:e});return h}((t=(e[3]-e[1])/2,Math.ceil(Math.log2(1/t))),e);var t}function n(e,t,r){return{center:{x:(e+.5)/Math.pow(2,r)*2-1,y:2*(1-(t+.5)/Math.pow(2,r))-1},scale:1/Math.pow(2,r)}}r.d(t,"b",function(){return a}),r.d(t,"a",function(){return n}),r.d(t,"c",function(){return i})},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){if(Object(a.e)("animate","duration",0,e),e<0)throw new Error(Object(a.j)("animate","duration",0)+"duration must be greater than or equal to 0");super({}),this.aTime=Date.now(),this.bTime=this.aTime+Number(e),this.type="float"}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float anim${this._uid};\n`),inline:`anim${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`anim${this._uid}`)}_preDraw(e,t,r){const i=Date.now();this.mix=(i-this.aTime)/(this.bTime-this.aTime),this.mix>1?r.uniform1f(this._getBinding(e).uniformLocation,1):r.uniform1f(this._getBinding(e).uniformLocation,this.mix)}eval(){const e=Date.now();return this.mix=(e-this.aTime)/(this.bTime-this.aTime),Math.min(this.mix,1)}isAnimated(){return!this.mix||this.mix<=1}}},function(e,t,r){"use strict";t.a=class{constructor(){}}},function(e,t,r){"use strict";t.a=function(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}}},function(e,t,r){"use strict";var i=r(1),a=r(12),n=r(0);function s(e,t){if(!("float"==e.type&&"float"==t.type||"color"==e.type&&"color"==t.type))throw new Error(`blend(): invalid parameter types\n\t'a' type was '${e.type}'\n\t'b' type was ${t.type}'`)}t.a=class extends n.a{constructor(e,t,r,a){e=Object(i.l)(e),t=Object(i.l)(t),r=Object(i.l)(r),Object(i.b)("blend","a",0,e),Object(i.b)("blend","b",1,t),Object(i.b)("blend","mix",2,r),e.type&&t.type&&s(e,t),Object(i.d)("blend","mix",2,"float",r);const n=r;a&&(r=a(r)),super({a:e,b:t,mix:r}),this.originalMix=n,e.type&&t.type&&(this.type=e.type)}_compile(e){super._compile(e),s(this.a,this.b),Object(i.g)("blend","mix",1,"float",this.mix),this.type=this.a.type,this.inlineMaker=(e=>`mix(${e.a}, ${e.b}, clamp(${e.mix}, 0., 1.))`)}_preDraw(...e){super._preDraw(...e),this.originalMix instanceof a.a&&!this.originalMix.isAnimated()&&(this.parent.replaceChild(this,this.b),this.notify())}replaceChild(e,t){e==this.mix&&(this.originalMix=t),super.replaceChild(e,t)}eval(e){const t=Object(i.h)(this.mix.eval(e),0,1),r=this.a.eval(e),a=this.b.eval(e);return Object(i.m)(r,a,t)}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){Object(a.e)("float","x",0,e),super({}),this.expr=e,this.type="float"}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float float${this._uid};`),inline:`float${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`float${this._uid}`)}_preDraw(e,t,r){r.uniform1f(this._getBinding(e).uniformLocation,this.expr)}isAnimated(){return!1}eval(){return this.expr}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){Object(a.e)("float","x",0,e),super({}),this.expr=e,this.type="float",this.inlineMaker=(()=>`(${e.toFixed(20)})`)}eval(){return this.expr}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){Object(a.f)("category","categoryName",0,e),super({}),this.expr=e,this.type="category"}_compile(e){this._metadata=e}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float cat${this._uid};\n`),inline:`cat${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`cat${this._uid}`)}_preDraw(e,t,r){const i=this._metadata.categoryIDs[this.expr];r.uniform1f(this._getBinding(e).uniformLocation,i)}eval(){return this._metadata.categoryIDs[this.expr]}isAnimated(){return!1}}},function(e,t,r){"use strict";var i=r(1),a=r(0);const n=o("in",function(e){return 0==e.length?()=>"0.":t=>`(${e.map((e,r)=>`(${t.value} == ${t[`arg${r}`]})`).join(" || ")})? 1.: 0.`},(e,t)=>t.some(t=>t==e)?1:0);t.a=n;const s=o("nin",function(e){return 0==e.length?()=>"1.":t=>`(${e.map((e,r)=>`(${t.value} != ${t[`arg${r}`]})`).join(" && ")})? 1.: 0.`},(e,t)=>t.some(t=>t==e)?0:1);function o(e,t,r){return class extends a.a{constructor(r,...a){r=Object(i.l)(r),Object(i.b)(e,"value",0,r),a=a.map(i.l),Object(i.d)(e,"value",0,"category",r),a.map((t,r)=>Object(i.d)(e,"",r+1,"category",t));let n={value:r};a.map((e,t)=>n[`arg${t}`]=e),super(n),this.categories=a,this.inlineMaker=t(this.categories),this.type="float"}_compile(t){super._compile(t),Object(i.g)(e,"value",0,"category",this.value),this.categories.map((t,r)=>Object(i.g)(e,"",r+1,"category",t))}eval(e){return r(this.value.eval(e),this.categories.map(t=>t.eval(e)))}}}t.b=s},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e,t,r){e=Object(a.l)(e),t=Object(a.l)(t),r=Object(a.l)(r),Object(a.d)("between","value",0,"float",e),Object(a.d)("between","lowerLimit",1,"float",t),Object(a.d)("between","upperLimit",2,"float",r),super({value:e,lowerLimit:t,upperLimit:r}),this.type="float"}_compile(e){super._compile(e),Object(a.g)("between","value",0,"float",this.value),Object(a.g)("between","lowerLimit",1,"float",this.lowerLimit),Object(a.g)("between","upperLimit",2,"float",this.upperLimit),this.inlineMaker=(e=>`((${e.value} >= ${e.lowerLimit} &&  ${e.value} <= ${e.upperLimit}) ? 1. : 0.)`)}eval(e){const t=this.value.eval(e),r=this.lowerLimit.eval(e),i=this.upperLimit.eval(e);return t>=r&&t<=i?1:0}}},function(e,t,r){"use strict";var i=r(1),a=r(0);t.b=class extends(n(e=>e,void 0,e=>e)){};function n(e,t,r){const n=class extends a.a{constructor(e){super({m:e=Object(i.l)(e)})}_compile(r){if(super._compile(r),"float"!=this.m.type)throw new Error(`Blending cannot be performed by '${this.m.type}'`);this.type="float",this._setGenericGLSL(t=>e(t.m),t)}eval(e){return r(this.m.eval(e))}};return n.type="interpolator",n}t.a=class extends(n(e=>`cubicEaseInOut(${e})`,"\n    #ifndef CUBIC\n    #define CUBIC\n    float cubicEaseInOut(float p){\n        if (p < 0.5) {\n            return 4. * p * p * p;\n        }else {\n            float f = ((2. * p) - 2.);\n            return 0.5 * f * f * f + 1.;\n        }\n    }\n    #endif\n",e=>e)){}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){Object(a.f)("hex","hexadecimalColor",0,e),super({}),this.type="color";try{this.color=Object(a.k)(e)}catch(e){throw new Error(Object(a.j)("hex","hexadecimalColor",0)+"\nInvalid hexadecimal color string")}}_compile(e){super._compile(e),this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${this.color.a.toFixed(4)})`)}eval(){return this.color}}},function(e,t,r){"use strict";var i=r(0),a=r(1);const n=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];t.a=n;class s extends i.a{constructor(e){if(Object(a.f)("namedColor","colorName",0,e),!n.includes(e.toLowerCase()))throw new Error(Object(a.j)("namedColor","colorName",0)+`\nInvalid color name:  "${e}"`);super({}),this.type="color",this.name=e,this.color=this._nameToRGB(this.name)}_compile(e){super._compile(e),this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${1..toFixed(4)})`)}_nameToRGB(e){const t=document.createElement("div");t.style.color=e,document.body.appendChild(t);const r=getComputedStyle(t).color;document.body.removeChild(t);const i=/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/.exec(r);return{r:Number(i[1]),g:Number(i[2]),b:Number(i[3]),a:1}}eval(){return this.color}}t.b=s,t.c=s},function(e,t,r){"use strict";r.d(t,"b",function(){return h}),r.d(t,"c",function(){return d}),r.d(t,"a",function(){return u});var i=r(64),a=r(68),n=r(69);const s=new(r(70).a);let o=1;function c(e,t,r){if(s.has(e,t))return s.get(e,t);const i=e.createShader(r);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(i);throw e.deleteShader(i),new Error("An error occurred compiling the shaders: "+r+"\nSource:\n"+t)}return s.set(e,t,i),i}function f(e,t,r){const i=c(e,t,e.VERTEX_SHADER),a=c(e,r,e.FRAGMENT_SHADER);if(this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,a),e.linkProgram(this.program),e.deleteShader(i),e.deleteShader(a),!e.getProgramParameter(this.program,e.LINK_STATUS))throw new Error("Unable to link the shader program: "+e.getProgramInfoLog(this.program));this.programID=o++}class u{constructor(e){f.call(this,e,n.b,n.a),this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),this.readTU=e.getUniformLocation(this.program,"aaTex")}}class l{constructor(e,t,r,i){const a=t.VS;let n=t.FS;n=(n=n.replace("$PREFACE",r)).replace("$INLINE",i),f.call(this,e,a,n),this.vertexAttribute=e.getAttribLocation(this.program,"vertex")}}const h={createPointShader:function(e){return new class{constructor(e){f.call(this,e,i.b.VS,i.b.FS),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.colorStrokeTexture=e.getUniformLocation(this.program,"colorStrokeTex"),this.strokeWidthTexture=e.getUniformLocation(this.program,"strokeWidthTex"),this.widthTexture=e.getUniformLocation(this.program,"widthTex"),this.orderMinWidth=e.getUniformLocation(this.program,"orderMinWidth"),this.orderMaxWidth=e.getUniformLocation(this.program,"orderMaxWidth"),this.filterTexture=e.getUniformLocation(this.program,"filterTex"),this.devicePixelRatio=e.getUniformLocation(this.program,"devicePixelRatio")}}(e)},createTriShader:function(e){return new class{constructor(e){f.call(this,e,i.c.VS,i.c.FS),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.filterTexture=e.getUniformLocation(this.program,"filterTex")}}(e)},createLineShader:function(e){return new class{constructor(e){f.call(this,e,i.a.VS,i.a.FS),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.normalAttr=e.getAttribLocation(this.program,"normal"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.widthTexture=e.getUniformLocation(this.program,"widthTex"),this.filterTexture=e.getUniformLocation(this.program,"filterTex"),this.normalScale=e.getUniformLocation(this.program,"normalScale")}}(e)}},d={createColorShader:function(e,t,r){return new class extends l{constructor(e,t,r){super(e,a,"/*Color*/"+t,r)}}(e,t,r)},createWidthShader:function(e,t,r){return new class extends l{constructor(e,t,r){super(e,a,"\n        /*Width*/\n        // From pixels in [0.,255.] to [0.,1.] in exponential-like form\n        float encodeWidth(float x){\n            if (x<16.){\n                x = x*4.;\n            }else if (x<80.){\n                x = (x-16.)+64.;\n            }else{\n                x = (x-80.)*0.5 + 128.;\n            }\n            return x / 255.;\n        }\n        "+t,`vec4(encodeWidth(${r}))`)}}(e,t,r)},createFilterShader:function(e,t,r){return new class extends l{constructor(e,t,r){super(e,a,"/*Filter*/"+t,`vec4(${r})`)}}(e,t,r)}}},function(e,t,r){"use strict";var i=r(71),a=r(11);function n(e,t,r,i){const a=s(e,t,r)<0,n=s(e,r,i)<0,o=s(e,i,t)<0;return a==n&&n==o}function s(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function o(e,t,r){const i=e.x-t.x,a=e.y-t.y;return i*i+a*a<=r*r}t.a=class{constructor({center:e,scale:t,geom:r,properties:a,type:n,active:s,size:o,metadata:c}){this.active=s,this.center=e,this.geom=r,this.properties=a,this.scale=t,this.size=o,this.type=n,this.decodedGeom=i.a.decodeGeom(this.type,this.geom),this.numVertex=this.decodedGeom.vertices.length/2,this.numFeatures=this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=c}bind(e){const t=e.gl;this.renderer=e;const r=this.decodedGeom.vertices,i=this.decodedGeom.breakpoints;this._genDataframePropertyTextures(t);const a=this.renderer.RTT_WIDTH,n=Math.ceil(this.numFeatures/a);this.vertexBuffer=t.createBuffer(),this.featureIDBuffer=t.createBuffer(),this.texColor=this._createStyleTileTexture(this.numFeatures),this.texWidth=this._createStyleTileTexture(this.numFeatures),this.texStrokeColor=this._createStyleTileTexture(this.numFeatures),this.texStrokeWidth=this._createStyleTileTexture(this.numFeatures),this.texFilter=this._createStyleTileTexture(this.numFeatures);const s=new Float32Array(r.length);let o=0;for(let e=0;e<r.length;e+=2)(!i.length&&e>0||e==i[o])&&o++,s[e+0]=o%a/(a-1),s[e+1]=n>1?Math.floor(o/a)/(n-1):.5;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.decodedGeom.normals&&(this.normalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.bufferData(t.ARRAY_BUFFER,this.decodedGeom.normals,t.STATIC_DRAW)),t.bindBuffer(t.ARRAY_BUFFER,this.featureIDBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}getFeaturesAtPosition(e,t){switch(this.type){case"point":return this._getPointsAtPosition(e,t);case"line":return this._getLinesAtPosition(e,t);case"polygon":return this._getPolygonAtPosition(e,t);default:return[]}}_getPointsAtPosition(e,t){e=Object(a.c)(e.x,e.y,{center:this.center,scale:this.scale});const r=this.decodedGeom.vertices,i=[],n=2/this.renderer.gl.canvas.clientHeight/this.scale*this.renderer._zoom,s=Object.keys(this.properties),c=t.getWidth(),f=t.getStrokeWidth();for(let t=0;t<r.length;t+=2){const a=t/2,u={x:r[t],y:r[t+1]},l={};s.forEach(e=>{l[e]=this.properties[e][a]});const h=c.eval(l),d=f.eval(l);o(e,u,Math.min(h+d,126)/2*n)&&this._addFeatureToArray(a,i)}return i}_getLinesAtPosition(e,t){const r=Object(a.c)(e.x,e.y,{center:this.center,scale:this.scale}),i=this.decodedGeom.vertices,s=this.decodedGeom.normals,o=this.decodedGeom.breakpoints;let c=0;const f=[],u=2/this.renderer.gl.canvas.clientHeight/this.scale*this.renderer._zoom,l=Object.keys(this.properties),h=t.getWidth();for(let e=0;e<i.length;e+=6){e>=o[c]&&c++;const t={};l.forEach(e=>{t[e]=this.properties[e][c]});const a=Math.min(h.eval(t),336)/2*u;n(r,{x:i[e+0]+s[e+0]*a,y:i[e+1]+s[e+1]*a},{x:i[e+2]+s[e+2]*a,y:i[e+3]+s[e+3]*a},{x:i[e+4]+s[e+4]*a,y:i[e+5]+s[e+5]*a})&&(this._addFeatureToArray(c,f),e=o[c]-6)}return f}_getPolygonAtPosition(e){const t=Object(a.c)(e.x,e.y,{center:this.center,scale:this.scale}),r=this.decodedGeom.vertices,i=this.decodedGeom.breakpoints;let s=0;const o=[];for(let e=0;e<r.length;e+=6)e>=i[s]&&s++,n(t,{x:r[e+0],y:r[e+1]},{x:r[e+2],y:r[e+3]},{x:r[e+4],y:r[e+5]})&&(this._addFeatureToArray(s,o),e=i[s]-6);return o}_addFeatureToArray(e,t){let r="";const i={};Object.keys(this.properties).map(t=>{let a=this.properties[t][e];if("cartodb_id"===t)r=a;else{const e=this.metadata.columns.find(e=>e.name==t);e&&"category"==e.type&&(a=e.categoryNames[a]),i[t]=a}}),t.push({id:r,properties:i})}_genDataframePropertyTextures(){const e=this.renderer.gl,t=this.renderer.RTT_WIDTH,r=Math.ceil(this.numFeatures/t);this.height=r,this.propertyID={},this.propertyCount=0;for(const i in this.properties)if(this.properties.hasOwnProperty(i)&&this.properties[i].length>0){let a=this.propertyID[i];void 0===a&&(a=this.propertyCount,this.propertyCount++,this.propertyID[i]=a),this.propertyTex[a]=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.propertyTex[a]),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,t,r,0,e.ALPHA,e.FLOAT,this.properties[i]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}}_createStyleTileTexture(e){const t=this.renderer.gl,r=this.renderer.RTT_WIDTH,i=Math.ceil(e/r),a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),a}free(){if(this.propertyTex){const e=this.renderer.gl;this.propertyTex.map(t=>e.deleteTexture(t)),e.deleteTexture(this.texColor),e.deleteTexture(this.texStrokeColor),e.deleteTexture(this.texWidth),e.deleteTexture(this.texStrokeWidth),e.deleteTexture(this.texFilter),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.featureIDBuffer),this.texColor="freed",this.texWidth="freed",this.texStrokeColor="freed",this.texStrokeWidth="freed",this.texFilter="freed",this.vertexBuffer="freed",this.featureIDBuffer="freed",this.propertyTex=null}}}},function(e,t,r){"use strict";t.a=class{constructor(e,t,r,i){this.categoryIDs=e,this.columns=t,this.featureCount=r,this.sample=i}}},function(e,t,r){"use strict";var i=r(13),a=r(76),n=r(6),s=r(31),o=r(32);const c="https://{user}.carto.com";t.a=class extends i.a{constructor(){super(),this._client=new a.a(this)}initialize(e,t){this._auth=e||Object(s.b)(),this._config=t||Object(o.b)(),Object(s.a)(this._auth),Object(o.a)(this._config),this._apiKey=this._auth.apiKey,this._username=this._auth.username,this._serverURL=this._generateURL(this._auth,this._config)}bindLayer(...e){this._client._bindLayer(...e)}requestMetadata(e){return this._client.getMetadata(e)}requestData(e){return this._client.getData(e)}free(){this._client.free()}_generateURL(e,t){let r=t&&t.serverURL||c;return r=r.replace(/{user}/,e.username),this._validateServerURL(r.replace(/{local}/,"")),{maps:r.replace(/{local}/,":8181"),sql:r.replace(/{local}/,":8080")}}_validateServerURL(e){if(!e.match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/))throw new n.a("source","nonValidServerURL")}}},function(e,t){var r,i,a=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,f=[],u=!1,l=-1;function h(){u&&c&&(u=!1,c.length?f=c.concat(f):l=-1,f.length&&d())}function d(){if(!u){var e=o(h);u=!0;for(var t=f.length;t;){for(c=f,f=[];++l<t;)c&&c[l].run();l=-1,t=f.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function b(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new p(e,t)),1!==f.length||u||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=b,a.addListener=b,a.once=b,a.off=b,a.removeListener=b,a.removeAllListeners=b,a.emit=b,a.prependListener=b,a.prependOnceListener=b,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";var i=r(30);function a(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(n,this,t),this.length=this._features.length}function n(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(r))}e.exports=a,a.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,t,this.extent,this._keys,this._values)}},function(e,t,r){"use strict";var i=r(90);function a(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(n,this,t)}function n(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){var r=e.readVarint()+e.pos;for(;e.pos<r;){var i=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[i]=a}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function s(e){for(var t,r,i=0,a=0,n=e.length,s=n-1;a<n;s=a++)t=e[a],i+=((r=e[s]).x-t.x)*(t.y+r.y);return i}e.exports=a,a.types=["Unknown","Point","LineString","Polygon"],a.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,a=1,n=0,s=0,o=0,c=[];e.pos<r;){if(n<=0){var f=e.readVarint();a=7&f,n=f>>3}if(n--,1===a||2===a)s+=e.readSVarint(),o+=e.readSVarint(),1===a&&(t&&c.push(t),t=[]),t.push(new i(s,o));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&c.push(t),c},a.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,n=0,s=1/0,o=-1/0,c=1/0,f=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)a+=e.readSVarint(),n+=e.readSVarint(),a<s&&(s=a),a>o&&(o=a),n<c&&(c=n),n>f&&(f=n);else if(7!==r)throw new Error("unknown command "+r)}return[s,c,o,f]},a.prototype.toGeoJSON=function(e,t,r){var i,n,o=this.extent*Math.pow(2,r),c=this.extent*e,f=this.extent*t,u=this.loadGeometry(),l=a.types[this.type];function h(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+f)/o;e[t]=[360*(r.x+c)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(i=0;i<u.length;i++)d[i]=u[i][0];h(u=d);break;case 2:for(i=0;i<u.length;i++)h(u[i]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,a=[],n=0;n<t;n++){var o=s(e[n]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&a.push(r),r=[e[n]]):r.push(e[n]))}r&&a.push(r);return a}(u),i=0;i<u.length;i++)for(n=0;n<u[i].length;n++)h(u[i][n])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p}},function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"b",function(){return o}),r.d(t,"a",function(){return c});var i=r(4),a=r(6);let n=void 0;function s(e){c(e),n=e}function o(){return n}function c(e){if(i.f(e))throw new a.a("setup","authRequired");if(!i.d(e))throw new a.a("setup","authObjectRequired");e.username=e.user,function(e){if(i.f(e))throw new a.a("setup","apiKeyRequired");if(!i.e(e))throw new a.a("setup","apiKeyStringRequired");if(""===e)throw new a.a("setup","nonValidApiKey")}(e.apiKey),function(e){if(i.f(e))throw new a.a("setup","usernameRequired");if(!i.e(e))throw new a.a("setup","usernameStringRequired");if(""===e)throw new a.a("setup","nonValidUsername")}(e.username)}},function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"b",function(){return o}),r.d(t,"a",function(){return c});var i=r(4),a=r(6);let n=void 0;function s(e){c(e),n=e}function o(){return n}function c(e){if(e){if(!i.d(e))throw new a.a("setup","configObjectRequired");!function(e){if(!i.e(e))throw new a.a("setup","serverURLStringRequired")}(e.serverURL)}}},function(e,t,r){"use strict";var i=r(14),a=r(4),n=r(13),s=r(34),o=r(36),c=r(94),f=r(95),u=r(6),l=r(2),h=r(96);t.a=class{constructor(e,t,r){this._checkId(e),this._checkSource(t),this._checkViz(r),this._init(e,t,r)}_init(e,t,r){r._boundLayer=this,this.state="init",this._id=e,this._emitter=Object(i.a)(),this._lastViewport=null,this._lastMNS=null,this._integrator=null,this._context=new Promise(e=>{this._contextInitCallback=e}),this.metadata=null,this._renderLayer=new h.a,this.state="init",this.isLoaded=!1,this.update(t,r)}on(e,t){return this._emitter.on(e,t)}off(e,t){return this._emitter.off(e,t)}addTo(e,t){if(this._isCartoMap(e))this._addToCartoMap(e,t);else{if(!this._isMGLMap(e))throw new u.a("layer","nonValidMap");this._addToMGLMap(e,t)}}async update(e,t){this._checkSource(e),this._checkViz(t),e=e._clone(),this._atomicChangeUID=this._atomicChangeUID+1||1;const r=this._atomicChangeUID;await this._context;const i=await e.requestMetadata(t);if(this._atomicChangeUID>r)throw new Error("Another atomic change was done before this one committed");this.metadata=i,e.bindLayer(this._onDataframeAdded.bind(this),this._onDataFrameRemoved.bind(this),this._onDataLoaded.bind(this)),this._source!==e&&this._freeSource(),this._source=e,this.requestData(),this._viz&&this._viz.onChange(null),this._viz=t,t.onChange(this._vizChanged.bind(this)),this._compileShaders(t,i)}blendToViz(e,t=400,r=l.cubic){this._checkViz(e),this._viz&&(e.getColor().blendFrom(this._viz.getColor(),t,r),e.getStrokeColor().blendFrom(this._viz.getStrokeColor(),t,r),e.getWidth().blendFrom(this._viz.getWidth(),t,r),e.getStrokeWidth().blendFrom(this._viz.getStrokeWidth(),t,r),e.getFilter().blendFrom(this._viz.getFilter(),t,r)),this._vizChanged(e).then(()=>{this._viz&&this._viz.onChange(null),this._viz=e,this._viz.onChange(this._vizChanged.bind(this))})}initCallback(){this._renderLayer.renderer=this._integrator.renderer,this._contextInitCallback(),this.requestMetadata()}async requestMetadata(e){if(e=e||this._viz)return await this._context,this._source.requestMetadata(e)}async requestData(){this.metadata&&this._source.requestData(this._getViewport())}hasDataframes(){return this._renderLayer.hasDataframes()}getId(){return this._id}getSource(){return this._source}getViz(){return this._viz}getNumFeatures(){return this._renderLayer.getNumFeatures()}getIntegrator(){return this._integrator}getFeaturesAtPosition(e){return this._renderLayer.getFeaturesAtPosition(e).map(this._addLayerIdToFeature.bind(this))}$paintCallback(){this._viz&&this._viz.colorShader&&(this._renderLayer.viz=this._viz,this._integrator.renderer.renderLayer(this._renderLayer)),this.isLoaded||"dataLoaded"!=this.state||(this._fire("loaded"),this.isLoaded=!0)}_fire(e,t){return this._emitter.emit(e,t)}_onDataframeAdded(e){this._renderLayer.addDataframe(e),this._integrator.invalidateWebGLState(),this._integrator.needRefresh()}_onDataFrameRemoved(e){this._renderLayer.removeDataframe(e),this._integrator.invalidateWebGLState(),this._integrator.needRefresh()}_onDataLoaded(){this.state="dataLoaded",this._integrator.needRefresh()}_addLayerIdToFeature(e){return e.layerId=this._id,e}_isCartoMap(e){return e instanceof o.a}_isMGLMap(){return!0}_addToCartoMap(e,t){this._integrator=Object(c.a)(e),this._integrator.addLayer(this,t)}_addToMGLMap(e,t){e.isStyleLoaded()?this._onMapLoaded(e,t):e.on("load",()=>{this._onMapLoaded(e,t)})}_onMapLoaded(e,t){this._integrator=Object(f.a)(e),this._integrator.addLayer(this,t)}_compileShaders(e,t){e.compileShaders(this._integrator.renderer.gl,t)}async _vizChanged(e){if(await this._context,!this._source)throw new Error("A source is required before changing the viz");const t=this._source,r=await t.requestMetadata(e);if(this._source!==t)throw new Error("A source change was made before the metadata was retrieved, therefore, metadata is stale and it cannot be longer consumed");return this.metadata=r,this._compileShaders(e,this.metadata),this._integrator.needRefresh(),this.requestData()}_checkId(e){if(a.f(e))throw new u.a("layer","idRequired");if(!a.e(e))throw new u.a("layer","idStringRequired");if(""===e)throw new u.a("layer","nonValidId")}_checkSource(e){if(a.f(e))throw new u.a("layer","sourceRequired");if(!(e instanceof n.a))throw new u.a("layer","nonValidSource")}_checkViz(e){if(a.f(e))throw new u.a("layer","vizRequired");if(!(e instanceof s.a))throw new u.a("layer","nonValidViz");if(e._boundLayer&&e._boundLayer!==this)throw new u.a("layer","sharedViz")}_getViewport(){if(this._integrator)return this._integrator.renderer.getBounds();throw new Error("?")}_freeSource(){this._source&&this._source.free(),this._renderLayer.freeDataframes()}}},function(e,t,r){"use strict";var i=r(4),a=r(2),n=r(7),s=r(24),o=r(92),c=r(35),f=r(0),u=r(1),l=r(6);const h=()=>1,d=()=>a.rgba(0,255,0,.5),p=()=>a.float(5),b=()=>a.rgba(0,255,0,.5),g=()=>a.float(0),m=()=>a.noOrder(),y=()=>a.floatConstant(1),_=["resolution","color","width","strokeColor","strokeWidth","order","filter","variables"],v=0,x=256;t.a=class{constructor(e){const t=this._getVizDefinition(e);this._checkVizSpec(t),Object.keys(t).forEach(e=>{_.includes(e)&&(this[e]=t[e])}),this.updated=!0,this._changeCallback=null,this._getRootExpressions().forEach(e=>{e.parent=this,e.notify=this._changed.bind(this)}),Object.keys(this.variables).map(e=>{this["__cartovl_variable_"+e]=this.variables[e]}),this._resolveAliases(),this._validateAliasDAG()}_getRootExpressions(){return[this.color,this.width,this.strokeColor,this.strokeWidth,this.order,this.filter,...Object.values(this.variables)]}getResolution(){return this.resolution}getColor(){return this.color}getWidth(){return this.width}getStrokeColor(){return this.strokeColor}getStrokeWidth(){return this.strokeWidth}getOrder(){return this.order}getFilter(){return this.filter}isAnimated(){return this.getColor().isAnimated()||this.getWidth().isAnimated()||this.getStrokeColor().isAnimated()||this.getStrokeWidth().isAnimated()||this.getFilter().isAnimated()}onChange(e){this._changeCallback=e}_changed(){this._changeCallback&&this._changeCallback(this)}getMinimumNeededSchema(){return[this.color,this.width,this.strokeColor,this.strokeWidth,this.filter].concat(Object.values(this.variables)).filter(e=>e&&e._getMinimumNeededSchema).map(e=>e._getMinimumNeededSchema()).reduce(n.union,n.IDENTITY)}compileShaders(e,t){this._compileColorShader(e,t),this._compileWidthShader(e,t),this._compileStrokeColorShader(e,t),this._compileStrokeWidthShader(e,t),this._compileFilterShader(e,t),Object.values(this.variables).map(e=>{e._bind(t)})}_resolveAliases(){[this.color,this.width,this.strokeColor,this.strokeWidth,this.filter].concat(Object.values(this.variables)).forEach(e=>e._resolveAliases(this.variables))}_validateAliasDAG(){const e=new Set,t=new Set,r=i=>{if(!e.has(i)){if(t.has(i))throw new Error("Viz contains a circular dependency");t.add(i),i._getDependencies().forEach(r),e.add(i)}},i=[...this.color._getDependencies(),...this.strokeColor._getDependencies(),...this.width._getDependencies(),...this.strokeWidth._getDependencies(),...this.filter._getDependencies()];for(;i.length;)r(i.pop())}_compileColorShader(e,t){this.color._bind(t);const r=Object(o.a)(e,this.color,s.c.createColorShader);this.propertyColorTID=r.tid,this.colorShader=r.shader}_compileWidthShader(e,t){this.width._bind(t);const r=Object(o.a)(e,this.width,s.c.createWidthShader);this.propertyWidthTID=r.tid,this.widthShader=r.shader}_compileStrokeColorShader(e,t){this.strokeColor._bind(t);const r=Object(o.a)(e,this.strokeColor,s.c.createColorShader);this.propertyStrokeColorTID=r.tid,this.strokeColorShader=r.shader}_compileStrokeWidthShader(e,t){this.strokeWidth._bind(t);const r=Object(o.a)(e,this.strokeWidth,s.c.createWidthShader);this.propertyStrokeWidthTID=r.tid,this.strokeWidthShader=r.shader}_compileFilterShader(e,t){this.filter._bind(t);const r=Object(o.a)(e,this.filter,s.c.createFilterShader);this.propertyFilterTID=r.tid,this.filterShader=r.shader}replaceChild(e,t){if(Object.values(this.variables).includes(e)){const r=Object.keys(this.variables).find(t=>this.variables[t]==e);this.variables[r]=t,t.parent=this,t.notify=e.notify,this._resolveAliases(),this._validateAliasDAG()}else if(e==this.color)this.color=t,t.parent=this,t.notify=e.notify;else if(e==this.width)this.width=t,t.parent=this,t.notify=e.notify;else if(e==this.strokeColor)this.strokeColor=t,t.parent=this,t.notify=e.notify;else if(e==this.strokeWidth)this.strokeWidth=t,t.parent=this,t.notify=e.notify;else{if(e!=this.filter)throw new Error("No child found");this.filter=t,t.parent=this,t.notify=e.notify}}_getVizDefinition(e){if(i.f(e))return this._setDefaults({});if(i.d(e))return this._setDefaults(e);if(i.e(e))return this._setDefaults(Object(c.a)(e));throw new l.a("viz","nonValidDefinition")}_setDefaults(e){return e.resolution=i.f(e.resolution)?h():e.resolution,e.color=e.color||d(),e.width=e.width||p(),e.strokeColor=e.strokeColor||b(),e.strokeWidth=e.strokeWidth||g(),e.order=e.order||m(),e.filter=e.filter||y(),e.variables=e.variables||{},e}_checkVizSpec(e){if(e.width=Object(u.l)(e.width),e.strokeWidth=Object(u.l)(e.strokeWidth),!i.c(e.resolution))throw new l.a("viz","resolutionNumberRequired");if(e.resolution<=v)throw new l.a("viz",`resolutionTooSmall[${v}]`);if(e.resolution>=x)throw new l.a("viz",`resolutionTooBig[${x}]`);if(!(e.color instanceof f.a))throw new l.a("viz","nonValidExpression[color]");if(!(e.strokeColor instanceof f.a))throw new l.a("viz","nonValidExpression[strokeColor]");if(!(e.width instanceof f.a))throw new l.a("viz","nonValidExpression[width]");if(!(e.strokeWidth instanceof f.a))throw new l.a("viz","nonValidExpression[strokeWidth]");if(!(e.order instanceof f.a))throw new l.a("viz","nonValidExpression[order]");if(!(e.filter instanceof f.a))throw new l.a("viz","nonValidExpression[filter]");for(let t in e)-1===_.indexOf(t)&&console.warn(`Property '${t}' is not supported`)}}},function(e,t,r){"use strict";t.b=function(e){d();const t=Object(s.l)(h(a()(e)));return p(),t},t.a=function(e){d();const t=a()(e);let r={variables:{}};"Compound"==t.type?t.body.map(e=>l(r,e)):l(r,t);return p(),r};var i=r(93),a=r.n(i),n=r(2),s=r(1),o=r(23),c=r(22);const f=[];var u={};function l(e,t){if(":"!=t.operator)throw new Error("Invalid syntax");t.left.name.length&&"@"==t.left.name[0]&&(t.left.name="__cartovl_variable_"+t.left.name.substr(1));const r=t.left.name;if(!r)throw new Error("Invalid syntax");if(r.startsWith("__cartovl_variable_"))e.variables[t.left.name.substr("__cartovl_variable_".length)]=Object(s.l)(h(t.right));else if("resolution"==r){const i=h(t.right);e[r]=i}else{const i=h(t.right);e[r]=Object(s.l)(i)}}function h(e){if("CallExpression"==e.type)return function(e){const t=e.callee.name.toLowerCase();if(f.includes(t))return e.arguments.map(e=>h(e))[0];const r=e.arguments.map(e=>h(e));if(u[t])return u[t](...r);throw new Error(`Invalid function name '${e.callee.name}'`)}(e);if("Literal"==e.type)return e.value;if("ArrayExpression"==e.type)return e.elements.map(e=>h(e));if("BinaryExpression"==e.type)return function(e){const t=h(e.left),r=h(e.right);switch(e.operator){case"*":return n.floatMul(t,r);case"/":return n.floatDiv(t,r);case"+":return n.floatAdd(t,r);case"-":return n.floatSub(t,r);case"%":return n.floatMod(t,r);case"^":return n.floatPow(t,r);case">":return n.greaterThan(t,r);case">=":return n.greaterThanOrEqualTo(t,r);case"<":return n.lessThan(t,r);case"<=":return n.lessThanOrEqualTo(t,r);case"==":return n.equals(t,r);case"and":return n.and(t,r);case"or":return n.or(t,r);default:throw new Error(`Invalid binary operator '${e.operator}'`)}}(e);if("UnaryExpression"==e.type)return function(e){switch(e.operator){case"-":return n.floatMul(-1,h(e.argument));case"+":return h(e.argument);default:throw new Error(`Invalid unary operator '${e.operator}'`)}}(e);if("Identifier"==e.type)return function(e){return e.name.length&&"@"==e.name[0]&&(e.name="__cartovl_variable_"+e.name.substr(1)),e.name.startsWith("__cartovl_variable_")?n.variable(e.name.substr("__cartovl_variable_".length)):"#"==e.name[0]?new c.a(e.name):"$"==e.name[0]?n.property(e.name.substring(1)):n.palettes[e.name.toLowerCase()]?n.palettes[e.name.toLowerCase()]:u[e.name.toLowerCase()]?u[e.name.toLowerCase()]:o.a.includes(e.name.toLowerCase())?new o.b(e.name.toLowerCase()):void 0}(e);throw new Error(`Invalid expression '${JSON.stringify(e)}'`)}function d(){a.a.addBinaryOp(":",0),a.a.addBinaryOp("^",11),a.a.addBinaryOp("or",1),a.a.addBinaryOp("and",2),a.a.addIdentifierChar("@"),a.a.addIdentifierChar("#"),a.a.removeLiteral("true"),a.a.removeLiteral("false")}function p(){a.a.removeBinaryOp("and"),a.a.removeBinaryOp("or"),a.a.removeBinaryOp("^"),a.a.removeBinaryOp(":"),a.a.removeIdentifierChar("@"),a.a.removeIdentifierChar("#"),a.a.addLiteral("true"),a.a.addLiteral("false")}Object.keys(n).filter(e=>e[0]==e[0].toLowerCase()).map(e=>{u[e.toLocaleLowerCase()]=n[e]}),u.true=n.TRUE,u.false=n.FALSE},function(e,t,r){"use strict";t.a=class{constructor(e){if("string"==typeof(e=e||{}).container){const t=window.document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container}' not found.`);this._container=t}this._background=e.background||"",this._layers=[],this._repaint=!0,this._canvas=this._createCanvas(),this._container.appendChild(this._canvas),this._gl=this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"),this._resizeCanvas(this._containerDimensions())}addLayer(e,t){let r;for(e.initCallback(),r=0;r<this._layers.length&&this._layers[r].getId()!==t;r++);this._layers.splice(r,0,e),window.requestAnimationFrame(this.update.bind(this))}update(e){if(this.lastFrame===e)return;this.lastFrame=e,this._drawBackground(this._background);let t=!0,r=!1;this._layers.forEach(e=>{const i=e.hasDataframes(),a=e.getViz()&&e.getViz().isAnimated();(i||a)&&e.$paintCallback(),t=t&&i,r=r||a}),t&&!r||window.requestAnimationFrame(this.update.bind(this))}_drawBackground(e){switch(e){case"black":this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"red":this._gl.clearColor(1,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"green":this._gl.clearColor(0,1,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"blue":this._gl.clearColor(0,0,1,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}}_createCanvas(){const e=window.document.createElement("canvas");return e.className="canvas",e.style.position="absolute",e}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.offsetWidth||400,t=this._container.offsetHeight||300),{width:e,height:t}}_resizeCanvas(e){const t=window.devicePixelRatio||1;this._canvas.width=t*e.width,this._canvas.height=t*e.height,this._canvas.style.width=`${e.width}px`,this._canvas.style.height=`${e.height}px`}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"source",function(){return d});var i=r(2),a=r(63),n=r(75),s=r(91),o=r(33),c=r(34),f=r(31),u=r(32),l=r(36),h=r(97);r.d(t,"Layer",function(){return o.a}),r.d(t,"setDefaultAuth",function(){return f.c}),r.d(t,"setDefaultConfig",function(){return u.c}),r.d(t,"expressions",function(){return i}),r.d(t,"Viz",function(){return c.a}),r.d(t,"Map",function(){return l.a}),r.d(t,"Interactivity",function(){return h.a});const d={Dataset:n.a,SQL:s.a,GeoJSON:a.a}},function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"b",function(){return o});var i=r(39),a=(r.n(i),r(0)),n=r(1);const s={};t.a=class extends a.a{constructor(...e){if(!(e=e.map(n.l)).length)throw new Error("customPalette(): invalid parameters: must receive at least one argument");const t=e[0].type;if(void 0==t)throw new Error("customPalette(): invalid parameters, must be formed by constant expressions, they cannot depend on feature properties");Object(n.g)("customPalette","colors[0]",0,["color","float"],e[0]),e.map((e,r)=>{if(Object(n.b)("customPalette",`colors[${r}]`,r,e),void 0==e.type)throw new Error("customPalette(): invalid parameters, must be formed by constant expressions, they cannot depend on feature properties");if(e.type!=t)throw new Error("customPalette(): invalid parameters, invalid argument type combination")}),super({}),this.type="color"==t?"customPalette":"customPaletteFloat";try{"color"==t?this.colors=e.map(e=>e.eval()):this.floats=e.map(e=>e.eval())}catch(e){throw new Error("Palettes must be formed by constant expressions, they cannot depend on feature properties")}}},Object.keys(i).map(e=>{s[`${e.toLowerCase()}`]=new class extends a.a{constructor(e,t){super({}),this.type="palette",this.name=e,this.subPalettes=new Proxy(t,{get:(e,t)=>{if(Number.isFinite(Number(t))&&Array.isArray(e[t]))return e[t].map(n.k)}}),this.tags=t.tags}getLongestSubPalette(){const e=this.subPalettes;for(let t=20;t>=0;t--)if(e[t])return e[t]}}(e,i[e])});class o extends a.a{constructor(e){super({}),this.type="palette",this._originalPalette=e,this.tags=e.tags,this.subPalettes=new Proxy(e.subPalettes,{get:(e,t)=>Number.isFinite(Number(t))&&Array.isArray(e[t])?this._reversePalette(e[t]):e[t]})}getLongestSubPalette(){return this._reversePalette(this._originalPalette.getLongestSubPalette())}_reversePalette(e){if(this.tags.includes("qualitative")){const t=[...e],r=t.pop();return[...t.reverse(),r]}return[...e].reverse()}}},function(e,t,r){e.exports=r(40)},function(e,t,r){var i,a;!function(){var n={Burg:{2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},BurgYl:{2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},RedOr:{2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},OrYel:{2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Peach:{2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},PinkYl:{2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Mint:{2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},BluGrn:{2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},DarkMint:{2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Emrld:{2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},ag_GrnYl:{2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},BluYl:{2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Teal:{2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},TealGrn:{2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Purp:{2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},PurpOr:{3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Sunset:{2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Magenta:{2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},SunsetDark:{2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},ag_Sunset:{2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},BrwnYl:{2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},ArmyRose:{2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Fall:{2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Geyser:{2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Temps:{2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},TealRose:{2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},Tropic:{2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Earth:{2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},Antique:{2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Bold:{2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Pastel:{2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Prism:{2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Safe:{2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Vivid:{2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]}},s={Blues:{tags:["quantitative"]},BrBG:{tags:["diverging"]},Greys:{tags:["quantitative"]},PiYG:{tags:["diverging"]},PRGn:{tags:["diverging"]},Purples:{tags:["quantitative"]},RdYlGn:{tags:["diverging"]},Spectral:{tags:["diverging"]},YlOrBr:{tags:["quantitative"]},YlGn:{tags:["quantitative"]},YlGnBu:{tags:["quantitative"]},YlOrRd:{tags:["quantitative"]}},o=r(41);for(var c in o){var f=o[c],u={};for(var l in f)u[l]=f[l];c in s&&(u.tags=s[c].tags),n["cb_"+c]=u}void 0===(a="function"==typeof(i=n)?i.call(t,r,t,e):i)||(e.exports=a)}()},function(e,t,r){e.exports=r(42)},function(e,t,r){var i,a;void 0===(a="function"==typeof(i={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}})?i.call(t,r,t,e):i)||(e.exports=a)},function(e,t,r){"use strict";var i=r(0),a=r(1);let n=0;t.a=class extends i.a{constructor(e,...t){e=Object(a.l)(e),t=t.map(a.l);let r=void 0;if(e.type){if("float"!=e.type&&"category"!=e.type)throw new Error(`buckets(): invalid first parameter type\n\t'input' type was ${e.type}`);r=e.type}t.map((e,t)=>{if(e.type){if(r&&r!=e.type)throw new Error(`buckets(): invalid ${Object(a.i)(t)} parameter type`+`\n\texpected type was ${r}\n\tactual type was ${e.type}`);if("float"!=e.type&&"category"!=e.type)throw new Error(`buckets(): invalid ${Object(a.i)(t)} parameter type\n\ttype was ${e.type}`)}});let i={input:e};t.map((e,t)=>i[`arg${t}`]=e),super(i),this.bucketUID=n++,this.numCategories=t.length+1,this.args=t,this.type="category"}_compile(e){super._compile(e),this.othersBucket="category"==this.input.type;const t=this.input;if("float"!=t.type&&"category"!=t.type)throw new Error(`buckets(): invalid first parameter type\n\t'input' type was ${t.type}`);this.args.map((e,r)=>{if(t.type!=e.type)throw new Error(`buckets(): invalid ${Object(a.i)(r)} parameter type`+`\n\texpected type was ${t.type}\n\tactual type was ${e.type}`);if("float"!=e.type&&"category"!=e.type)throw new Error(`buckets(): invalid ${Object(a.i)(r)} parameter type\n\ttype was ${e.type}`)})}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};t.map((e,t)=>r[this.childrenNames[t]]=e.inline);const i=`buckets${this.bucketUID}`,a="category"==this.input.type?"==":"<",n=`float ${i}(float x){\n            ${this.args.map((e,t)=>`${t>0?"else":""} if (x${a}(${r[`arg${t}`]})){\n                return ${t}.;\n            }`).join("")}\n            return ${this.numCategories-1}.;\n        }`;return{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+n),inline:`${i}(${r.input})`}}eval(e){const t=this.input.eval(e);let r;for(r=0;r<this.args.length;r++){if("category"==this.input.type&&t==this.args[r].eval(e))return r;if("float"==this.input.type&&t<this.args[r].eval(e))return r}return r}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e,t,r){e=Object(a.l)(e),t=Object(a.l)(t),r=Object(a.l)(r),Object(a.b)("cielab","l",0,e),Object(a.b)("cielab","a",1,t),Object(a.b)("blend","b",2,r),Object(a.d)("cielab","l",0,"float",e),Object(a.d)("cielab","a",1,"float",t),Object(a.d)("cielab","b",2,"float",r),super({l:e,a:t,b:r}),this.type="color"}_compile(e){super._compile(e),Object(a.g)("cielab","l",0,"float",this.l),Object(a.g)("cielab","a",1,"float",this.a),Object(a.g)("cielab","b",2,"float",this.b),this._setGenericGLSL(e=>`vec4(xyztosrgb(cielabtoxyz(\n                vec3(\n                    clamp(${e.l}, 0., 100.),\n                    clamp(${e.a}, -128., 128.),\n                    clamp(${e.b}, -128., 128.)\n                )\n            )), 1)`,"\n        #ifndef cielabtoxyz_fn\n        #define cielabtoxyz_fn\n\n        const mat3 XYZ_2_RGB = (mat3(\n            3.2404542,-1.5371385,-0.4985314,\n           -0.9692660, 1.8760108, 0.0415560,\n            0.0556434,-0.2040259, 1.0572252\n       ));\n       const float SRGB_GAMMA = 1.0 / 2.2;\n\n       vec3 rgb_to_srgb_approx(vec3 rgb) {\n        return pow(rgb, vec3(SRGB_GAMMA));\n    }\n        float f1(float t){\n            const float sigma = 6./29.;\n            if (t>sigma){\n                return t*t*t;\n            }else{\n                return 3.*sigma*sigma*(t-4./29.);\n            }\n        }\n        vec3 cielabtoxyz(vec3 c) {\n            const float xn = 95.047/100.;\n            const float yn = 100./100.;\n            const float zn = 108.883/100.;\n            return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                        yn*f1((c.x+16.)/116.),\n                        zn*f1((c.x+16.)/116.  - c.z/200. )\n                    );\n        }\n        vec3 xyztorgb(vec3 c){\n            return c *XYZ_2_RGB;\n        }\n\n        vec3 xyztosrgb(vec3 c) {\n            return rgb_to_srgb_approx(xyztorgb(c));\n        }\n        #endif\n        ")}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e,t,r){e=Object(a.l)(e),t=Object(a.l)(t),r=Object(a.l)(r),Object(a.b)("linear","input",0,e),Object(a.b)("linear","min",1,t),Object(a.b)("linear","max",2,r),super({input:e,min:t,max:r}),"time"!=this.min.type&&(Object(a.d)("linear","input",0,"float",this.input),Object(a.d)("linear","min",1,"float",this.min),Object(a.d)("linear","max",2,"float",this.max)),this.type="float"}_compile(e){if(super._compile(e),"date"==this.input.type){const t=this.min.eval().getTime(),r=this.max.eval().getTime(),i=e.columns.find(e=>e.name==this.input.name).min.getTime(),a=e.columns.find(e=>e.name==this.input.name).max.getTime()-i,n=(t-i)/a,s=(r-i)/a;this.inlineMaker=(e=>`((${e.input}-(${n.toFixed(20)}))/(${(s-n).toFixed(20)}))`)}else Object(a.g)("linear","input",0,"float",this.input),Object(a.g)("linear","min",1,"float",this.min),Object(a.g)("linear","max",2,"float",this.max),this.inlineMaker=(e=>`((${e.input}-${e.min})/(${e.max}-${e.min}))`)}eval(e){const t=this.input.eval(e),r=this.min.eval(e);return(t-r)/(this.max.eval(e)-r)}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e,t,r,i){super({input:e=Object(a.l)(e),center:t=Object(a.l)(t),threshold:r=Object(a.l)(r),falloff:i=Object(a.l)(i)})}_compile(e){if(super._compile(e),"float"!=this.input.type||"float"!=this.center.type||"float"!=this.threshold.type||"float"!=this.falloff.type)throw new Error("Near(): invalid parameter type");this.type="float",this.inlineMaker=(e=>`(1.-clamp((abs(${e.input}-${e.center})-${e.threshold})/${e.falloff},0., 1.))`)}eval(e){const t=this.input.eval(e),r=this.center.eval(e),i=this.threshold.eval(e),n=this.falloff.eval(e);return 1-Object(a.h)((Math.abs(t-r)-i)/n,0,1)}}},function(e,t,r){"use strict";var i=r(0),a=r(2);t.a=class extends i.a{constructor(){super({now:Object(a.float)(0)})}_compile(e){super._compile(e),this.type="float",super.inlineMaker=(e=>e.now)}_preDraw(...e){this.now._preDraw(...e)}_setTimestamp(e){this.now.expr=e}isAnimated(){return!0}eval(){return this.now.expr}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e){if(Object(a.f)("name","name",0,e),""==e)throw new Error("variable(): invalid parameter, zero-length string");super({}),this.name=e}_resolveAliases(e){if(!e[this.name])throw new Error(`variable() name '${this.name}' doesn't exist`);this.childrenNames.push("alias"),this.alias=e[this.name]}_compile(e){this.alias._compile(e),this.type=this.alias.type}_applyToShaderSource(e){return this.alias._applyToShaderSource(e)}_getDependencies(){return[this.alias]}_getMinimumNeededSchema(){return this.alias._getMinimumNeededSchema()}eval(e){return this.alias.eval(e)}}},function(e,t,r){"use strict";var i=r(0),a=r(1),n=r(50);function s(e,t,r){const i=Object(n.b)({r:e.r,g:e.g,b:e.b,a:e.a}),a=Object(n.b)({r:t.r,g:t.g,b:t.b,a:t.a}),s={l:(1-r)*i.l+r*a.l,a:(1-r)*i.a+r*a.a,b:(1-r)*i.b+r*a.b,alpha:(1-r)*i.alpha+r*a.alpha};return Object(n.a)(s)}t.a=class extends i.a{constructor(e,t,...r){if(r.length>0)throw new Error("ramp(input, palette) only accepts two parameters");e=Object(a.l)(e),t=Object(a.l)(t),Object(a.b)("ramp","input",0,e),Object(a.d)("ramp","input",0,["float","category"],e),Object(a.g)("ramp","palette",1,["palette","customPalette","customPaletteFloat"],t),super({input:e}),this.minKey=0,this.maxKey=1,this.palette=t,"customPaletteFloat"==t.type?this.type="float":this.type="color"}_compile(e){super._compile(e),Object(a.g)("ramp","input",0,["float","category"],this.input),"category"==this.input.type&&(this.maxKey=this.input.numCategories-1)}_free(e){e.deleteTexture(this.texture)}_applyToShaderSource(e){const t=this.input._applyToShaderSource(e);return{preface:this._prefaceCode(t.preface+`\n        uniform sampler2D texRamp${this._uid};\n        uniform float keyMin${this._uid};\n        uniform float keyWidth${this._uid};\n        `),inline:"customPaletteFloat"==this.palette.type?`(texture2D(texRamp${this._uid}, vec2((${t.inline}-keyMin${this._uid})/keyWidth${this._uid}, 0.5)).a)`:`texture2D(texRamp${this._uid}, vec2((${t.inline}-keyMin${this._uid})/keyWidth${this._uid}, 0.5)).rgba`}}_getColorsFromPalette(e,t){if("palette"==t.type){let r;if(e.numCategories){const i=t.tags.includes("qualitative")&&!e.othersBucket?e.numCategories:e.numCategories-1;r=t.subPalettes[i]?t.subPalettes[i]:t.getLongestSubPalette()}else r=t.getLongestSubPalette();return t.tags.includes("qualitative")&&!e.othersBucket&&(r=r.slice(0,r.length-1)),r}return t.colors}_postShaderCompile(e,t){if(!this.init){this.init=!0,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture);const e=256;if("color"==this.type){const r=new Uint8Array(4*e),i=this._getColorsFromPalette(this.input,this.palette);for(let t=0;t<e;t++){const a=i[Math.floor(t/e*(i.length-1))],n=i[Math.ceil(t/e*(i.length-1))],o=[a.r/255,a.g/255,a.b/255,a.a],c=[n.r/255,n.g/255,n.b/255,n.a],f=t/e*(i.length-1)-Math.floor(t/e*(i.length-1)),u=s({r:o[0],g:o[1],b:o[2],a:o[3]},{r:c[0],g:c[1],b:c[2],a:c[3]},f);r[4*t+0]=255*u.r,r[4*t+1]=255*u.g,r[4*t+2]=255*u.b,r[4*t+3]=255*u.a}t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,1,0,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}else{const r=new Float32Array(e),i=this.palette.floats;for(let t=0;t<e;t++){const a=i[Math.floor(t/e*(i.length-1))],n=i[Math.ceil(t/e*(i.length-1))],s=t/e*(i.length-1)-Math.floor(t/e*(i.length-1));r[t]=(1-s)*a+s*n}t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,e,1,0,t.ALPHA,t.FLOAT,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}this.input._postShaderCompile(e,t),this._getBinding(e).texLoc=t.getUniformLocation(e,`texRamp${this._uid}`),this._getBinding(e).keyMinLoc=t.getUniformLocation(e,`keyMin${this._uid}`),this._getBinding(e).keyWidthLoc=t.getUniformLocation(e,`keyWidth${this._uid}`)}_preDraw(e,t,r){this.input._preDraw(e,t,r),r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e).texLoc,t.freeTexUnit),r.uniform1f(this._getBinding(e).keyMinLoc,this.minKey),r.uniform1f(this._getBinding(e).keyWidthLoc,this.maxKey-this.minKey),t.freeTexUnit++}}},function(e,t,r){"use strict";t.b=function(e){return function({x:e,y:t,z:r,a:i}){const o=a,c=n,f=s,u=e=>e>=.008856451679035631?Math.pow(e,.333333333333333):841/108*e+4/29;return{l:116*u(t/c)-16,a:500*(u(e/o)-u(t/c)),b:200*(u(t/c)-u(r/f)),alpha:i}}(function(e){const{r:t,g:r,b:i,a:a}=function({r:e,g:t,b:r,a:i}){const a=e=>e<=.0404482362771076?e/12.92:Math.pow((e+.055)/1.055,2.4);return{r:a(e),g:a(t),b:a(r),a:i}}(e);return{x:.41239558896741424*t+.3575834307637148*r+.18049264738170157*i,y:.21258623078559555*t+.7151703037034108*r+.07220049864333623*i,z:.019297215491746945*t+.11918386458084854*r+.9504971251315798*i,a:a}}(e))},t.a=function(e){return function({x:e,y:t,z:r,a:a}){const n=Object(i.h)(3.2406*e-1.5372*t-.4986*r,0,1),s=Object(i.h)(-.9689*e+1.8758*t+.0415*r,0,1),o=Object(i.h)(.0557*e-.204*t+1.057*r,0,1);return function({r:e,g:t,b:r,a:i}){const a=e=>e<=.0031306684425005883?12.92*e:1.055*Math.pow(e,.4166666666666667)-.055;return{r:a(e),g:a(t),b:a(r),a:i}}({r:n,g:s,b:o,a:a})}(function({l:e,a:t,b:r,alpha:i}){const o=e=>e>=.20689655172413793?e*e*e:108/841*(e-4/29);return{x:a*o((e+16)/116+t/500),y:n*o((e+16)/116),z:s*o((e+16)/116-r/200),a:i}}(e))};var i=r(1);const a=.950456,n=1,s=1.088754},function(e,t,r){"use strict";var i=r(0),a=r(2),n=r(1);t.a=class extends i.a{constructor(e,t){Number.isFinite(t)&&(t=Object(a.float)(t)),Object(n.d)("opacity","color",0,"color",e),Object(n.d)("opacity","alpha",1,"float",t),super({color:e,alpha:t}),this.type="color"}_compile(e){super._compile(e),Object(n.g)("opacity","color",0,"color",this.color),Object(n.g)("opacity","alpha",1,"float",this.alpha),this.inlineMaker=(e=>`vec4((${e.color}).rgb, ${e.alpha})`)}eval(e){const t=this.color.eval(e),r=this.alpha.eval(e);return t.a=r,t}}},function(e,t,r){"use strict";var i=r(0);t.a=class extends i.a{constructor(e,t){super({property:e}),this.buckets=t}_compile(e){if(super._compile(e),"category"!=this.property.type)throw new Error(`top() first argument must be of type category, but it is of type '${this.property.type}'`);this.type="category",this.numCategories=this.buckets+1,this.othersBucket=!0,this._meta=e}_applyToShaderSource(e){const t=this.property._applyToShaderSource(e);return{preface:this._prefaceCode(t.preface+`uniform sampler2D topMap${this._uid};\n`),inline:`(255.*texture2D(topMap${this._uid}, vec2(${t.inline}/1024., 0.5)).a)`}}eval(e){const t=this.property.eval(e);let r;return this._meta.columns.find(e=>e.name==this.property.name).categoryNames.map((e,i)=>{i==t&&(r=i<this.buckets?i+1:0)}),r}_postShaderCompile(e,t){if(!this.init){this.buckets>this.property.numCategories&&(this.buckets=this.property.numCategories),this.init=!0,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture);const e=1024;let r=new Uint8Array(4*e);this._meta.columns.find(e=>e.name==this.property.name).categoryNames.map((e,t)=>{t<this.buckets&&(r[4*this._meta.categoryIDs[e]+3]=t+1)}),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,1,0,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}this.property._postShaderCompile(e),this._getBinding(e)._texLoc=t.getUniformLocation(e,`topMap${this._uid}`)}_preDraw(e,t,r){this.property._preDraw(e,t),r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e)._texLoc,t.freeTexUnit),t.freeTexUnit++}}},function(e,t,r){"use strict";var i=r(0),a=r(1);t.a=class extends i.a{constructor(e,t,r){super({x:e=Object(a.l)(e),y:t=Object(a.l)(t),z:r=Object(a.l)(r)})}_compile(e){if(super._compile(e),"float"!=this.x.type||"float"!=this.y.type||"float"!=this.z.type)throw new Error("XYZ() invalid parameters");this.type="color",this._setGenericGLSL(e=>`vec4(xyztosrgb((\n                vec3(\n                    clamp(${e.x}, -100000., 10000.),\n                    clamp(${e.y}, -12800., 12800.),\n                    clamp(${e.z}, -12800., 12800.)\n                )\n            )), 1)`,"\n        #ifndef cielabtoxyz_fn\n        #define cielabtoxyz_fn\n\n        const mat3 XYZ_2_RGB = (mat3(\n            3.2404542,-1.5371385,-0.4985314,\n           -0.9692660, 1.8760108, 0.0415560,\n            0.0556434,-0.2040259, 1.0572252\n       ));\n       const mat3 XYZ_2_RGB_T = (mat3(\n        3.2404542,-0.9692660,0.0556434,\n        -1.5371385, 1.8760108, -0.2040259,\n        -0.4985314,0.0415560, 1.0572252\n   ));\n       const float SRGB_GAMMA = 1.0 / 2.2;\n\n       vec3 rgb_to_srgb_approx(vec3 rgb) {\n        return pow(rgb, vec3(SRGB_GAMMA));\n    }\n        float f1(float t){\n            const float sigma = 6./29.;\n            if (t>sigma){\n                return t*t*t;\n            }else{\n                return 3.*sigma*sigma*(t-4./29.);\n            }\n        }\n        vec3 cielabtoxyz(vec3 c) {\n            const float xn = 95.047;\n            const float yn = 100.;\n            const float zn = 108.883;\n            return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                        yn*f1((c.x+16.)/116.),\n                        zn*f1((c.x+16.)/116.  - c.z/200. )\n                    );\n        }\n        vec3 xyztorgb(vec3 c){\n            return c * XYZ_2_RGB;\n        }\n\n        vec3 xyztosrgb(vec3 c) {\n            return rgb_to_srgb_approx(xyztorgb(c));\n        }\n        #endif\n        ")}}},function(e,t,r){"use strict";var i=r(0),a=r(2);t.a=class extends i.a{constructor(){super({zoom:Object(a.float)(0)}),this.type="float"}_compile(e){super._compile(e),super.inlineMaker=(e=>e.zoom)}_preDraw(e,t,r){this.zoom.expr=t.zoom,this.zoom._preDraw(e,t,r)}eval(){return this.zoom.expr}}},function(e,t,r){"use strict";var i=r(0);t.a=class extends i.a{constructor(e){e instanceof Date||(e=new Date(e)),super({}),this.type="time",this.date=e,this.inlineMaker=(()=>void 0)}isAnimated(){return!1}eval(){return this.date}}},function(e,t,r){"use strict";var i=r(0),a=r(2),n=r(1),s=r(9),o=r(7);let c=0;function f(e){return class extends i.a{constructor(e,t){Object(n.c)("quantiles","input",0,s.a,e&&(e.property||e)),Object(n.e)("quantiles","buckets",1,t);let r={input:e},i=[];for(let e=0;e<t-1;e++)r[`arg${e}`]=Object(a.float)(10*e),i.push(r[`arg${e}`]);super(r),this.quantilesUID=c++,this.numCategories=t,this.buckets=t,this.breakpoints=i,this.type="category"}eval(e){const t=this.input.eval(e);return this.breakpoints.findIndex(e=>t<=e)}getBreakpointList(){return this.breakpoints.map(e=>e.expr)}_compile(t){if(super._compile(t),Object(n.g)("quantiles","input",0,"float",this.input),e){const e=t.sample.map(e=>e[this.input.name]);e.sort((e,t)=>e-t),this.breakpoints.map((t,r)=>{const i=(r+1)/this.buckets;t.expr=e[Math.floor(i*e.length)]})}}_getDrawMetadataRequirements(){return{columns:[this._getColumnName()]}}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};t.map((e,t)=>r[this.childrenNames[t]]=e.inline);const i=`quantiles${this.quantilesUID}`,a=`float ${i}(float x){\n        ${this.breakpoints.map((e,t)=>`${t>0?"else":""} if (x<(${r[`arg${t}`]})){\n            return ${t.toFixed(2)};\n        }`).join("")}\n        return ${this.breakpoints.length.toFixed(1)};\n    }`;return{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+a),inline:`${i}(${r.input})`}}_preDraw(t,r,i){const a=this._getColumnName(),n=r.columns.find(e=>e.name==a);let s=0;const o=n.accumHistogram[n.histogramBuckets-1];let c=[];e||this.breakpoints.map((e,t)=>{for(;s<n.histogramBuckets&&!(n.accumHistogram[s]>=(t+1)/this.buckets*o);s++);const r=s/n.histogramBuckets*(n.max-n.min)+n.min;c.push(r),e.expr=r}),super._preDraw(t,r,i)}_getColumnName(){return this.input.aggName?o.column.aggColumn(this.input.name,this.input.aggName):this.input.name}}}const u=f(!1);t.b=u;const l=f(!0);t.a=l},function(e,t,r){"use strict";var i=r(0),a=r(1),n=r(2),s=r(9);const o=.15;class c extends i.a{constructor(e=a.a,t=a.a){let r=e,i=t;e==a.a&&(r=o),t==a.a&&(i=r),super({fadeIn:r=Object(a.l)(r),fadeOut:i=Object(a.l)(i)}),this.type="fade",this.inlineMaker=(e=>({in:e.fadeIn,out:e.fadeOut}))}}t.a=c;t.b=class extends i.a{constructor(e,t=10,r=new c){if(!Number.isFinite(t))throw new Error("Torque(): invalid second parameter, duration.");e instanceof s.a&&(e=Object(n.linear)(e,Object(n.globalMin)(e),Object(n.globalMax)(e))),super({input:e,_cycle:Object(n.floatDiv)(Object(n.floatMod)(Object(n.now)(),t),t),fade:r}),this.duration=t}_compile(e){if(super._compile(e),"float"!=this.input.type)throw new Error("Torque(): invalid first parameter, input.");if("fade"!=this.fade.type)throw new Error("Torque(): invalid third parameter, fade.");this.type="float",this.inlineMaker=(e=>`(1.- clamp(abs(${e.input}-${e._cycle})*(${this.duration.toFixed(20)})/(${e.input}>${e._cycle}? ${e.fade.in}: ${e.fade.out}), 0.,1.) )`)}getSimTime(){if(!(this.input.min.eval()instanceof Date))return null;const e=this._cycle.eval(),t=this.input.min.eval(),r=this.input.max.eval(),i=t.getTime(),a=r.getTime()*e+(1-e)*i,n=new Date;return n.setTime(a),n}eval(e){const t=this.input.eval(e),r=this._cycle.eval(e),i=this.duration,n=this.fade.fadeIn.eval(e),s=this.fade.fadeOut.eval(e);return 1-Object(a.h)(Math.abs(t-r)*i/(t>r?n:s),0,1)}}},function(e,t,r){"use strict";var i=r(0),a=r(1);const n=o("rgba",!0);t.b=n;const s=o("rgb",!1);function o(e,t){return class extends i.a{constructor(r,i,n,s){[r,i,n,s]=[r,i,n,s].map(a.l),Object(a.d)(e,"r",0,"float",r),Object(a.d)(e,"g",1,"float",i),Object(a.d)(e,"b",2,"float",n);const o={r:r,g:i,b:n};t&&(Object(a.d)(e,"a",3,"float",s),o.a=s),super(o),this.type="color"}_compile(r){super._compile(r),Object(a.g)(e,"r",0,"float",this.r),Object(a.g)(e,"g",1,"float",this.g),Object(a.g)(e,"b",2,"float",this.b),t&&Object(a.g)("rgba","a",3,"float",this.a),this.inlineMaker=(e=>`vec4(${e.r}/255., ${e.g}/255., ${e.b}/255., ${t?e.a:"1."})`)}eval(e){return{r:this.r.eval(e),g:this.g.eval(e),b:this.b.eval(e),a:t?this.a.eval(e):1}}}}t.a=s},function(e,t,r){"use strict";var i=r(0),a=r(1);const n=o("hsv",!1);t.a=n;const s=o("hsva",!0);function o(e,t){return class extends i.a{constructor(i,n,s,o){const c={h:i=Object(a.l)(i),s:n=Object(a.l)(n),v:s=Object(a.l)(s)};t&&(o=Object(a.l)(o),Object(a.d)(e,"a",3,"float",o),c.a=o),r("h",0,i),r("s",1,n),r("v",2,s),super(c),this.type="color"}_compile(e){super._compile(e),r("h",0,this.h),r("s",1,this.s),r("v",2,this.v),t&&Object(a.g)("hsva","a",3,"float",this.a);const i=(e,t=!1)=>"category"==e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSVtoRGB(vec3(\n                    ${e.h}${i(this.h,!0)},\n                    clamp(${e.s}${i(this.s)}, 0.,1.),\n                    clamp(${e.v}${i(this.v)}, 0.,1.)\n                )), ${t?`clamp(${e.a}, 0.,1.)`:"1."})`,"\n    #ifndef HSV2RGB\n    #define HSV2RGB\n    vec3 HSVtoRGB(vec3 HSV) {\n      float R = abs(HSV.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSV.x * 6. - 2.);\n      float B = 2. - abs(HSV.x * 6. - 4.);\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return ((RGB - 1.) * HSV.y + 1.) * HSV.z;\n    }\n    #endif\n    ")}eval(e){const r=(t,r=!1)=>"category"==t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,i,n)=>{const s={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?Object(a.h)(this.a.eval(e),0,1):1};return s.r=Object(a.h)(s.r,0,1),s.g=Object(a.h)(s.g,0,1),s.b=Object(a.h)(s.b,0,1),s.r=((s.r-1)*i+1)*n*255,s.g=((s.g-1)*i+1)*n*255,s.b=((s.b-1)*i+1)*n*255,s})(Object(a.h)(r(this.h,!0),0,1),Object(a.h)(r(this.s),0,1),Object(a.h)(r(this.v),0,1))}};function r(t,r,i){if(Object(a.b)(e,t,r,i),"float"!=i.type&&"category"!=i.type&&void 0!==i.type)throw new Error(`${e}(): invalid parameter\n\t${t} type was: '${i.type}'`)}}t.b=s},function(e,t,r){"use strict";var i=r(0),a=r(1);const n=o("hsl",!1);t.a=n;const s=o("hsla",!0);function o(e,t){return class extends i.a{constructor(i,n,s,o){[i,n,s,o]=[i,n,s,o].map(a.l);const c={h:i,s:n,l:s};t&&(Object(a.d)(e,"a",3,"float",o),c.a=o),r("h",0,i),r("s",1,n),r("l",2,s),super(c),this.type="color"}_compile(e){super._compile(e),r("h",0,this.h),r("s",1,this.s),r("l",2,this.l),t&&Object(a.g)("hsla","a",3,"float",this.a);const i=(e,t=!1)=>"category"==e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSLtoRGB(vec3(\n                    ${e.h}${i(this.h,!0)},\n                    clamp(${e.s}${i(this.s)}, 0., 1.),\n                    clamp(${e.l}${i(this.l)}, 0., 1.)\n                )), ${t?`clamp(${e.a}, 0., 1.)`:"1."})`,"\n    #ifndef HSL2RGB\n    #define HSL2RGB\n    vec3 HSLtoRGB(vec3 HSL) {\n      float R = abs(HSL.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSL.x * 6. - 2.);\n      float B = 2. - abs(HSL.x * 6. - 4.);\n      float C = (1. - abs(2. * HSL.z - 1.)) * HSL.y;\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return (RGB - 0.5) * C + HSL.z;\n    }\n    #endif\n    ")}eval(e){const r=(t,r=!1)=>"category"==t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,i,n)=>{const s={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?this.a.eval(e):1},o=(1-Math.abs(2*n-1))*i;return s.r=Object(a.h)(s.r,0,1),s.g=Object(a.h)(s.g,0,1),s.b=Object(a.h)(s.b,0,1),s.r=255*((s.r-.5)*o+n),s.g=255*((s.g-.5)*o+n),s.b=255*((s.b-.5)*o+n),s})(Object(a.h)(r(this.h,!0),0,1),Object(a.h)(r(this.s),0,1),Object(a.h)(r(this.l),0,1))}};function r(t,r,i){if(Object(a.b)(e,t,r,i),"float"!=i.type&&"category"!=i.type&&void 0!==i.type)throw new Error(`${e}(): invalid parameter\n\t${t} type was: '${i.type}'`)}}t.b=s},function(e,t,r){"use strict";var i=r(0),a=r(2),n=r(7);const s=y("max");t.i=s;const o=y("min");t.j=o;const c=y("avg");t.g=c;const f=y("sum");t.l=f;const u=y("count");t.h=u;const l=y("max",!0);t.c=l;const h=y("min",!0);t.d=h;const d=y("avg",!0);t.a=d;const p=y("sum",!0);t.f=p;const b=y("count",!0);t.b=b;const g=_();t.k=g;const m=_(!0);function y(e,t){return class extends i.a{constructor(e){super({value:Object(a.float)(0)}),this.property=e}eval(){return this.value.expr}_compile(r){super._compile(r),this.property._compile(r),this.type="float",super.inlineMaker=(e=>e.value),t&&(this.value.expr=r.columns.find(e=>e.name===this.property.name)[e])}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_getDrawMetadataRequirements(){return t?{columns:[]}:{columns:[this._getColumnName()]}}_updateDrawMetadata(r){const i=this._getColumnName(),a=r.columns.find(e=>e.name===i);t||(this.value.expr=a[e])}_getColumnName(){return this.property.aggName?n.column.aggColumn(this.property.name,this.property.aggName):this.property.name}}}function _(e){return class extends i.a{constructor(e,t){if(!Number.isFinite(t))throw new Error("Percentile must be a fixed literal number");super({value:Object(a.float)(0)}),this.property=e,this.percentile=t}_compile(t){if(super._compile(t),this.property._compile(t),this.type="float",super.inlineMaker=(e=>e.value),e){const e=t.sample.map(e=>e[this.property.name]);e.sort((e,t)=>e-t);const r=this.percentile/100;this.value.expr=e[Math.floor(r*e.length)]}}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_getDrawMetadataRequirements(){return e?{columns:[]}:{columns:[this._getColumnName()]}}_preDraw(t,r,i){const a=this._getColumnName();if(!e){const e=r.columns.find(e=>e.name===a),t=e.accumHistogram[e.histogramBuckets-1];for(var n=0;n<e.histogramBuckets&&!(e.accumHistogram[n]>=this.percentile/100*t);n++);const i=n/e.histogramBuckets*(e.max-e.min)+e.min;this.value.expr=i}this.value._preDraw(t,r,i)}eval(){return this.value.expr}_getColumnName(){return this.property.aggName?n.column.aggColumn(this.property.name,this.property.aggName):this.property.name}}}t.e=m},function(e,t,r){"use strict";var i=r(0),a=r(1);class n extends i.a{constructor(){super({}),this.type="propertyReference"}}t.d=n;t.a=class extends i.a{constructor(e){super({}),Object(a.c)("asc","by",0,n,e),this.type="orderer"}};t.b=class extends i.a{constructor(e){super({}),Object(a.c)("desc","by",0,n,e),this.type="orderer"}};t.c=class extends i.a{constructor(){super({}),this.type="orderer"}}},function(e,t,r){"use strict";var i=r(13),a=r(10),n=r(11),s=r(4),o=r(6),c=r(26);const f=1e3;class u extends i.a{constructor(e){super(),this._checkData(e),this._type="",this._categoryStringToIDMap={},this._numCategories=0,this._numFields=[],this._catFields=[],this._data=e,this._features=this._getFeatures(e),this._metadata=this._computeMetadata(),this._loaded=!1}_clone(){return new u(this._data)}bindLayer(e,t,r){this._addDataframe=e,this._removeDataframe=t,this._dataLoadedCallback=r}requestMetadata(){return Promise.resolve(this._metadata)}requestData(){if(this._loaded)return;this._loaded=!0;const e=new a.a({active:!0,center:{x:0,y:0},geom:this._decodeGeometry(),properties:this._decodeProperties(),scale:1,size:this._features.length,type:this._getDataframeType(this._type),metadata:this._metadata});this._addDataframe(e),this._dataLoadedCallback()}_checkData(e){if(s.f(e))throw new o.a("source","dataRequired");if(!s.d(e))throw new o.a("source","dataObjectRequired")}_getFeatures(e){let t=JSON.parse(JSON.stringify(e));if("FeatureCollection"===t.type)return this._addCartodbId(t.features);if("Feature"===t.type)return this._addCartodbId([t]);throw new o.a("source","nonValidGeoJSONData")}_addCartodbId(e){return e.map((e,t)=>(this._checkFeature(e),e.properties.cartodb_id=t,e))||[]}_checkFeature(e){if(e.properties&&e.properties.cartodb_id)throw new o.a("source","featureHasCartodbId")}_computeMetadata(){const e={},t=[],r=[],i=this._features.length;for(var a=0;a<this._features.length;a++){const e=this._features[a].properties;Object.keys(e).map(r=>{const i=e[r];Number.isFinite(i)?this._addNumericPropertyToMetadata(r,i,t):this._addCategoryPropertyToMetadata(r,i,t)}),this._sampleFeatureOnMetadata(e,r,this._features.length)}return this._numFields.map(e=>{const r=t.find(t=>t.name==e);r.avg=r.sum/r.count}),this._catFields.map(r=>{t.find(e=>e.name==r).categoryNames.map(t=>e[t]=this._getCategoryIDFromString(t))}),this._metadata=new c.a(e,t,i,r),this._metadata}_sampleFeatureOnMetadata(e,t,r){if(r>f){const e=f/r;if(Math.random()>e)return}t.push(e)}_addNumericPropertyToMetadata(e,t,r){if(this._catFields.includes(e))throw new Error(`Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._numFields.includes(e)||(this._numFields.push(e),r.push({name:e,type:"float",min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,avg:Number.NaN,sum:0,count:0}));const i=r.find(t=>t.name==e);i.min=Math.min(i.min,t),i.max=Math.max(i.max,t),i.sum+=t,i.count++}_addCategoryPropertyToMetadata(e,t,r){if(this._numFields.includes(e))throw new Error(`Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._catFields.includes(e)||(this._catFields.push(e),r.push({name:e,type:"category",categoryNames:[],categoryCounts:[]}));const i=r.find(t=>t.name==e);i.categoryNames.includes(t)||(i.categoryNames.push(t),i.categoryCounts.push(0)),i.categoryCounts[i.categoryNames.indexOf(t)]++}_decodeProperties(){const e={};this._numFields.concat(this._catFields).map(t=>{e[t]=new Float32Array(this._features.length+1024)});for(var t=0;t<this._features.length;t++){const r=this._features[t];this._catFields.map(i=>{e[i][t]=this._getCategoryIDFromString(r.properties[i])}),this._numFields.map(i=>{e[i][t]=Number(r.properties[i])})}return e}_getCategoryIDFromString(e){return void 0!==this._categoryStringToIDMap[e]?this._categoryStringToIDMap[e]:(this._categoryStringToIDMap[e]=this._numCategories,this._numCategories++,this._categoryStringToIDMap[e])}_getDataframeType(e){switch(e){case"Point":return"point";case"LineString":case"MultiLineString":return"line";case"Polygon":case"MultiPolygon":return"polygon";default:return""}}_decodeGeometry(){let e=null;const t=this._features.length;for(let r=0;r<t;r++){const i=this._features[r];if("Feature"===i.type){const a=i.geometry.type,n=i.geometry.coordinates;if(this._type){if(this._type!==a)throw new o.a("source",`multipleFeatureTypes[${this._type}, ${a}]`)}else this._type=a;if("Point"===a){e||(e=new Float32Array(2*t));const i=this._computePointGeometry(n);e[2*r+0]=i.x,e[2*r+1]=i.y}else if("LineString"===a){e||(e=[]);const t=this._computeLineStringGeometry(n);e.push([t])}else if("MultiLineString"===a){e||(e=[]);const t=this._computeMultiLineStringGeometry(n);e.push(t)}else if("Polygon"===a){e||(e=[]);const t=this._computePolygonGeometry(n);e.push([t])}else if("MultiPolygon"===a){e||(e=[]);const t=this._computeMultiPolygonGeometry(n);e.push(t)}}}return e}_computePointGeometry(e){const t=e[1],r=e[0],i=s.g({lat:t,lng:r});return n.c(i.x,i.y,{scale:s.b,center:{x:0,y:0}})}_computeLineStringGeometry(e){let t=[];for(let r=0;r<e.length;r++){const i=this._computePointGeometry(e[r]);t.push(i.x,i.y)}return t}_computeMultiLineStringGeometry(e){let t=[];for(let r=0;r<e.length;r++){let i=this._computeLineStringGeometry(e[r]);i.length>0&&t.push(i)}return t}_computePolygonGeometry(e){let t={flat:[],holes:[]},r=0;for(let i=0;i<e.length;i++){for(let r=0;r<e[i].length;r++){const a=this._computePointGeometry(e[i][r]);t.flat.push(a.x,a.y)}if(!this._isClockWise(e[i])){if(!(i>0))throw new o.a("source","firstPolygonExternal");r+=e[i-1].length,t.holes.push(r)}}return t}_computeMultiPolygonGeometry(e){let t=[];for(let r=0;r<e.length;r++){let i=this._computePolygonGeometry(e[r]);i.flat.length>0&&t.push(i)}return t}_isClockWise(e){let t,r=0,i=e[0];for(let a=0;a<e.length-1;a++)r+=((t=e[a+1])[1]-i[1])*(t[0]+i[0]),i=t;return r>=0}free(){}}t.a=u},function(e,t,r){"use strict";var i=r(65),a=r(66),n=r(67);r.d(t,"b",function(){return i}),r.d(t,"c",function(){return a}),r.d(t,"a",function(){return n})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VS="\n\nprecision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform float devicePixelRatio;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D colorStrokeTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n//TODO order bucket texture\n\nvarying highp vec4 color;\nvarying highp vec4 stroke;\nvarying highp float dp;\nvarying highp float sizeNormalizer;\nvarying highp float fillScale;\nvarying highp float strokeScale;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x){\n    x*=255.;\n    if (x < 64.){\n        return x*0.25;\n    }else if (x<128.){\n        return (x-64.)+16.;\n    }else{\n        return (x-127.)*2.+80.;\n    }\n}\n\nvoid main(void) {\n    color = texture2D(colorTex, featureID);\n    stroke = texture2D(colorStrokeTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n    stroke.a *= filtering;\n\n    float size = decodeWidth(texture2D(widthTex, featureID).a);\n    float fillSize = size;\n    float strokeSize = decodeWidth(texture2D(strokeWidthTex, featureID).a);\n    size+=strokeSize;\n    fillScale=size/fillSize;\n    strokeScale=size/max(0.001, (fillSize-strokeSize));\n    if (fillScale==strokeScale){\n        stroke.a=0.;\n    }\n    if (size > 126.){\n        size = 126.;\n    }\n    gl_PointSize = size * devicePixelRatio + 2.;\n    dp = 1.0/(size+1.);\n    sizeNormalizer = (size+1.)/(size);\n\n    vec4 p = vec4(vertexScale*vertexPosition-vertexOffset, 0.5, 1.);\n    if (size==0. || (stroke.a==0. && color.a==0.) || size<orderMinWidth || size>=orderMaxWidth){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}";t.FS="\nprecision highp float;\n\nvarying lowp vec4 color;\nvarying lowp vec4 stroke;\nvarying highp float dp;\nvarying highp float sizeNormalizer;\nvarying highp float fillScale;\nvarying highp float strokeScale;\n\nfloat distanceAntialias(vec2 p){\n    return 1. - smoothstep(1.-dp*1.4142, 1.+dp*1.4142, length(p));\n}\n\n\nvoid main(void) {\n    vec2 p = (2.*gl_PointCoord-vec2(1.))*sizeNormalizer;\n    vec4 c = color;\n\n    vec4 s = stroke;\n\n    c.a *= distanceAntialias(p*fillScale);\n    c.rgb*=c.a;\n\n    s.a *= distanceAntialias(p);\n    s.a *= 1.-distanceAntialias((strokeScale)*p);\n    s.rgb*=s.a;\n\n    c=s+(1.-s.a)*c;\n\n    gl_FragColor = c;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VS="\n\nprecision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\n\nuniform sampler2D colorTex;\nuniform sampler2D filterTex;\n\nvarying highp vec4 color;\n\n\nvoid main(void) {\n    vec4 c = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    c.a *= filtering;\n    vec4 p = vec4(vertexScale*vertexPosition-vertexOffset, 0.5, 1.);\n    if (c.a==0.){\n        p.x=10000.;\n    }\n    color = vec4(c.rgb*c.a, c.a);\n    gl_Position  = p;\n}";t.FS="\nprecision highp float;\n\nvarying highp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VS="\n\nprecision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform vec2 normalScale;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x){\n    x*=255.;\n    if (x < 64.){\n        return x*0.25;\n    }else if (x<128.){\n        return (x-64.)+16.;\n    }else{\n        return (x-127.)*2.+80.;\n    }\n}\n\nvoid main(void) {\n    color = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n    color.rgb *= color.a;\n    float size = decodeWidth(texture2D(widthTex, featureID).a);\n\n    vec4 p = vec4(vertexScale*(vertexPosition)+normalScale*normal*size-vertexOffset, 0.5, 1.);\n    if (size==0. || color.a==0.){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}";t.FS="\nprecision highp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VS="\n\nprecision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n";t.FS="\n\nprecision highp float;\n\nvarying vec2 uv;\n\n$PREFACE\n\nvoid main(void) {\n    vec2 featureID = uv;\n    gl_FragColor = $INLINE;\n}\n"},function(e,t,r){"use strict";t.b="\n\nprecision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n";t.a="\n\nprecision highp float;\n\nvarying  vec2 uv;\n\nuniform sampler2D aaTex;\n\nvoid main(void) {\n    vec4 aa = texture2D(aaTex, uv);\n    gl_FragColor = aa;\n}\n"},function(e,t,r){"use strict";t.a=class{constructor(){this.caches=new WeakMap}get(e,t){if(this.caches.has(e)){let r=this.caches.get(e);if(r[t])return r[t]}}set(e,t,r){if(this.caches.has(e))this.caches.get(e)[t]=r;else{let i=new WeakMap;i[t]=r,this.caches.set(e,i)}}has(e,t){return void 0!==this.get(e,t)}}},function(e,t,r){"use strict";var i=r(72);r.n(i);function a(e,t){const r=t[0]-e[0];return s([-(t[1]-e[1]),r])}function n(e,t,r){const i=s([e[0]-t[0],e[1]-t[1]]),a=s([r[0]-t[0],r[1]-t[1]]),n=-i[1]*a[0]+i[0]*a[1];if(0!==n)return[(i[0]+a[0])/n,(i[1]+a[1])/n]}function s(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}t.a={decodeGeom:function(e,t){if("point"==e)return{vertices:t,breakpoints:[]};if("polygon"==e)return function(e){let t=[],r=[];return e.map(e=>{e.map(e=>{i(e.flat,e.holes).map(r=>{t.push(e.flat[2*r]),t.push(e.flat[2*r+1])})}),r.push(t.length)}),{vertices:new Float32Array(t),breakpoints:r}}(t);if("line"==e)return function(e){let t=[],r=[],i=[];return e.map(e=>{e.map(e=>{for(let i=0;i<e.length-2;i+=2){const s=[e[i+0],e[i+1]],o=[e[i+2],e[i+3]],c=a(o,s);let f=c,u=c;i>0&&(f=n([e[i-2],e[i-1]],s,o)||f),i<e.length-4&&(u=n(s,o,[e[i+4],e[i+5]])||u),r.push(-f[0],-f[1]),r.push(f[0],f[1]),r.push(-u[0],-u[1]),t.push(s[0],s[1]),t.push(s[0],s[1]),t.push(o[0],o[1]),r.push(f[0],f[1]),r.push(u[0],u[1]),r.push(-u[0],-u[1]),t.push(s[0],s[1]),t.push(o[0],o[1]),t.push(o[0],o[1])}}),i.push(t.length)}),{vertices:new Float32Array(t),breakpoints:i,normals:new Float32Array(r)}}(t);throw new Error(`Unimplemented geometry type: '${e}'`)}}},function(e,t,r){"use strict";function i(e,t,r){r=r||2;var i,o,c,f,u,d,b,g=t&&t.length,m=g?t[0]*r:e.length,y=a(e,0,m,r,!0),_=[];if(!y)return _;if(g&&(y=function(e,t,r,i){var s,o,c,f,u,d=[];for(s=0,o=t.length;s<o;s++)c=t[s]*i,f=s<o-1?t[s+1]*i:e.length,(u=a(e,c,f,i,!1))===u.next&&(u.steiner=!0),d.push(p(u));for(d.sort(l),s=0;s<d.length;s++)h(d[s],r),r=n(r,r.next);return r}(e,t,y,r)),e.length>80*r){i=c=e[0],o=f=e[1];for(var v=r;v<m;v+=r)u=e[v],d=e[v+1],u<i&&(i=u),d<o&&(o=d),u>c&&(c=u),d>f&&(f=d);b=0!==(b=Math.max(c-i,f-o))?1/b:0}return s(y,_,r,i,o,b),_}function a(e,t,r,i,a){var n,s;if(a===C(e,t,r,i)>0)for(n=t;n<r;n+=i)s=w(n,e[n],e[n+1],s);else for(n=r-i;n>=t;n-=i)s=w(n,e[n],e[n+1],s);return s&&y(s,s.next)&&(E(s),s=s.next),s}function n(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!y(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(E(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function s(e,t,r,i,a,l,h){if(e){!h&&l&&function(e,t,r,i){var a=e;do{null===a.z&&(a.z=d(a.x,a.y,t,r,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,r,i,a,n,s,o,c,f=1;do{for(r=e,e=null,n=null,s=0;r;){for(s++,i=r,o=0,t=0;t<f&&(o++,i=i.nextZ);t++);for(c=f;o>0||c>0&&i;)0!==o&&(0===c||!i||r.z<=i.z)?(a=r,r=r.nextZ,o--):(a=i,i=i.nextZ,c--),n?n.nextZ=a:e=a,a.prevZ=n,n=a;r=i}n.nextZ=null,f*=2}while(s>1)}(a)}(e,i,a,l);for(var p,b,g=e;e.prev!==e.next;)if(p=e.prev,b=e.next,l?c(e,i,a,l):o(e))t.push(p.i/r),t.push(e.i/r),t.push(b.i/r),E(e),e=b.next,g=b.next;else if((e=b)===g){h?1===h?s(e=f(e,t,r),t,r,i,a,l,2):2===h&&u(e,t,r,i,a,l):s(n(e),t,r,i,a,l,1);break}}}function o(e){var t=e.prev,r=e,i=e.next;if(m(t,r,i)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(b(t.x,t.y,r.x,r.y,i.x,i.y,a.x,a.y)&&m(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function c(e,t,r,i){var a=e.prev,n=e,s=e.next;if(m(a,n,s)>=0)return!1;for(var o=a.x<n.x?a.x<s.x?a.x:s.x:n.x<s.x?n.x:s.x,c=a.y<n.y?a.y<s.y?a.y:s.y:n.y<s.y?n.y:s.y,f=a.x>n.x?a.x>s.x?a.x:s.x:n.x>s.x?n.x:s.x,u=a.y>n.y?a.y>s.y?a.y:s.y:n.y>s.y?n.y:s.y,l=d(o,c,t,r,i),h=d(f,u,t,r,i),p=e.prevZ,g=e.nextZ;p&&p.z>=l&&g&&g.z<=h;){if(p!==e.prev&&p!==e.next&&b(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&b(a.x,a.y,n.x,n.y,s.x,s.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=l;){if(p!==e.prev&&p!==e.next&&b(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=h;){if(g!==e.prev&&g!==e.next&&b(a.x,a.y,n.x,n.y,s.x,s.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function f(e,t,r){var i=e;do{var a=i.prev,n=i.next.next;!y(a,n)&&_(a,i,i.next,n)&&v(a,n)&&v(n,a)&&(t.push(a.i/r),t.push(i.i/r),t.push(n.i/r),E(i),E(i.next),i=e=n),i=i.next}while(i!==e);return i}function u(e,t,r,i,a,o){var c=e;do{for(var f=c.next.next;f!==c.prev;){if(c.i!==f.i&&g(c,f)){var u=x(c,f);return c=n(c,c.next),u=n(u,u.next),s(c,t,r,i,a,o),void s(u,t,r,i,a,o)}f=f.next}c=c.next}while(c!==e)}function l(e,t){return e.x-t.x}function h(e,t){if(t=function(e,t){var r,i=t,a=e.x,n=e.y,s=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=a&&o>s){if(s=o,o===a){if(n===i.y)return i;if(n===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(a===s)return r.prev;var c,f=r,u=r.x,l=r.y,h=1/0;i=r.next;for(;i!==f;)a>=i.x&&i.x>=u&&a!==i.x&&b(n<l?a:s,n,u,l,n<l?s:a,n,i.x,i.y)&&((c=Math.abs(n-i.y)/(a-i.x))<h||c===h&&i.x>r.x)&&v(i,e)&&(r=i,h=c),i=i.next;return r}(e,t)){var r=x(t,e);n(r,r.next)}}function d(e,t,r,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function b(e,t,r,i,a,n,s,o){return(a-s)*(t-o)-(e-s)*(n-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(n-o)-(a-s)*(i-o)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&_(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var r=e,i=!1,a=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&a<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,r,i){return!!(y(e,t)&&y(r,i)||y(e,i)&&y(r,t))||m(e,t,r)>0!=m(e,t,i)>0&&m(r,i,e)>0!=m(r,i,t)>0}function v(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function x(e,t){var r=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),a=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function w(e,t,r,i){var a=new T(e,t,r);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,i){for(var a=0,n=t,s=r-i;n<r;n+=i)a+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return a}e.exports=i,e.exports.default=i,i.deviation=function(e,t,r,i){var a=t&&t.length,n=a?t[0]*r:e.length,s=Math.abs(C(e,0,n,r));if(a)for(var o=0,c=t.length;o<c;o++){var f=t[o]*r,u=o<c-1?t[o+1]*r:e.length;s-=Math.abs(C(e,f,u,r))}var l=0;for(o=0;o<i.length;o+=3){var h=i[o]*r,d=i[o+1]*r,p=i[o+2]*r;l+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var n=0;n<e[a].length;n++)for(var s=0;s<t;s++)r.vertices.push(e[a][n][s]);a>0&&(i+=e[a-1].length,r.holes.push(i))}return r}},function(e,t,r){"use strict";r.d(t,"a",function(){return s});var i=r(74);const a="unexpected error",n="generic";class s extends Error{constructor(e){super(e&&e.message||a),this.name="CartoError",this.originalError=e,this.type=e&&e.type||"",this.origin=e&&e.origin||n;var t=this._getExtraFields();this.message=t.friendlyMessage}_getExtraFields(){const e=this._getErrorList();for(let t in e){const r=e[t];if(!(r.messageRegex instanceof RegExp))throw new Error(`MessageRegex on ${t} is not a RegExp.`);if(r.messageRegex.test(this.message))return{friendlyMessage:this._replaceRegex(r)}}return{friendlyMessage:this.message||""}}_getErrorList(){return i[this.origin]&&i[this.origin][this.type]}_replaceRegex(e){if(!e.friendlyMessage)return this.message;var t=this.message&&this.message.match(e.messageRegex);return t&&t.length>1?e.friendlyMessage.replace("$0",t[1]):e.friendlyMessage}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"validation",function(){return i});const i={layer:{"id-required":{messageRegex:/idRequired/,friendlyMessage:"`id` property required."},"id-string-required":{messageRegex:/idStringRequired/,friendlyMessage:"`id` property must be a string."},"non-valid-id":{messageRegex:/nonValidId/,friendlyMessage:"`id` property must be not empty."},"source-required":{messageRegex:/sourceRequired/,friendlyMessage:"`source` property required."},"non-valid-source":{messageRegex:/nonValidSource/,friendlyMessage:'The given object is not a valid source. See "carto.source.Base".'},"viz-required":{messageRegex:/vizRequired/,friendlyMessage:"`viz` property required."},"non-valid-viz":{messageRegex:/nonValidViz/,friendlyMessage:'The given object is not a valid viz. See "carto.Viz".'},"shared-viz":{messageRegex:/sharedViz/,friendlyMessage:"The given Viz object is already bound to another layer. Vizs cannot be shared between different layers"}},setup:{"auth-required":{messageRegex:/authRequired/,friendlyMessage:"`auth` property is required."},"auth-object-required":{messageRegex:/authObjectRequired/,friendlyMessage:"`auth` property must be an object."},"api-key-required":{messageRegex:/apiKeyRequired/,friendlyMessage:"`apiKey` property is required."},"api-key-string-required":{messageRegex:/apiKeyStringRequired/,friendlyMessage:"`apiKey` property must be a string."},"non-valid-api-key":{messageRegex:/nonValidApiKey/,friendlyMessage:"`apiKey` property must be not empty."},"username-required":{messageRegex:/usernameRequired/,friendlyMessage:"`username` property is required."},"username-string-required":{messageRegex:/usernameStringRequired/,friendlyMessage:"`username` property must be a string."},"non-valid-username":{messageRegex:/nonValidUsername/,friendlyMessage:"`username` property must be not empty."},"config-object-required":{messageRegex:/configObjectRequired/,friendlyMessage:"`config` property must be an object."},"server-url-string-required":{messageRegex:/serverURLStringRequired/,friendlyMessage:"`serverURL` property must be a string."}},source:{"non-valid-server-url":{messageRegex:/nonValidServerURL/,friendlyMessage:"`serverURL` property is not a valid URL."},"table-name-required":{messageRegex:/tableNameRequired/,friendlyMessage:"`tableName` property is required."},"table-name-string-required":{messageRegex:/tableNameStringRequired$/,friendlyMessage:"`tableName` property must be a string."},"non-valid-table-name":{messageRegex:/nonValidTableName$/,friendlyMessage:"`tableName` property must be not empty."},"query-required":{messageRegex:/queryRequired/,friendlyMessage:"`query` property is required."},"query-string-required":{messageRegex:/queryStringRequired$/,friendlyMessage:"`query` property must be a string."},"non-valid-query":{messageRegex:/nonValidQuery$/,friendlyMessage:"`query` property must be not empty."},"non-valid-sql-query":{messageRegex:/nonValidSQLQuery$/,friendlyMessage:"`query` property must be a SQL query."},"data-required":{messageRegex:/dataRequired/,friendlyMessage:"`data` property is required."},"data-object-required":{messageRegex:/dataObjectRequired$/,friendlyMessage:"`data` property must be an object."},"non-valid-geojson-data":{messageRegex:/nonValidGeoJSONData$/,friendlyMessage:"`data` property must be a GeoJSON object."},"multiple-feature-types":{messageRegex:/multipleFeatureTypes\[(.+)\]$/,friendlyMessage:"multiple types not supported: $0."},"first-polygon-external":{messageRegex:/firstPolygonExternal$/,friendlyMessage:"first polygon ring must be external."},"feature-has-cartodb_id":{messageRegex:/featureHasCartodbId$/,friendlyMessage:"`cartodb_id` is a reserved property so it can not be used"}},viz:{"non-valid-definition":{messageRegex:/nonValidDefinition$/,friendlyMessage:"viz definition should be a vizSpec object or a valid viz string."},"non-valid-expression":{messageRegex:/nonValidExpression\[(.+)\]$/,friendlyMessage:"`$0` parameter is not a valid viz Expresion."},"resolution-number-required":{messageRegex:/resolutionNumberRequired$/,friendlyMessage:"`resolution` must be a number."},"resolution-too-small":{messageRegex:/resolutionTooSmall\[(.+)\]$/,friendlyMessage:"`resolution` must be greater than $0."},"resolution-too-big":{messageRegex:/resolutionTooBig\[(.+)\]$/,friendlyMessage:"`resolution` must be less than $0."}}}},function(e,t,r){"use strict";var i=r(4),a=r(27),n=r(6);class s extends a.a{constructor(e,t,r){super(),this._checkTableName(e),this._tableName=e,this.initialize(t,r)}_clone(){return new s(this._tableName,this._auth,this._config)}_checkTableName(e){if(i.f(e))throw new n.a("source","tableNameRequired");if(!i.e(e))throw new n.a("source","tableNameStringRequired");if(""===e)throw new n.a("source","nonValidTableName")}}t.a=s},function(e,t,r){"use strict";var i=r(10),a=r(11),n=r(25),s=r(77),o=(r.n(s),r(79)),c=(r.n(o),r(87)),f=r(88),u=(r.n(f),r(26));const l=1e3,h=2e6;function d(e){let t=0;for(let r=0;r<e.length;r++){let i=(r+1)%e.length;t+=e[r].x*e[i].y,t-=e[i].x*e[r].y}return t>0}t.a=class{constructor(e){this._source=e,this._exclusive=!0,this._requestGroupID=0,this._oldDataframes=[],this._MNS=null,this._promiseMNS=null,this._categoryStringToIDMap={},this._numCategories=0;const t={max:1e3,length:function(){return 1},dispose:(e,t)=>{t.then(e=>{e.empty||(e.free(),this._removeDataframe(e))})},maxAge:36e5};this.cache=o(t),this.inProgressInstantiations={}}_bindLayer(e,t,r){this._addDataframe=e,this._removeDataframe=t,this._dataLoadedCallback=r}_getInstantiationID(e,t,r){return JSON.stringify({MNS:e,resolution:t,filtering:this.metadata&&this.metadata.featureCount>h?r:null})}async getMetadata(e){const t=e.getMinimumNeededSchema(),r=e.getResolution(),i=c.b(e,{exclusive:this._exclusive});if(t.columns.includes("cartodb_id")||t.columns.push("cartodb_id"),this._needToInstantiate(t,r,i)){const e=await this._instantiate(t,r,i);this._updateStateAfterInstantiating(e)}return this.metadata}getData(e){if(this._isInstantiated()){const t=a.b(e);this._getTiles(t)}}_getTiles(e){this._requestGroupID++;var t=[],r=e.length;const i=this._requestGroupID;e.forEach(e=>{const{x:a,y:n,z:s}=e;this.getDataframe(a,n,s).then(e=>{e.empty?r--:t.push(e),t.length==r&&i==this._requestGroupID&&(this._oldDataframes.map(e=>e.active=!1),t.map(e=>e.active=!0),this._oldDataframes=t,this._dataLoadedCallback())})})}_needToInstantiate(e,t,r){return!i.c.equals(this._MNS,e)||t!=this.resolution||JSON.stringify(r)!=JSON.stringify(this.filtering)&&this.metadata.featureCount>h}_isInstantiated(){return!!this.metadata}_getCategoryIDFromString(e,t=!0){return void 0===e&&(e="null"),void 0!==this._categoryStringToIDMap[e]?this._categoryStringToIDMap[e]:t?(console.warn(`category ${e} not present in metadata`),-1):(this._categoryStringToIDMap[e]=this._numCategories,this._numCategories++,this._categoryStringToIDMap[e])}async _instantiateUncached(e,t,r){const i=this._getConfig(),a=await this._generateAggregation(e,t);let n=this._buildSelectClause(e),s=this._buildQuery(n);const o=`(${s}) AS tmp`,f=await this._getMetadata(o,e,i);n=this._buildSelectClause(e,f.columns.filter(e=>"date"==e.type).map(e=>e.name)),s=this._buildQuery(n);let u=f.featureCount>h?r:null;return u&&this._requiresAggregation(e)&&(a.filters=c.a(u),this._exclusive||(u=null)),u&&(s=this._buildQuery(n,u)),{MNS:e,resolution:t,filters:r,metadata:f,urlTemplate:await this._getUrlPromise(o,i,a,s)}}_updateStateAfterInstantiating({MNS:e,resolution:t,filters:r,metadata:i,urlTemplate:a}){this._checkLayerMeta(e),this._oldDataframes=[],this.cache.reset(),this.urlTemplate=a,this.metadata=i,this._MNS=e,this.filtering=r,this.resolution=t}async _instantiate(e,t,r){if(this.inProgressInstantiations[this._getInstantiationID(e,t,r)])return this.inProgressInstantiations[this._getInstantiationID(e,t,r)];const i=this._instantiateUncached(e,t,r);return this.inProgressInstantiations[this._getInstantiationID(e,t,r)]=i,i}_checkLayerMeta(e){if(!this._isAggregated()&&this._requiresAggregation(e))throw new Error("Aggregation not supported for this dataset")}_isAggregated(){return!!this._layerMeta&&this._layerMeta.aggregation.mvt}_requiresAggregation(e){return e.columns.some(e=>i.c.column.isAggregated(e))}_generateAggregation(e,t){let r={columns:{},dimensions:{},placement:"centroid",resolution:t,threshold:1};return e.columns.forEach(e=>{"cartodb_id"!==e&&(i.c.column.isAggregated(e)?r.columns[e]={aggregate_function:i.c.column.getAggFN(e),aggregated_column:i.c.column.getBase(e)}:r.dimensions[e]=e)}),r}_buildSelectClause(e,t=[]){return e.columns.map(e=>i.c.column.getBase(e)).map(e=>t.includes(e)?e+"::text":e).concat(["the_geom","the_geom_webmercator","cartodb_id"])}_buildQuery(e,t){return`SELECT ${e.filter((t,r)=>e.indexOf(t)==r).join()} FROM ${this._source._query?`(${this._source._query}) as _cdb_query_wrapper`:this._source._tableName} ${t?c.c(t):""}`}_getConfig(){return{apiKey:this._source._apiKey,username:this._source._username,mapsServerURL:this._source._serverURL.maps,sqlServerURL:this._source._serverURL.sql}}free(){this.cache.reset(),this._oldDataframes=[]}_generateDataFrame(e,t,r,i,a){return new n.a({active:!1,center:e.center,geom:t,properties:r,scale:e.scale,size:i,type:a,metadata:this.metadata})}async _getUrlPromise(e,t,r,i){this.geomType=await this.getGeometryType(e,t),"point"!=this.geomType&&(r=!1);const a={buffersize:{mvt:0},layers:[{type:"mapnik",options:{sql:i,aggregation:r}}]},n=await fetch(p(t),this._getRequestConfig(a)),s=await n.json();return this._layerMeta=s.metadata.layers[0].meta,this._subdomains=s.cdn_url?s.cdn_url.templates.https.subdomains:[],function(e,t,r){if(e.cdn_url&&e.cdn_url.templates){const i=e.cdn_url.templates.https;return g(`${i.url}/${r.username}/api/v1/map/${e.layergroupid}/${t}/{z}/{x}/{y}.mvt`,r)}return p(r,`${e.layergroupid}/${t}/{z}/{x}/{y}.mvt`)}(s,0,t)}_getRequestConfig(e){return{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}}getDataframe(e,t,r){const i=`${e},${t},${r}`,a=this.cache.get(i);if(a)return a;const n=this.requestDataframe(e,t,r);return this.cache.set(i,n),n}requestDataframe(e,t,r){return fetch(this._getTileUrl(e,t,r)).then(e=>e.arrayBuffer()).then(n=>{if(0==n.byteLength||"null"==n)return{empty:!0};var o=new f.VectorTile(new s(n));const c=o.layers[Object.keys(o.layers)[0]];var u={};const l=[],h=[],d=[];this._MNS.columns.map(e=>{const t=i.c.column.getBase(e),r=this.metadata.columns.find(e=>e.name==t).type;if("category"==r)h.push(e);else if("float"==r)l.push(e);else{if("date"!=r)throw new Error(`Column type '${r}' not supported`);d.push(e)}}),h.map((e,t)=>u[e]=t),l.map((e,t)=>u[e]=t+h.length),d.map((e,t)=>u[e]=t+h.length+l.length);const{points:p,featureGeometries:b,properties:g}=this._decodeMVTLayer(c,this.metadata,4096,h,l,d);var m=a.a(e,t,r);let y={};Object.keys(u).map((e,t)=>{y[e]=g[t]});let _="point"==this.geomType?p:b;const v=this._generateDataFrame(m,_,y,c.length,this.geomType);return this._addDataframe(v),v})}_getTileUrl(e,t,r){return this.urlTemplate.replace("{x}",e).replace("{y}",t).replace("{z}",r).replace("{s}",this._getSubdomain(e,t))}_getSubdomain(e,t){return this._subdomains[Math.abs(e+t)%this._subdomains.length]}_decodePolygons(e,t,r){let i=null,a=[];for(let t=0;t<e.length;t++){if(d(e[t]))i&&a.push(i),i={flat:[],holes:[]};else{if(0==t)throw new Error("Invalid MVT tile: first polygon ring MUST be external");i.holes.push(i.flat.length/2)}for(let a=0;a<e[t].length;a++)i.flat.push(2*e[t][a].x/r-1),i.flat.push(2*(1-e[t][a].y/r)-1)}i&&i.flat.length>0&&a.push(i),t.push(a)}_decodeLines(e,t,r){let i=[];e.map(e=>{let t=[];e.map(e=>{t.push(2*e.x/r-1,2*(1-e.y/r)-1)}),i.push(t)}),t.push(i)}_decodeMVTLayer(e,t,r,i,a,n){const s=[];for(let t=0;t<i.length+a.length+n.length;t++)s.push(new Float32Array(e.length+1024));if("point"==this.geomType)var o=new Float32Array(2*e.length);let c=[];for(var f=0;f<e.length;f++){const u=e.feature(f),l=u.loadGeometry();if("point"==this.geomType)o[2*f+0]=2*l[0][0].x/r-1,o[2*f+1]=2*(1-l[0][0].y/r)-1;else if("polygon"==this.geomType)this._decodePolygons(l,c,r);else{if("line"!=this.geomType)throw new Error(`Unimplemented geometry type: '${this.geomType}'`);this._decodeLines(l,c,r)}i.map((e,t)=>{s[t][f]=this._getCategoryIDFromString(u.properties[e])}),a.map((e,t)=>{s[t+i.length][f]=Number(u.properties[e])}),n.map((e,r)=>{const n=Date.parse(u.properties[e]);if(Number.isNaN(n))throw new Error("invalid MVT date");const o=t.columns.find(t=>t.name==e),c=o.min,l=(n-c)/(o.max.getTime()-c.getTime());s[r+i.length+a.length][f]=l})}return{properties:s,points:o,featureGeometries:c}}async _getMetadata(e,t,r){const[{numerics:i,categories:a,dates:n},s]=await Promise.all([this._getColumnTypes(e,r),this.getFeatureCount(e,r)]),o=Math.min(l/s,1),[c,f,h,d]=await Promise.all([this.getSample(r,o),this.getNumericTypes(i,e,r),this.getDatesTypes(n,e,r),this.getCategoryTypes(a,e,r)]);let p=[];i.forEach((e,t)=>p.push(f[t])),n.forEach((e,t)=>p.push(h[t]));const b={};return a.map((e,t)=>{const r=d[t];r.categoryNames.map(e=>b[e]=this._getCategoryIDFromString(e,!1)),p.push(r)}),new u.a(b,p,s,c)}async _getColumnTypes(e,t){const r=await this.getColumnTypes(e,t);let i=[],a=[],n=[];return Object.keys(r).map(e=>{const t=r[e].type;if("number"==t)i.push(e);else if("string"==t)a.push(e);else if("date"==t)n.push(e);else if("geometry"!=t)throw new Error(`Unsuportted type ${t}`)}),{numerics:i,categories:a,dates:n}}async getSample(e,t){let r;r=this._source._tableName?`SELECT * FROM ${this._source._tableName} TABLESAMPLE BERNOULLI (${100*t}) REPEATABLE (0);`:`WITH _rndseed as (SELECT setseed(0.5))\n                    SELECT * FROM (${this._source._query}) as _cdb_query_wrapper WHERE random() < ${t};`;const i=await b(r,e);return(await i.json()).rows}async getFeatureCount(e,t){const r=`SELECT COUNT(*) FROM ${e};`,i=await b(r,t);return(await i.json()).rows[0].count}async getColumnTypes(e,t){const r=`select * from ${e} limit 0;`,i=await b(r,t);return(await i.json()).fields}async getGeometryType(e,t){const r=`SELECT ST_GeometryType(the_geom) AS type FROM ${e} WHERE the_geom IS NOT NULL LIMIT 1;`,i=await b(r,t),a=(await i.json()).rows[0].type;switch(a){case"ST_MultiPolygon":return"polygon";case"ST_Point":return"point";case"ST_MultiLineString":return"line";default:throw new Error(`Unimplemented geometry type ''${a}'`)}}async getNumericTypes(e,t,r){const i=["min","max","sum","avg"],a=`SELECT ${e.map(e=>i.map(t=>`${t}(${e}) AS ${e}_${t}`)).concat(["COUNT(*)"]).join()} FROM ${t};`,n=await b(a,r),s=await n.json();return e.map(e=>({name:e,type:"float",min:s.rows[0][`${e}_min`],max:s.rows[0][`${e}_max`],avg:s.rows[0][`${e}_avg`],sum:s.rows[0][`${e}_sum`]}))}_getDateFromStr(e){if(Number.isNaN(Date.parse(e)))throw new Error(`Invalid date: '${e}'`);return new Date(e)}async getDatesTypes(e,t,r){if(0==e.length)return[];const i=["min","max"],a=`SELECT ${e.map(e=>i.map(t=>`${t}(${e}) AS ${e}_${t}`)).join()} FROM ${t};`,n=await b(a,r),s=await n.json();return e.map(e=>({name:e,type:"date",min:this._getDateFromStr(s.rows[0][`${e}_min`]),max:this._getDateFromStr(s.rows[0][`${e}_max`])}))}async getCategoryTypes(e,t,r){return Promise.all(e.map(async e=>{const i=`SELECT COUNT(*), ${e} AS name FROM ${t} GROUP BY ${e} ORDER BY COUNT(*) DESC;`,a=await b(i,r);let n=[],s=[];return(await a.json()).rows.map(e=>{n.push(e.count),s.push(e.name)}),{name:e,type:"category",categoryNames:s,categoryCounts:n}}))}};const p=(e,t="")=>{let r=`${e.mapsServerURL}/api/v1/map`;return t&&(r+="/"+t),r=g(r,e)};function b(e,t){let r=`${t.sqlServerURL}/api/v2/sql?q=`+encodeURIComponent(e);return r=g(r,t),fetch(r)}function g(e,t){if(t.apiKey){e+=(e.includes("?")?"&":"?")+"api_key="+encodeURIComponent(t.apiKey)}return e}},function(e,t,r){"use strict";e.exports=a;var i=r(78);function a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}a.Varint=0,a.Fixed64=1,a.Bytes=2,a.Fixed32=5;function n(e){return e.type===a.Bytes?e.readVarint()+e.pos:e.pos+1}function s(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function o(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var a=r.pos-1;a>=e;a--)r.buf[a+i]=r.buf[a]}function c(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function f(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function u(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function l(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function h(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function d(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function p(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function b(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function g(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function m(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function y(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function _(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),a=i>>3,n=this.pos;this.type=7&i,e(a,t,this),this.pos===n&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=m(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=_(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=m(this.buf,this.pos)+4294967296*_(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:function(e,t,r){var i,a,n=r.buf;if(a=n[r.pos++],i=(112&a)>>4,a<128)return s(e,i,t);if(a=n[r.pos++],i|=(127&a)<<3,a<128)return s(e,i,t);if(a=n[r.pos++],i|=(127&a)<<10,a<128)return s(e,i,t);if(a=n[r.pos++],i|=(127&a)<<17,a<128)return s(e,i,t);if(a=n[r.pos++],i|=(127&a)<<24,a<128)return s(e,i,t);if(a=n[r.pos++],i|=(1&a)<<31,a<128)return s(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,r){var i="",a=t;for(;a<r;){var n,s,o,c=e[a],f=null,u=c>239?4:c>223?3:c>191?2:1;if(a+u>r)break;1===u?c<128&&(f=c):2===u?128==(192&(n=e[a+1]))&&(f=(31&c)<<6|63&n)<=127&&(f=null):3===u?(n=e[a+1],s=e[a+2],128==(192&n)&&128==(192&s)&&((f=(15&c)<<12|(63&n)<<6|63&s)<=2047||f>=55296&&f<=57343)&&(f=null)):4===u&&(n=e[a+1],s=e[a+2],o=e[a+3],128==(192&n)&&128==(192&s)&&128==(192&o)&&((f=(15&c)<<18|(63&n)<<12|(63&s)<<6|63&o)<=65535||f>=1114112)&&(f=null)),null===f?(f=65533,u=1):f>65535&&(f-=65536,i+=String.fromCharCode(f>>>10&1023|55296),f=56320|1023&f),i+=String.fromCharCode(f),a+=u}return i}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===a.Varint)for(;this.buf[this.pos++]>127;);else if(t===a.Bytes)this.pos=this.readVarint()+this.pos;else if(t===a.Fixed32)this.pos+=4;else{if(t!==a.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,i;e>=0?(r=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function(e,t){var r=(7&e)<<4;if(t.buf[t.pos++]|=r|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var i,a,n=0;n<t.length;n++){if((i=t.charCodeAt(n))>55295&&i<57344){if(!a){i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=i;continue}i=a-55296<<10|i-56320|65536,a=null}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&o(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),i.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),i.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&o(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,c,t)},writePackedSVarint:function(e,t){this.writeMessage(e,f,t)},writePackedBoolean:function(e,t){this.writeMessage(e,h,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,l,t)},writePackedFixed32:function(e,t){this.writeMessage(e,d,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,p,t)},writePackedFixed64:function(e,t){this.writeMessage(e,b,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,g,t)},writeBytesField:function(e,t){this.writeTag(e,a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},function(e,t){t.read=function(e,t,r,i,a){var n,s,o=8*a-i-1,c=(1<<o)-1,f=c>>1,u=-7,l=r?a-1:0,h=r?-1:1,d=e[t+l];for(l+=h,n=d&(1<<-u)-1,d>>=-u,u+=o;u>0;n=256*n+e[t+l],l+=h,u-=8);for(s=n&(1<<-u)-1,n>>=-u,u+=i;u>0;s=256*s+e[t+l],l+=h,u-=8);if(0===n)n=1-f;else{if(n===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),n-=f}return(d?-1:1)*s*Math.pow(2,n-i)},t.write=function(e,t,r,i,a,n){var s,o,c,f=8*n-a-1,u=(1<<f)-1,l=u>>1,h=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:n-1,p=i?1:-1,b=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?h/c:h*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=u?(o=0,s=u):s+l>=1?(o=(t*c-1)*Math.pow(2,a),s+=l):(o=t*Math.pow(2,l-1)*Math.pow(2,a),s=0));a>=8;e[r+d]=255&o,d+=p,o/=256,a-=8);for(s=s<<a|o,f+=a;f>0;e[r+d]=255&s,d+=p,s/=256,f-=8);e[r+d-p]|=128*b}},function(e,t,r){"use strict";e.exports=m;var i,a=r(80),n=r(82),s=r(86),o=(i="function"==typeof Symbol?function(e){return Symbol.for(e)}:function(e){return"_"+e})("max"),c=i("length"),f=i("lengthCalculator"),u=i("allowStale"),l=i("maxAge"),h=i("dispose"),d=i("noDisposeOnSet"),p=i("lruList"),b=i("cache");function g(){return 1}function m(e){if(!(this instanceof m))return new m(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[o]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[o]=1/0);var r=e.length||g;"function"!=typeof r&&(r=g),this[f]=r,this[u]=e.stale||!1,this[l]=e.maxAge||0,this[h]=e.dispose,this[d]=e.noDisposeOnSet||!1,this.reset()}function y(e,t,r,i){var a=r.value;v(e,a)&&(w(e,r),e[u]||(a=void 0)),a&&t.call(i,a.value,a.key,e)}function _(e,t,r){var i=e[b].get(t);if(i){var a=i.value;v(e,a)?(w(e,i),e[u]||(a=void 0)):r&&e[p].unshiftNode(i),a&&(a=a.value)}return a}function v(e,t){if(!t||!t.maxAge&&!e[l])return!1;var r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[l]&&r>e[l]}function x(e){if(e[c]>e[o])for(var t=e[p].tail;e[c]>e[o]&&null!==t;){var r=t.prev;w(e,t),t=r}}function w(e,t){if(t){var r=t.value;e[h]&&e[h](r.key,r.value),e[c]-=r.length,e[b].delete(r.key),e[p].removeNode(t)}}Object.defineProperty(m.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[o]=e,x(this)},get:function(){return this[o]},enumerable:!0}),Object.defineProperty(m.prototype,"allowStale",{set:function(e){this[u]=!!e},get:function(){return this[u]},enumerable:!0}),Object.defineProperty(m.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[l]=e,x(this)},get:function(){return this[l]},enumerable:!0}),Object.defineProperty(m.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=g),e!==this[f]&&(this[f]=e,this[c]=0,this[p].forEach(function(e){e.length=this[f](e.value,e.key),this[c]+=e.length},this)),x(this)},get:function(){return this[f]},enumerable:!0}),Object.defineProperty(m.prototype,"length",{get:function(){return this[c]},enumerable:!0}),Object.defineProperty(m.prototype,"itemCount",{get:function(){return this[p].length},enumerable:!0}),m.prototype.rforEach=function(e,t){t=t||this;for(var r=this[p].tail;null!==r;){var i=r.prev;y(this,e,r,t),r=i}},m.prototype.forEach=function(e,t){t=t||this;for(var r=this[p].head;null!==r;){var i=r.next;y(this,e,r,t),r=i}},m.prototype.keys=function(){return this[p].toArray().map(function(e){return e.key},this)},m.prototype.values=function(){return this[p].toArray().map(function(e){return e.value},this)},m.prototype.reset=function(){this[h]&&this[p]&&this[p].length&&this[p].forEach(function(e){this[h](e.key,e.value)},this),this[b]=new a,this[p]=new s,this[c]=0},m.prototype.dump=function(){return this[p].map(function(e){if(!v(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},m.prototype.dumpLru=function(){return this[p]},m.prototype.inspect=function(e,t){var r="LRUCache {",i=!1;this[u]&&(r+="\n  allowStale: true",i=!0);var a=this[o];a&&a!==1/0&&(i&&(r+=","),r+="\n  max: "+n.inspect(a,t),i=!0);var s=this[l];s&&(i&&(r+=","),r+="\n  maxAge: "+n.inspect(s,t),i=!0);var h=this[f];h&&h!==g&&(i&&(r+=","),r+="\n  length: "+n.inspect(this[c],t),i=!0);var d=!1;return this[p].forEach(function(e){d?r+=",\n  ":(i&&(r+=",\n"),d=!0,r+="\n  ");var a=n.inspect(e.key).split("\n").join("\n  "),o={value:e.value};e.maxAge!==s&&(o.maxAge=e.maxAge),h!==g&&(o.length=e.length),v(this,e)&&(o.stale=!0),o=n.inspect(o,t).split("\n").join("\n  "),r+=a+" => "+o}),(d||i)&&(r+="\n"),r+="}"},m.prototype.set=function(e,t,r){var i=(r=r||this[l])?Date.now():0,a=this[f](t,e);if(this[b].has(e)){if(a>this[o])return w(this,this[b].get(e)),!1;var n=this[b].get(e).value;return this[h]&&(this[d]||this[h](e,n.value)),n.now=i,n.maxAge=r,n.value=t,this[c]+=a-n.length,n.length=a,this.get(e),x(this),!0}var s=new function(e,t,r,i,a){this.key=e,this.value=t,this.length=r,this.now=i,this.maxAge=a||0}(e,t,a,i,r);return s.length>this[o]?(this[h]&&this[h](e,t),!1):(this[c]+=s.length,this[p].unshift(s),this[b].set(e,this[p].head),x(this),!0)},m.prototype.has=function(e){return!!this[b].has(e)&&!v(this,this[b].get(e).value)},m.prototype.get=function(e){return _(this,e,!0)},m.prototype.peek=function(e){return _(this,e,!1)},m.prototype.pop=function(){var e=this[p].tail;return e?(w(this,e),e.value):null},m.prototype.del=function(e){w(this,this[b].get(e))},m.prototype.load=function(e){this.reset();for(var t=Date.now(),r=e.length-1;r>=0;r--){var i=e[r],a=i.e||0;if(0===a)this.set(i.k,i.v);else{var n=a-t;n>0&&this.set(i.k,i.v,n)}}},m.prototype.prune=function(){var e=this;this[b].forEach(function(t,r){_(e,r,!1)})}},function(e,t,r){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||t.env.TEST_PSEUDOMAP?e.exports=r(81):e.exports=Map}).call(t,r(28))},function(e,t){var r=Object.prototype.hasOwnProperty;function i(e){if(!(this instanceof i))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof i||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function a(e,t){return e===t||e!=e&&t!=t}function n(e,t){for(var i=0,n="_"+t,s=n;r.call(e,s);s=n+i++)if(a(e[s].key,t))return e[s]}e.exports=i,i.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(r){"size"!==r&&e.call(t,this._data[r].value,this._data[r].key)},this)},i.prototype.has=function(e){return!!n(this._data,e)},i.prototype.get=function(e){var t=n(this._data,e);return t&&t.value},i.prototype.set=function(e,t){!function(e,t,i){for(var n=0,s="_"+t,o=s;r.call(e,o);o=s+n++)if(a(e[o].key,t))return void(e[o].value=i);e.size++,e[o]=new function(e,t,r){this.key=e,this.value=t,this._index=r}(t,i,o)}(this._data,e,t)},i.prototype.delete=function(e){var t=n(this._data,e);t&&(delete this._data[t._index],this._data.size--)},i.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(i.prototype,"size",{get:function(){return this._data.size},set:function(e){},enumerable:!0,configurable:!0}),i.prototype.values=i.prototype.keys=i.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,r){(function(e,i){var a=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,n=i.length,s=String(e).replace(a,function(e){if("%%"===e)return"%";if(r>=n)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}}),c=i[r];r<n;c=i[++r])b(c)||!v(c)?s+=" "+c:s+=" "+o(c);return s},t.deprecate=function(r,a){if(y(e.process))return function(){return t.deprecate(r,a).apply(this,arguments)};if(!0===i.noDeprecation)return r;var n=!1;return function(){if(!n){if(i.throwDeprecation)throw new Error(a);i.traceDeprecation?console.trace(a):console.error(a),n=!0}return r.apply(this,arguments)}};var n,s={};function o(e,r){var i={seen:[],stylize:f};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),p(r)?i.showHidden=r:r&&t._extend(i,r),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),u(i,e,i.depth)}function c(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function f(e,t){return e}function u(e,r,i){if(e.customInspect&&r&&E(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var a=r.inspect(i,e);return m(a)||(a=u(e,a,i)),a}var n=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(m(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(g(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(b(t))return e.stylize("null","null")}(e,r);if(n)return n;var s=Object.keys(r),o=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),w(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(r);if(0===s.length){if(E(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(x(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return l(r)}var f,v="",T=!1,C=["{","}"];(d(r)&&(T=!0,C=["[","]"]),E(r))&&(v=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(v=" "+RegExp.prototype.toString.call(r)),x(r)&&(v=" "+Date.prototype.toUTCString.call(r)),w(r)&&(v=" "+l(r)),0!==s.length||T&&0!=r.length?i<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),f=T?function(e,t,r,i,a){for(var n=[],s=0,o=t.length;s<o;++s)F(t,String(s))?n.push(h(e,t,r,i,String(s),!0)):n.push("");return a.forEach(function(a){a.match(/^\d+$/)||n.push(h(e,t,r,i,a,!0))}),n}(e,r,i,o,s):s.map(function(t){return h(e,r,i,o,t,T)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(f,v,C)):C[0]+v+C[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,r,i,a,n){var s,o,c;if((c=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),F(i,a)||(s="["+a+"]"),o||(e.seen.indexOf(c.value)<0?(o=b(r)?u(e,c.value,null):u(e,c.value,r-1)).indexOf("\n")>-1&&(o=n?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),y(s)){if(n&&a.match(/^\d+$/))return o;(s=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function b(e){return null===e}function g(e){return"number"==typeof e}function m(e){return"string"==typeof e}function y(e){return void 0===e}function _(e){return v(e)&&"[object RegExp]"===T(e)}function v(e){return"object"==typeof e&&null!==e}function x(e){return v(e)&&"[object Date]"===T(e)}function w(e){return v(e)&&("[object Error]"===T(e)||e instanceof Error)}function E(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(n)&&(n=i.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(n)){var r=i.pid;s[e]=function(){var i=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,i)}}else s[e]=function(){};return s[e]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=b,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=_,t.isObject=v,t.isDate=x,t.isError=w,t.isFunction=E,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(84);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(e=new Date,r=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":"),[e.getDate(),A[e.getMonth()],r].join(" ")),t.format.apply(t,arguments))},t.inherits=r(85),t._extend=function(e,t){if(!t||!v(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}}).call(t,r(83),r(28))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var i=0,a=arguments.length;i<a;i++)t.push(arguments[i]);return t}function i(e,t){e.tail=new n(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function a(e,t){e.head=new n(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function n(e,t,r,i){if(!(this instanceof n))return new n(e,t,r,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=r,r.Node=n,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,i=0;null!==r;i++)e.call(t,r.value,i,this),r=r.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,i=this.length-1;null!==r;i--)e.call(t,r.value,i,this),r=r.prev},r.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},r.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},r.prototype.map=function(e,t){t=t||this;for(var i=new r,a=this.head;null!==a;)i.push(e.call(t,a.value,this)),a=a.next;return i},r.prototype.mapReverse=function(e,t){t=t||this;for(var i=new r,a=this.tail;null!==a;)i.push(e.call(t,a.value,this)),a=a.prev;return i},r.prototype.reduce=function(e,t){var r,i=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");i=this.head.next,r=this.head.value}for(var a=0;null!==i;a++)r=e(r,i.value,a),i=i.next;return r},r.prototype.reduceReverse=function(e,t){var r,i=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");i=this.tail.prev,r=this.tail.value}for(var a=this.length-1;null!==i;a--)r=e(r,i.value,a),i=i.prev;return r},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=0,n=this.head;null!==n&&a<e;a++)n=n.next;for(;null!==n&&a<t;a++,n=n.next)i.push(n.value);return i},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var i=new r;if(t<e||t<0)return i;e<0&&(e=0),t>this.length&&(t=this.length);for(var a=this.length,n=this.tail;null!==n&&a>t;a--)n=n.prev;for(;null!==n&&a>e;a--,n=n.prev)i.push(n.value);return i},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var i=r.prev;r.prev=r.next,r.next=i}return this.head=t,this.tail=e,this}},function(e,t,r){"use strict";t.b=function(e,t={}){const r=new p(t),i={preaggregation:new b(t).getFilter(e.getFilter()),aggregation:r.getFilters(e.getFilter())};if(!i.preaggregation&&!i.aggregation)return null;return i},t.c=function(e){let t;(e=e&&e.preaggregation)&&Object.keys(e).length>0&&(t=g(e));return t?"WHERE "+t:""},t.a=function(e){return e&&e.aggregation};var i=r(3),a=r(19),n=r(20),s=r(18),o=r(16),c=r(9),f=r(15),u=r(12),l=r(17),h=r(8),d=r(7);class p{constructor(e){this._onlyAggregateFilters=e.exclusive}getFilters(e){let t={},r=this._and(e).filter(Boolean);for(let e of r){let r=e.property,i=t[r];if(i){if(!this._compatibleAndFilters(i,e.filters))return{};Object.assign(i[0],e.filters[0])}else t[r]=e.filters}return t}_and(e){return e instanceof i.a?this._and(e.a).concat(this._and(e.b)).filter(Boolean):[this._or(e)].filter(Boolean)}_or(e){if(e instanceof i.n){let t=this._basicCondition(e.a),r=this._basicCondition(e.b);if(t&&r&&t.property==r.property)return t.filters=t.filters.concat(r.filters),t}return this._basicCondition(e)}_removeBlend(e){return e instanceof f.a&&e.originalMix instanceof u.a?e.b:e}_basicCondition(e){return e=this._removeBlend(e),this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._in(e)||this._notIn(e)}_value(e){if((e=this._removeBlend(e))instanceof o.a||e instanceof l.a||e instanceof s.a)return e.expr}_between(e){if(e instanceof n.a){let t=this._aggregation(e.value),r=t&&this._value(e.lowerLimit),i=t&&r&&this._value(e.upperLimit);if(i)return t.filters.push({greater_than_or_equal_to:r,less_than_or_equal_to:i}),t}}_in(e){if(e instanceof a.a){let t=this._aggregation(e.value),r=e.categories.map(e=>this._value(e)).filter(e=>null!=e);if(t&&r.length>0&&r.length==e.categories.length)return t.filters.push({in:r}),t}}_notIn(e){if(e instanceof a.b){let t=this._aggregation(e.value),r=e.categories.map(e=>this._value(e)).filter(e=>null!=e);if(t&&r.length>0&&r.length==e.categories.length)return t.filters.push({not_in:r}),t}}_equals(e){return this._cmpOp(e,i.b,"equal")}_notEquals(e){return this._cmpOp(e,i.m,"not_equal")}_lessThan(e){return this._cmpOp(e,i.k,"less_than","greater_than")}_lessThanOrEqualTo(e){return this._cmpOp(e,i.l,"less_than_or_equal_to","greater_than_or_equal_to")}_greaterThan(e){return this._cmpOp(e,i.i,"greater_than","less_than")}_greaterThanOrEqualTo(e){return this._cmpOp(e,i.j,"greater_than_or_equal_to","less_than_or_equal_to")}_aggregation(e){if((e=this._removeBlend(e))instanceof h.b||e instanceof h.c||e instanceof h.a||e instanceof h.e||e instanceof h.d){let t=this._property(e.property);if(t)return t.property=d.column.aggColumn(t.property,e.aggName),t}if(!this._onlyAggregateFilters)return this._property(e)}_property(e){if((e=this._removeBlend(e))instanceof c.a)return{property:e.name,filters:[]}}_cmpOp(e,t,r,i){if(i=i||r,e instanceof t){let t=this._aggregation(e.a),a=t&&this._value(e.b),n=r;if(a||(a=(t=this._aggregation(e.b))&&this._value(e.a),n=i),a){let e={};return e[n]=a,t.filters.push(e),t}}}_compatibleAndFilters(e,t){if(0===e.length||0===t.length)return!0;if(1===e.length&&1===t.length){const r=e[0],i=t[0];if(1===Object.keys(r).length&&1===Object.keys(i).length){const e=Object.keys(r)[0],t=Object.keys(i)[0],a=["less_than","less_than_or_equal_to"],n=["greater_than","greater_than_or_equal_to"];return a.includes(e)&&n.includes(t)||a.includes(t)&&n.includes(e)}}return!1}}class b{constructor(){}getFilter(e){return this._filter(e)}_filter(e){return this._and(e)||this._or(e)||this._in(e)||this._notIn(e)||this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._blend(e)||null}_and(e){if(e instanceof i.a){const t=[this._filter(e.a),this._filter(e.b)].filter(Boolean).reduce((e,t)=>e.concat(t),[]);if(t.length)return 1==t.length?t[0]:{type:"and",left:t[0],right:t[1]}}}_or(e){if(e instanceof i.n){let t=this._filter(e.a),r=this._filter(e.b);if(t&&r)return{type:"or",left:t,right:r}}}_lessThan(e){return this._cmpOp(e,i.k,"lessThan")}_lessThanOrEqualTo(e){return this._cmpOp(e,i.l,"lessThanOrEqualTo")}_greaterThan(e){return this._cmpOp(e,i.i,"greaterThan")}_greaterThanOrEqualTo(e){return this._cmpOp(e,i.j,"greaterThanOrEqualTo")}_equals(e){return this._cmpOp(e,i.b,"equals")}_notEquals(e){return this._cmpOp(e,i.m,"notEquals")}_cmpOp(e,t,r){if(e instanceof t){let t=this._property(e.a)||this._value(e.a),i=this._property(e.b)||this._value(e.b);if(t&&i)return{type:r,left:t,right:i}}}_blend(e){if(e instanceof f.a&&e.originalMix instanceof u.a)return this._filter(e.b)}_property(e){if(e instanceof c.a)return{type:"property",property:e.name}}_value(e){if(e instanceof o.a||e instanceof l.a||e instanceof s.a)return{type:"value",value:e.expr}}_in(e){if(e instanceof a.a){let t=this._property(e.value),r=e.categories.map(e=>this._value(e));if(t&&r.length>0&&r.length==e.categories.length)return{type:"in",property:t.property,values:r.map(e=>e.value)}}}_notIn(e){if(e instanceof a.b){let t=this._property(e.value),r=e.categories.map(e=>this._value(e));if(t&&r.length>0&&r.length==e.categories.length)return{type:"notIn",property:t.property,values:r.map(e=>e.value)}}}_between(e){if(e instanceof n.a){let t=this._property(e.value),r=this._value(e.lowerLimit),i=this._value(e.upperLimit);if(t&&null!=r&&null!=i)return{type:"between",property:t.property,lower:r.value,upper:i.value}}}}function g(e){return e.type?`(${v[e.type](e)})`:m(e)}function m(e){return isFinite(e)?String(e):`'${e.replace(/\'/g,"''")}'`}function y(e){return e.match(/^[a-z\d_]+$/)||(e=`"${e.replace(/\"/g,'""')}"`),e}function _(e,...t){return t.map(e=>g(e)).join(e)}const v={and:e=>_(" AND ",e.left,e.right),or:e=>_(" OR ",e.left,e.right),between:e=>`${y(e.property)} BETWEEN ${m(e.lower)} AND ${m(e.upper)}`,in:e=>`${y(e.property)} IN (${_(",",...e.values)})`,notIn:e=>`${y(e.property)} NOT IN (${_(",",...e.values)})`,equals:e=>_(" = ",e.left,e.right),notEquals:e=>_(" <> ",e.left,e.right),lessThan:e=>_(" < ",e.left,e.right),lessThanOrEqualTo:e=>_(" <= ",e.left,e.right),greaterThan:e=>_(" > ",e.left,e.right),greaterThanOrEqualTo:e=>_(" >= ",e.left,e.right),property:e=>y(e.property),value:e=>m(e.value)}},function(e,t,r){e.exports.VectorTile=r(89),e.exports.VectorTileFeature=r(30),e.exports.VectorTileLayer=r(29)},function(e,t,r){"use strict";var i=r(29);function a(e,t,r){if(3===e){var a=new i(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}e.exports=function(e,t){this.layers=e.readFields(a,{},t)}},function(e,t,r){"use strict";function i(e,t){this.x=e,this.y=t}e.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=t*this.x-r*this.y,a=r*this.x+t*this.y;return this.x=i,this.y=a,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),a=t.x+r*(this.x-t.x)-i*(this.y-t.y),n=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=a,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(e){return e instanceof i?e:Array.isArray(e)?new i(e[0],e[1]):e}},function(e,t,r){"use strict";var i=r(4),a=r(27),n=r(6);class s extends a.a{constructor(e,t,r){super(),this._checkQuery(e),this._query=e,this.initialize(t,r)}_clone(){return new s(this._query,this._auth,this._config)}_checkQuery(e){if(i.f(e))throw new n.a("source","queryRequired");if(!i.e(e))throw new n.a("source","queryStringRequired");if(""===e)throw new n.a("source","nonValidQuery");if(!e.match(/(SELECT|select)\s+.*\s+(FROM|from)\s+.*/))throw new n.a("source","nonValidSQLQuery")}}t.a=s},function(e,t,r){"use strict";t.a=function(e,t,r){let i={};const a=t._applyToShaderSource(e=>(void 0===i[e]&&(i[e]=Object.keys(i).length),`texture2D(propertyTex${i[e]}, featureID).a`));a.preface+=Object.keys(i).map(e=>`uniform sampler2D propertyTex${i[e]};`).join("\n");const n=r(e,a.preface,a.inline);return Object.keys(i).map(t=>{i[t]=e.getUniformLocation(n.program,`propertyTex${i[t]}`)}),t._postShaderCompile(n.program,e),{tid:i,shader:n}}},function(e,t,r){!function(r){"use strict";var i=function(e,t){var r=new Error(e+" at character "+t);throw r.index=t,r.description=e,r},a=!0,n={"-":a,"!":a,"~":a,"+":a},s={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o={$:a,_:a},c=function(e){var t,r=0;for(var i in e)(t=i.length)>r&&e.hasOwnProperty(i)&&(r=t);return r},f=c(n),u=c(s),l={true:!0,false:!1,null:null},h=function(e){return s[e]||0},d=function(e,t,r){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:r}},p=function(e){return e>=48&&e<=57},b=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!s[String.fromCharCode(e)]||o.hasOwnProperty(String.fromCharCode(e))},g=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!s[String.fromCharCode(e)]||o.hasOwnProperty(String.fromCharCode(e))},m=function(e){for(var t,r,a=0,o=e.charAt,c=e.charCodeAt,m=function(t){return o.call(e,t)},y=function(t){return c.call(e,t)},_=e.length,v=function(){for(var e=y(a);32===e||9===e||10===e||13===e;)e=y(++a)},x=function(){var e,t,r=E();return v(),63!==y(a)?r:(a++,(e=x())||i("Expected expression",a),v(),58===y(a)?(a++,(t=x())||i("Expected expression",a),{type:"ConditionalExpression",test:r,consequent:e,alternate:t}):void i("Expected :",a))},w=function(){v();for(var t=e.substr(a,u),r=t.length;r>0;){if(s.hasOwnProperty(t)&&(!b(y(a))||a+t.length<e.length&&!g(y(a+t.length))))return a+=r,t;t=t.substr(0,--r)}return!1},E=function(){var e,t,r,n,s,o,c,f;if(o=T(),!(t=w()))return o;for(s={value:t,prec:h(t)},(c=T())||i("Expected expression after "+t,a),n=[o,s,c];(t=w())&&0!==(r=h(t));){for(s={value:t,prec:r};n.length>2&&r<=n[n.length-2].prec;)c=n.pop(),t=n.pop().value,o=n.pop(),e=d(t,o,c),n.push(e);(e=T())||i("Expected expression after "+t,a),n.push(s,e)}for(e=n[f=n.length-1];f>1;)e=d(n[f-1].value,n[f-2],e),f-=2;return e},T=function(){var t,r,i;if(v(),t=y(a),p(t)||46===t)return C();if(39===t||34===t)return A();if(91===t)return R();for(i=(r=e.substr(a,f)).length;i>0;){if(n.hasOwnProperty(r)&&(!b(y(a))||a+r.length<e.length&&!g(y(a+r.length))))return a+=i,{type:"UnaryExpression",operator:r,argument:T(),prefix:!0};r=r.substr(0,--i)}return!(!b(t)&&40!==t)&&D()},C=function(){for(var e,t,r="";p(y(a));)r+=m(a++);if(46===y(a))for(r+=m(a++);p(y(a));)r+=m(a++);if("e"===(e=m(a))||"E"===e){for(r+=m(a++),"+"!==(e=m(a))&&"-"!==e||(r+=m(a++));p(y(a));)r+=m(a++);p(y(a-1))||i("Expected exponent ("+r+m(a)+")",a)}return t=y(a),b(t)?i("Variable names cannot start with a number ("+r+m(a)+")",a):46===t&&i("Unexpected period",a),{type:"Literal",value:parseFloat(r),raw:r}},A=function(){for(var e,t="",r=m(a++),n=!1;a<_;){if((e=m(a++))===r){n=!0;break}if("\\"===e)switch(e=m(a++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return n||i('Unclosed quote after "'+t+'"',a),{type:"Literal",value:t,raw:r+t+r}},F=function(){var t,r=y(a),n=a;for(b(r)?a++:i("Unexpected "+m(a),a);a<_&&(r=y(a),g(r));)a++;return t=e.slice(n,a),l.hasOwnProperty(t)?{type:"Literal",value:l[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},S=function(e){for(var t,r,n=[],s=!1;a<_;){if(v(),(t=y(a))===e){s=!0,a++;break}44===t?a++:((r=x())&&"Compound"!==r.type||i("Expected comma",a),n.push(r))}return s||i("Expected "+String.fromCharCode(e),a),n},D=function(){var e,t;for(t=40===(e=y(a))?O():F(),v(),e=y(a);46===e||91===e||40===e;)a++,46===e?(v(),t={type:"MemberExpression",computed:!1,object:t,property:F()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:x()},v(),93!==(e=y(a))&&i("Unclosed [",a),a++):40===e&&(t={type:"CallExpression",arguments:S(41),callee:t}),v(),e=y(a);return t},O=function(){a++;var e=x();if(v(),41===y(a))return a++,e;i("Unclosed (",a)},R=function(){return a++,{type:"ArrayExpression",elements:S(93)}},M=[];a<_;)59===(t=y(a))||44===t?a++:(r=x())?M.push(r):a<_&&i('Unexpected "'+m(a)+'"',a);return 1===M.length?M[0]:{type:"Compound",body:M}};m.version="0.3.4",m.toString=function(){return"JavaScript Expression Parser (JSEP) v"+m.version},m.addUnaryOp=function(e){return f=Math.max(e.length,f),n[e]=a,this},m.addBinaryOp=function(e,t){return u=Math.max(e.length,u),s[e]=t,this},m.addIdentifierChar=function(e){return o[e]=a,this},m.addLiteral=function(e,t){return l[e]=t,this},m.removeUnaryOp=function(e){return delete n[e],e.length===f&&(f=c(n)),this},m.removeAllUnaryOps=function(){return n={},f=0,this},m.removeIdentifierChar=function(e){return delete o[e],this},m.removeBinaryOp=function(e){return delete s[e],e.length===u&&(u=c(s)),this},m.removeAllBinaryOps=function(){return s={},u=0,this},m.removeLiteral=function(e){return delete l[e],this},m.removeAllLiterals=function(){return l={},this},void 0!==e&&e.exports?t=e.exports=m:t.parse=m}()},function(e,t,r){"use strict";t.a=function(e){a||(a=new n(e));return a};var i=r(10);let a=null;class n{constructor(e){this.map=e,this.renderer=new i.b,this.renderer._initGL(this.map._gl),this.invalidateWebGLState=(()=>{})}addLayer(e,t){this.map.addLayer(e,t)}needRefresh(){}}},function(e,t,r){"use strict";t.a=function(e){o.get(e)||o.set(e,new c(e));return o.get(e)};var i=r(14),a=r(10),n=r(4);let s=0;const o=new WeakMap;class c{constructor(e){this.renderer=new a.b,this.map=e,this.invalidateWebGLState=null,this._emitter=Object(i.a)(),this._suscribeToMapEvents(e),this.moveObservers={},this._layers=[],this._paintedLayers=0}on(e,t){return this._emitter.on(e,t)}off(e,t){return this._emitter.off(e,t)}_suscribeToMapEvents(e){e.on("movestart",this.move.bind(this)),e.on("move",this.move.bind(this)),e.on("moveend",this.move.bind(this)),e.on("resize",this.move.bind(this)),e.on("mousemove",e=>{this._emitter.emit("mousemove",e)}),e.on("click",e=>{this._emitter.emit("click",e)})}_registerMoveObserver(e,t){this.moveObservers[e]=t}_unregisterMoveObserver(e){delete this.moveObservers[e]}addLayer(e,t){const r=`_cartoGL_${s++}`,i=e.getId();this._registerMoveObserver(r,e.requestData.bind(e)),this.map.setCustomWebGLDrawCallback(i,(t,r)=>{if(this.invalidateWebGLState||(this.invalidateWebGLState=r,this.notifyObservers(),this.renderer._initGL(t),this._layers.map(e=>e.initCallback())),e.$paintCallback(),this._paintedLayers++,this._paintedLayers%this._layers.length==0){!this._layers.some(e=>e.getViz()&&e.getViz().isAnimated())&&this.map.repaint&&(this.map.repaint=!1)}r()}),this.map.addLayer({id:i,type:"custom-webgl"},t),this._layers.push(e),this.move()}needRefresh(){this.map.repaint=!0}move(){var e=this.map.getCenter();this.renderer.setCenter(e.lng/180,n.g(e).y/n.b),this.renderer.setZoom(this.getZoom()),this.notifyObservers()}notifyObservers(){Object.keys(this.moveObservers).map(e=>this.moveObservers[e]())}getZoom(){var e=this.map.getBounds(),t=this.map.getCenter(),r=e.getNorthWest(),i=e.getSouthWest(),a=(n.g(r).y-n.g(i).y)/n.a;return this.renderer.setCenter(t.lng/180,n.g(t).y/n.b),a}}},function(e,t,r){"use strict";var i=r(2),a=r(35);t.a=class{constructor(){this.dataframes=[],this.renderer=null,this.viz=null,this.type=null,this.customizedFeatures={}}addDataframe(e){this.type&&this._checkDataframeType(e),this.type=e.type,e.bind(this.renderer),this.dataframes.push(e)}removeDataframe(e){this.dataframes=this.dataframes.filter(t=>t!==e)}getActiveDataframes(){return this.dataframes.filter(e=>e.active)}hasDataframes(){return this.dataframes.length>0}getNumFeatures(){return this.dataframes.filter(e=>e.active).map(e=>e.numFeatures).reduce((e,t)=>e+t,0)}_checkDataframeType(e){if(this.type!=e.type)throw new Error("Layer dataframes must always be of the same type")}getFeaturesAtPosition(e){return this.viz?[].concat(...this.getActiveDataframes().map(t=>t.getFeaturesAtPosition(e,this.viz))).map(e=>{const t=t=>(r=500)=>{this.customizedFeatures[e.id]&&this.customizedFeatures[e.id][t]&&(this.customizedFeatures[e.id][t].replaceChild(this.customizedFeatures[e.id][t].mix,Object(i.blend)(Object(i.notEquals)(Object(i.property)("cartodb_id"),e.id),Object(i.animate)(0),Object(i.animate)(r))),this.viz[t].notify(),this.customizedFeatures[e.id][t]=void 0)},r=r=>{const n=this,s=e.properties;return{get value(){return n.viz[r].eval(s)},blendTo:(t,n=500)=>{if("string"==typeof t&&(t=Object(a.b)(t)),this.customizedFeatures[e.id]&&this.customizedFeatures[e.id][r])return void this.customizedFeatures[e.id][r].a.blendTo(t,n);const s=Object(i.blend)(t,this.viz[r],Object(i.blend)(1,Object(i.notEquals)(Object(i.property)("cartodb_id"),e.id),Object(i.animate)(n)));this.trackFeatureViz(e.id,r,s),this.viz.replaceChild(this.viz[r],s),this.viz[r].notify()},reset:t(r)}},n={};return Object.keys(this.viz.variables).map(e=>{n[e]=r("__cartovl_variable_"+e)}),{id:e.id,color:r("color"),width:r("width"),strokeColor:r("strokeColor"),strokeWidth:r("strokeWidth"),variables:n,reset:(e=500)=>{t("color")(e),t("width")(e),t("strokeColor")(e),t("strokeWidth")(e),Object.keys(this.viz.variables).map(r=>{n[r]=t("__cartovl_variable_"+r)(e)})}}}):[]}trackFeatureViz(e,t,r){this.customizedFeatures[e]=this.customizedFeatures[e]||{},this.customizedFeatures[e][t]=r}freeDataframes(){this.dataframes.map(e=>e.free()),this.dataframes=[],this.type=null}}},function(e,t,r){"use strict";var i=r(14),a=r(33),n=r(4),s=r(11);const o=["featureClick","featureClickOut","featureEnter","featureHover","featureLeave"];function c(e){if(!o.includes(e))throw new Error(`Unrecognized event: ${e}. Availiable events: ${o.join(", ")}`)}t.a=class{constructor(e){e instanceof a.a&&(e=[e]),function(e){if(!Array.isArray(e))throw new Error("Invalid layer list, parameter must be an array of carto.Layer objects");if(!e.length)throw new Error("Invalid argument, layer list must not be empty");if(!e.every(e=>e instanceof a.a))throw new Error("Invalid layer, layer must be an instance of carto.Layer")}(e),this._init(e)}on(e,t){return c(e),this._emitter.on(e,t)}off(e,t){return c(e),this._emitter.off(e,t)}_init(e){this._emitter=Object(i.a)(),this._layerList=e,this._prevHoverFeatures=[],this._prevClickFeatures=[],Promise.all(e.map(e=>e._context)).then(()=>{!function(e){if(!e.every(t=>t.getIntegrator()==e[0].getIntegrator()))throw new Error("Invalid argument, all layers must belong to the same map")}(e),this._subscribeToIntegratorEvents(e[0].getIntegrator())})}_subscribeToIntegratorEvents(e){e.on("mousemove",this._onMouseMove.bind(this)),e.on("click",this._onClick.bind(this))}_onMouseMove(e){const t=this._createFeatureEvent(e),r=t.features,i=this._getDiffFeatures(this._prevHoverFeatures,r),a=this._getDiffFeatures(r,this._prevHoverFeatures);i.length>0&&this._fireEvent("featureLeave",{coordinates:t.coordinates,position:t.position,features:i}),a.length>0&&this._fireEvent("featureEnter",{coordinates:t.coordinates,position:t.position,features:a}),this._prevHoverFeatures=t.features,this._fireEvent("featureHover",t)}_onClick(e){const t=this._createFeatureEvent(e),r=t.features,i=this._getDiffFeatures(this._prevClickFeatures,r);i.length>0&&this._fireEvent("featureClickOut",{coordinates:t.coordinates,position:t.position,features:i}),this._prevClickFeatures=t.features,this._fireEvent("featureClick",t)}_createFeatureEvent(e){const t=this._getFeaturesAtPosition(e.lngLat);return{coordinates:e.lngLat,position:e.point,features:t}}_fireEvent(e,t){this._emitter.emit(e,t)}_getFeaturesAtPosition(e){const t=Object(n.g)(e),r=Object(s.c)(t.x,t.y,{scale:n.b,center:{x:0,y:0}});return[].concat(...this._layerList.map(e=>e.getFeaturesAtPosition(r)))}_getDiffFeatures(e,t){const r=this._getFeatureIDs(t);return e.filter(e=>!r.includes(e.id))}_getFeatureIDs(e){return e.map(e=>e.id)}}}])});
//# sourceMappingURL=carto-vl.min.js.map
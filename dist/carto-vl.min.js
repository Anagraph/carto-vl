!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carto=t():e.carto=t()}(window,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(i,n,function(t){return e[t]}.bind(null,n));return i},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=41)}([function(e,t){!function(){"use strict";var r=function(e,t){var r=new Error(e+" at character "+t);throw r.index=t,r.description=e,r},i=!0,n={"-":i,"!":i,"~":i,"+":i},a={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},s={$:i,_:i},o=function(e){var t,r=0;for(var i in e)(t=i.length)>r&&e.hasOwnProperty(i)&&(r=t);return r},c=o(n),u=o(a),f={true:!0,false:!1,null:null},l=function(e){return a[e]||0},h=function(e,t,r){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:r}},d=function(e){return e>=48&&e<=57},p=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!a[String.fromCharCode(e)]||s.hasOwnProperty(String.fromCharCode(e))},m=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!a[String.fromCharCode(e)]||s.hasOwnProperty(String.fromCharCode(e))},g=function(e){for(var t,i,s=0,o=e.charAt,g=e.charCodeAt,b=function(t){return o.call(e,t)},_=function(t){return g.call(e,t)},y=e.length,v=function(){for(var e=_(s);32===e||9===e||10===e||13===e;)e=_(++s)},x=function(){var e,t,i=E();return v(),63!==_(s)?i:(s++,(e=x())||r("Expected expression",s),v(),58===_(s)?(s++,(t=x())||r("Expected expression",s),{type:"ConditionalExpression",test:i,consequent:e,alternate:t}):void r("Expected :",s))},w=function(){v();for(var t=e.substr(s,u),r=t.length;r>0;){if(a.hasOwnProperty(t)&&(!p(_(s))||s+t.length<e.length&&!m(_(s+t.length))))return s+=r,t;t=t.substr(0,--r)}return!1},E=function(){var e,t,i,n,a,o,c,u;if(o=T(),!(t=w()))return o;for(a={value:t,prec:l(t)},(c=T())||r("Expected expression after "+t,s),n=[o,a,c];(t=w())&&0!==(i=l(t));){for(a={value:t,prec:i};n.length>2&&i<=n[n.length-2].prec;)c=n.pop(),t=n.pop().value,o=n.pop(),e=h(t,o,c),n.push(e);(e=T())||r("Expected expression after "+t,s),n.push(a,e)}for(e=n[u=n.length-1];u>1;)e=h(n[u-1].value,n[u-2],e),u-=2;return e},T=function(){var t,r,i;if(v(),t=_(s),d(t)||46===t)return A();if(39===t||34===t)return C();if(91===t)return M();for(i=(r=e.substr(s,c)).length;i>0;){if(n.hasOwnProperty(r)&&(!p(_(s))||s+r.length<e.length&&!m(_(s+r.length))))return s+=i,{type:"UnaryExpression",operator:r,argument:T(),prefix:!0};r=r.substr(0,--i)}return!(!p(t)&&40!==t)&&D()},A=function(){for(var e,t,i="";d(_(s));)i+=b(s++);if(46===_(s))for(i+=b(s++);d(_(s));)i+=b(s++);if("e"===(e=b(s))||"E"===e){for(i+=b(s++),"+"!==(e=b(s))&&"-"!==e||(i+=b(s++));d(_(s));)i+=b(s++);d(_(s-1))||r("Expected exponent ("+i+b(s)+")",s)}return t=_(s),p(t)?r("Variable names cannot start with a number ("+i+b(s)+")",s):46===t&&r("Unexpected period",s),{type:"Literal",value:parseFloat(i),raw:i}},C=function(){for(var e,t="",i=b(s++),n=!1;s<y;){if((e=b(s++))===i){n=!0;break}if("\\"===e)switch(e=b(s++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return n||r('Unclosed quote after "'+t+'"',s),{type:"Literal",value:t,raw:i+t+i}},S=function(){var t,i=_(s),n=s;for(p(i)?s++:r("Unexpected "+b(s),s);s<y&&(i=_(s),m(i));)s++;return t=e.slice(n,s),f.hasOwnProperty(t)?{type:"Literal",value:f[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},R=function(e){for(var t,i,n=[],a=!1;s<y;){if(v(),(t=_(s))===e){a=!0,s++;break}44===t?s++:((i=x())&&"Compound"!==i.type||r("Expected comma",s),n.push(i))}return a||r("Expected "+String.fromCharCode(e),s),n},D=function(){var e,t;for(t=40===(e=_(s))?F():S(),v(),e=_(s);46===e||91===e||40===e;)s++,46===e?(v(),t={type:"MemberExpression",computed:!1,object:t,property:S()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:x()},v(),93!==(e=_(s))&&r("Unclosed [",s),s++):40===e&&(t={type:"CallExpression",arguments:R(41),callee:t}),v(),e=_(s);return t},F=function(){s++;var e=x();if(v(),41===_(s))return s++,e;r("Unclosed (",s)},M=function(){return s++,{type:"ArrayExpression",elements:R(93)}},L=[];s<y;)59===(t=_(s))||44===t?s++:(i=x())?L.push(i):s<y&&r('Unexpected "'+b(s)+'"',s);return 1===L.length?L[0]:{type:"Compound",body:L}};g.version="0.3.4",g.toString=function(){return"JavaScript Expression Parser (JSEP) v"+g.version},g.addUnaryOp=function(e){return c=Math.max(e.length,c),n[e]=i,this},g.addBinaryOp=function(e,t){return u=Math.max(e.length,u),a[e]=t,this},g.addIdentifierChar=function(e){return s[e]=i,this},g.addLiteral=function(e,t){return f[e]=t,this},g.removeUnaryOp=function(e){return delete n[e],e.length===c&&(c=o(n)),this},g.removeAllUnaryOps=function(){return n={},c=0,this},g.removeIdentifierChar=function(e){return delete s[e],this},g.removeBinaryOp=function(e){return delete a[e],e.length===u&&(u=o(a)),this},g.removeAllBinaryOps=function(){return a={},u=0,this},g.removeLiteral=function(e){return delete f[e],this},g.removeAllLiterals=function(){return f={},this},void 0!==e&&e.exports?t=e.exports=g:t.parse=g}()},function(e){e.exports={a:"0.5.3"}},function(e){e.exports="precision highp float;\n\nvarying vec2 uv;\n\n$style_preface\n$propertyPreface\n\nvoid main(void) {\n    vec2 featureID = uv;\n    gl_FragColor = $style_inline;\n}\n"},function(e){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t,r){e.exports=r(54)},function(e){function t(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===t||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function n(){d&&l&&(d=!1,l.length?h=l.concat(h):p=-1,h.length&&a())}function a(){if(!d){var e=i(n);d=!0;for(var t=h.length;t;){for(l=h,h=[];++p<t;)l&&l[p].run();p=-1,t=h.length}l=null,d=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function o(){}var c,u,f=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:t}catch(e){c=t}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var l,h=[],d=!1,p=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new s(e,t)),1!==h.length||d||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=o,f.addListener=o,f.once=o,f.off=o,f.removeListener=o,f.removeAllListeners=o,f.emit=o,f.prependListener=o,f.prependOnceListener=o,f.listeners=function(){return[]},f.binding=function(){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,r){"use strict";function i(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(n,this,t)}function n(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){var r=e.readVarint()+e.pos;for(;e.pos<r;){var i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function a(e){for(var t,r,i=0,n=0,a=e.length,s=a-1;n<a;s=n++)i+=((r=e[s]).x-(t=e[n]).x)*(t.y+r.y);return i}var s=r(50);e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,n=0,a=0,o=0,c=[];e.pos<r;){if(n<=0){var u=e.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)a+=e.readSVarint(),o+=e.readSVarint(),1===i&&(t&&c.push(t),t=[]),t.push(new s(a,o));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&c.push(t),c},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,n=0,a=0,s=1/0,o=-1/0,c=1/0,u=-1/0;e.pos<t;){if(i<=0){var f=e.readVarint();r=7&f,i=f>>3}if(i--,1===r||2===r)n+=e.readSVarint(),a+=e.readSVarint(),n<s&&(s=n),n>o&&(o=n),a<c&&(c=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[s,c,o,u]},i.prototype.toGeoJSON=function(e,t,r){function n(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+u)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+f)/c)*Math.PI/180))-90]}}var s,o,c=this.extent*Math.pow(2,r),u=this.extent*e,f=this.extent*t,l=this.loadGeometry(),h=i.types[this.type];switch(this.type){case 1:var d=[];for(s=0;s<l.length;s++)d[s]=l[s][0];n(l=d);break;case 2:for(s=0;s<l.length;s++)n(l[s]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,n=[],s=0;s<t;s++){var o=a(e[s]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&n.push(r),r=[e[s]]):r.push(e[s]))}return r&&n.push(r),n}(l),s=0;s<l.length;s++)for(o=0;o<l[s].length;o++)n(l[s][o])}1===l.length?l=l[0]:h="Multi"+h;var p={type:"Feature",geometry:{type:h,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p}},function(e,t,r){"use strict";function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(n,this,t),this.length=this._features.length}function n(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(r))}var a=r(6);e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,t,this.extent,this._keys,this._values)}},function(e){"use strict";function t(e,t,a){a=a||2;var s,o,c,l,d,p,m,g=t&&t.length,b=g?t[0]*a:e.length,_=r(e,0,b,a,!0),y=[];if(!_)return y;if(g&&(_=function(e,t,n,a){var s,o,c,l=[];for(s=0,o=t.length;s<o;s++)(c=r(e,t[s]*a,s<o-1?t[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),l.push(h(c));for(l.sort(u),s=0;s<l.length;s++)f(l[s],n),n=i(n,n.next);return n}(e,t,_,a)),e.length>80*a){s=c=e[0],o=l=e[1];for(var v=a;v<b;v+=a)p=e[v+1],(d=e[v])<s&&(s=d),p<o&&(o=p),d>c&&(c=d),p>l&&(l=p);m=0!==(m=Math.max(c-s,l-o))?1/m:0}return n(_,y,a,s,o,m),y}function r(e,t,r,i,n){var a,s;if(n===E(e,t,r,i)>0)for(a=t;a<r;a+=i)s=v(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=v(a,e[a],e[a+1],s);return s&&g(s,s.next)&&(x(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!g(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(x(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function n(e,t,r,u,f,h,d){if(e){!d&&h&&function(e,t,r,i){var n=e;do{null===n.z&&(n.z=l(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,a,s,o,c,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<u&&(o++,i=i.nextZ);t++);for(c=u;o>0||c>0&&i;)0!==o&&(0===c||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,u*=2}while(s>1)}(n)}(e,u,f,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?s(e,u,f,h):a(e))t.push(p.i/r),t.push(e.i/r),t.push(m.i/r),x(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?n(e=o(e,t,r),t,r,u,f,h,2):2===d&&c(e,t,r,u,f,h):n(i(e),t,r,u,f,h,1);break}}}function a(e){var t=e.prev,r=e,i=e.next;if(m(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(d(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&m(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,r,i){var n=e.prev,a=e,s=e.next;if(m(n,a,s)>=0)return!1;for(var o=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,c=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,u=l(n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,t,r,i),f=l(o,c,t,r,i),h=e.prevZ,p=e.nextZ;h&&h.z>=u&&p&&p.z<=f;){if(h!==e.prev&&h!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,h.x,h.y)&&m(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==e.prev&&h!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,h.x,h.y)&&m(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function o(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!g(n,a)&&b(n,i,i.next,a)&&_(n,a)&&_(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),x(i),x(i.next),i=e=a),i=i.next}while(i!==e);return i}function c(e,t,r,a,s,o){var c=e;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&p(c,u)){var f=y(c,u);return c=i(c,c.next),f=i(f,f.next),n(c,t,r,a,s,o),void n(f,t,r,a,s,o)}u=u.next}c=c.next}while(c!==e)}function u(e,t){return e.x-t.x}function f(e,t){if(t=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r.prev;var c,u=r,f=r.x,l=r.y,h=1/0;i=r.next;for(;i!==u;)n>=i.x&&i.x>=f&&n!==i.x&&d(a<l?n:s,a,f,l,a<l?s:n,a,i.x,i.y)&&((c=Math.abs(a-i.y)/(n-i.x))<h||c===h&&i.x>r.x)&&_(i,e)&&(r=i,h=c),i=i.next;return r}(e,t)){var r=y(t,e);i(r,r.next)}}function l(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function d(e,t,r,i,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,i){return!!(g(e,t)&&g(r,i)||g(e,i)&&g(r,t))||m(e,t,r)>0!=m(e,t,i)>0&&m(r,i,e)>0!=m(r,i,t)>0}function _(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function y(e,t){var r=new w(e.i,e.x,e.y),i=new w(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function v(e,t,r,i){var n=new w(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function x(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function w(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}e.exports=t,e.exports.default=t,t.deviation=function(e,t,r,i){var n=t&&t.length,a=Math.abs(E(e,0,n?t[0]*r:e.length,r));if(n)for(var s=0,o=t.length;s<o;s++){a-=Math.abs(E(e,t[s]*r,s<o-1?t[s+1]*r:e.length,r))}var c=0;for(s=0;s<i.length;s+=3){var u=i[s]*r,f=i[s+1]*r,l=i[s+2]*r;c+=Math.abs((e[u]-e[l])*(e[f+1]-e[u+1])-(e[u]-e[f])*(e[l+1]-e[u+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);n>0&&r.holes.push(i+=e[n-1].length)}return r}},function(e){e.exports="precision highp float;\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\n\nuniform bool overrideColor;\n\n$symbol_preface\n$propertyPreface\n\nvoid main(void) {\n    vec2 featureID = featureIDVar;\n    vec2 imageUV = gl_PointCoord.xy;\n    vec4 symbolColor = $symbol_inline;\n\n    vec4 c;\n    if (overrideColor){\n        c = color * vec4(vec3(1), symbolColor.a);\n    }else{\n        c = symbolColor;\n    }\n\n    gl_FragColor = vec4(c.rgb*c.a, c.a);\n}\n"},function(e){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform float devicePixelRatio;\nuniform vec2 resolution;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n//TODO order bucket texture\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x){\n    x*=255.;\n    if (x < 64.){\n        return x*0.25;\n    }else if (x<128.){\n        return (x-64.)+16.;\n    }else{\n        return (x-127.)*2.+80.;\n    }\n}\n\n$symbolPlacement_preface\n$propertyPreface\n\nvoid main(void) {\n    featureIDVar = featureID;\n    color = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n\n    float size = decodeWidth(texture2D(widthTex, featureID).a);\n    float fillSize = size;\n    if (size > 126.){\n        size = 126.;\n    }\n    gl_PointSize = size * devicePixelRatio;\n\n    vec4 p = vec4(vertexScale*vertexPosition-vertexOffset, 0.5, 1.);\n    p.xy += ($symbolPlacement_inline)*gl_PointSize/resolution;\n    if (size==0. || color.a==0. || size<orderMinWidth || size>=orderMaxWidth){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}\n"},function(e){e.exports="// From pixels in [0.,255.] to [0.,1.] in exponential-like form\nfloat encodeWidth(float x) {\n    if (x<16.){\n        x = x*4.;\n    }else if (x<80.){\n        x = (x-16.)+64.;\n    }else{\n        x = (x-80.)*0.5 + 128.;\n    }\n    return x / 255.;\n}\n\n$width_preface\n"},function(e){e.exports="precision highp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},function(e){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform vec2 normalScale;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x){\n    float w;\n    if (x < 0.25098039215686274){ // x < 64/255\n        w = 63.75 * x; // 255 * 0.25\n    }else if (x < 0.5019607843137255){ // x < 128/255\n        w = x*255. -48.;\n    }else {\n        w = x*510. -174.;\n    }\n    return w;\n}\n\nvoid main(void) {\n    color = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n    color.rgb *= color.a;\n    float size = decodeWidth(texture2D(widthTex, featureID).a);\n\n    vec4 p = vec4(vertexScale*(vertexPosition)+normalScale*normal*size-vertexOffset, 0.5, 1.);\n    if (size==0. || color.a==0.){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}\n"},function(e){e.exports="precision lowp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},function(e){e.exports="precision mediump float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform vec2 normalScale;\n\nuniform sampler2D colorTex;\nuniform sampler2D strokeColorTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x){\n    float w;\n    if (x < 0.25098039215686274){ // x < 64/255\n        w = 63.75 * x; // 255 * 0.25\n    }else if (x < 0.5019607843137255){ // x < 128/255\n        w = x*255. -48.;\n    }else {\n        w = x*510. -174.;\n    }\n    return w;\n}\n\nvoid main(void) {\n    vec4 c;\n    if (normal == vec2(0.)){\n        c = texture2D(colorTex, featureID);\n    }else{\n        c = texture2D(strokeColorTex, featureID);\n    }\n    float filtering = texture2D(filterTex, featureID).a;\n    c.a *= filtering;\n    float size = decodeWidth(texture2D(strokeWidthTex, featureID).a);\n\n    vec4 p = vec4(vertexScale*(vertexPosition)+normalScale*normal*size-vertexOffset, 0.5, 1.);\n\n    if (c.a==0.){\n        p.x=10000.;\n    }\n    color = vec4(c.rgb*c.a, c.a);\n    gl_Position  = p;\n}\n"},function(e){e.exports="precision highp float;\n\nvarying lowp vec4 color;\nvarying lowp vec4 stroke;\nvarying highp float dp;\nvarying highp float sizeNormalizer;\nvarying highp float fillScale;\nvarying highp float strokeScale;\n\nfloat distanceAntialias(vec2 p){\n    return 1. - smoothstep(1.-dp*1.4142, 1.+dp*1.4142, length(p));\n}\n\n\nvoid main(void) {\n    vec2 p = (2.*gl_PointCoord-vec2(1.))*sizeNormalizer;\n    vec4 c = color;\n\n    vec4 s = stroke;\n\n    c.a *= distanceAntialias(p*fillScale);\n    c.rgb*=c.a;\n\n    s.a *= distanceAntialias(p);\n    s.a *= 1.-distanceAntialias((strokeScale)*p);\n    s.rgb*=s.a;\n\n    c=s+(1.-s.a)*c;\n\n    gl_FragColor = c;\n}\n"},function(e){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform float devicePixelRatio;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D colorStrokeTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n//TODO order bucket texture\n\nvarying highp vec4 color;\nvarying highp vec4 stroke;\nvarying highp float dp;\nvarying highp float sizeNormalizer;\nvarying highp float fillScale;\nvarying highp float strokeScale;\n\n// From [0.,1.] in exponential-like form to pixels in [0.,255.]\nfloat decodeWidth(float x) {\n  float w;\n  if (x < 0.25098039215686274) { // x < 64/255\n    w = 63.75 * x; // 255 * 0.25\n  } else if (x < 0.5019607843137255) { // x < 128/255\n    w = x * 255. - 48.;\n  } else {\n    w = x * 510. - 174.;\n  }\n  return w;\n}\n\nvoid main(void) {\n  color = texture2D(colorTex, featureID);\n  stroke = texture2D(colorStrokeTex, featureID);\n  float filtering = texture2D(filterTex, featureID).a;\n  color.a *= filtering;\n  stroke.a *= filtering;\n\n  float size = decodeWidth(texture2D(widthTex, featureID).a);\n  float fillSize = size;\n  float strokeSize = decodeWidth(texture2D(strokeWidthTex, featureID).a);\n  size += strokeSize;\n  fillScale = size / fillSize;\n  strokeScale = size / max(0.001, (fillSize - strokeSize));\n  if (fillScale == strokeScale) {\n    stroke.a = 0.;\n  }\n  if (size > 126.) {\n    size = 126.;\n  }\n  gl_PointSize = size * devicePixelRatio + 2.;\n  dp = 1.0 / (size + 1.);\n  sizeNormalizer = (size + 1.) / (size);\n\n  vec4 p = vec4(vertexScale * vertexPosition - vertexOffset, 0.5, 1.);\n  if (size == 0. || (stroke.a == 0. && color.a == 0.) || size < orderMinWidth || size >= orderMaxWidth) {\n    p.x = 10000.;\n  }\n  gl_Position = p;\n}\n"},function(e){e.exports="precision highp float;\n\nvarying  vec2 uv;\n\nuniform sampler2D aaTex;\n\nvoid main(void) {\n    vec4 aa = texture2D(aaTex, uv);\n    gl_FragColor = aa;\n}\n"},function(e){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t,r){"use strict";function i(){return 1}function n(e){if(!(this instanceof n))return new n(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[p]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[p]=1/0);var r=e.length||i;"function"!=typeof r&&(r=i),this[g]=r,this[b]=e.stale||!1,this[_]=e.maxAge||0,this[y]=e.dispose,this[v]=e.noDisposeOnSet||!1,this.reset()}function a(e,t,r,i){var n=r.value;o(e,n)&&(u(e,r),e[b]||(n=void 0)),n&&t.call(i,n.value,n.key,e)}function s(e,t,r){var i=e[w].get(t);if(i){var n=i.value;o(e,n)?(u(e,i),e[b]||(n=void 0)):r&&e[x].unshiftNode(i),n&&(n=n.value)}return n}function o(e,t){if(!t||!t.maxAge&&!e[_])return!1;var r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[_]&&r>e[_]}function c(e){if(e[m]>e[p])for(var t=e[x].tail;e[m]>e[p]&&null!==t;){var r=t.prev;u(e,t),t=r}}function u(e,t){if(t){var r=t.value;e[y]&&e[y](r.key,r.value),e[m]-=r.length,e[w].delete(r.key),e[x].removeNode(t)}}e.exports=n;var f,l=r(48),h=r(46),d=r(42),p=(f="function"==typeof Symbol?function(e){return Symbol(e)}:function(e){return"_"+e})("max"),m=f("length"),g=f("lengthCalculator"),b=f("allowStale"),_=f("maxAge"),y=f("dispose"),v=f("noDisposeOnSet"),x=f("lruList"),w=f("cache");Object.defineProperty(n.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[p]=e,c(this)},get:function(){return this[p]},enumerable:!0}),Object.defineProperty(n.prototype,"allowStale",{set:function(e){this[b]=!!e},get:function(){return this[b]},enumerable:!0}),Object.defineProperty(n.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[_]=e,c(this)},get:function(){return this[_]},enumerable:!0}),Object.defineProperty(n.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=i),e!==this[g]&&(this[g]=e,this[m]=0,this[x].forEach(function(e){e.length=this[g](e.value,e.key),this[m]+=e.length},this)),c(this)},get:function(){return this[g]},enumerable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this[m]},enumerable:!0}),Object.defineProperty(n.prototype,"itemCount",{get:function(){return this[x].length},enumerable:!0}),n.prototype.rforEach=function(e,t){t=t||this;for(var r=this[x].tail;null!==r;){var i=r.prev;a(this,e,r,t),r=i}},n.prototype.forEach=function(e,t){t=t||this;for(var r=this[x].head;null!==r;){var i=r.next;a(this,e,r,t),r=i}},n.prototype.keys=function(){return this[x].toArray().map(function(e){return e.key},this)},n.prototype.values=function(){return this[x].toArray().map(function(e){return e.value},this)},n.prototype.reset=function(){this[y]&&this[x]&&this[x].length&&this[x].forEach(function(e){this[y](e.key,e.value)},this),this[w]=new l,this[x]=new d,this[m]=0},n.prototype.dump=function(){return this[x].map(function(e){if(!o(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},n.prototype.dumpLru=function(){return this[x]},n.prototype.inspect=function(e,t){var r="LRUCache {",n=!1;this[b]&&(r+="\n  allowStale: true",n=!0);var a=this[p];a&&a!==1/0&&(n&&(r+=","),r+="\n  max: "+h.inspect(a,t),n=!0);var s=this[_];s&&(n&&(r+=","),r+="\n  maxAge: "+h.inspect(s,t),n=!0);var c=this[g];c&&c!==i&&(n&&(r+=","),r+="\n  length: "+h.inspect(this[m],t),n=!0);var u=!1;return this[x].forEach(function(e){u?r+=",\n  ":(n&&(r+=",\n"),u=!0,r+="\n  ");var a=h.inspect(e.key).split("\n").join("\n  "),f={value:e.value};e.maxAge!==s&&(f.maxAge=e.maxAge),c!==i&&(f.length=e.length),o(this,e)&&(f.stale=!0),f=h.inspect(f,t).split("\n").join("\n  "),r+=a+" => "+f}),(u||n)&&(r+="\n"),r+="}"},n.prototype.set=function(e,t,r){var i=(r=r||this[_])?Date.now():0,n=this[g](t,e);if(this[w].has(e)){if(n>this[p])return u(this,this[w].get(e)),!1;var a=this[w].get(e).value;return this[y]&&(this[v]||this[y](e,a.value)),a.now=i,a.maxAge=r,a.value=t,this[m]+=n-a.length,a.length=n,this.get(e),c(this),!0}var s=new function(e,t,r,i,n){this.key=e,this.value=t,this.length=r,this.now=i,this.maxAge=n||0}(e,t,n,i,r);return s.length>this[p]?(this[y]&&this[y](e,t),!1):(this[m]+=s.length,this[x].unshift(s),this[w].set(e,this[x].head),c(this),!0)},n.prototype.has=function(e){return!!this[w].has(e)&&!o(this,this[w].get(e).value)},n.prototype.get=function(e){return s(this,e,!0)},n.prototype.peek=function(e){return s(this,e,!1)},n.prototype.pop=function(){var e=this[x].tail;return e?(u(this,e),e.value):null},n.prototype.del=function(e){u(this,this[w].get(e))},n.prototype.load=function(e){this.reset();for(var t=Date.now(),r=e.length-1;r>=0;r--){var i=e[r],n=i.e||0;if(0===n)this.set(i.k,i.v);else{var a=n-t;a>0&&this.set(i.k,i.v,a)}}},n.prototype.prune=function(){var e=this;this[w].forEach(function(t,r){s(e,r,!1)})}},function(e,t,r){"use strict";function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function n(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function a(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function s(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=e;n--)r.buf[n+i]=r.buf[n]}function o(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function c(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function u(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function f(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function l(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function h(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function d(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function p(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function m(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function b(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function _(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}e.exports=i;var y=r(49);i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=7&i,e(n,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=g(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=_(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=g(this.buf,this.pos)+4294967296*_(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=y.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=y.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:function(e,t,r){var i,n,s=r.buf;if(i=(112&(n=s[r.pos++]))>>4,n<128)return a(e,i,t);if(i|=(127&(n=s[r.pos++]))<<3,n<128)return a(e,i,t);if(i|=(127&(n=s[r.pos++]))<<10,n<128)return a(e,i,t);if(i|=(127&(n=s[r.pos++]))<<17,n<128)return a(e,i,t);if(i|=(127&(n=s[r.pos++]))<<24,n<128)return a(e,i,t);if(i|=(1&(n=s[r.pos++]))<<31,n<128)return a(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,r){for(var i="",n=t;n<r;){var a,s,o,c=e[n],u=null,f=c>239?4:c>223?3:c>191?2:1;if(n+f>r)break;1===f?c<128&&(u=c):2===f?128==(192&(a=e[n+1]))&&(u=(31&c)<<6|63&a)<=127&&(u=null):3===f?(s=e[n+2],128==(192&(a=e[n+1]))&&128==(192&s)&&((u=(15&c)<<12|(63&a)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===f&&(s=e[n+2],o=e[n+3],128==(192&(a=e[n+1]))&&128==(192&s)&&128==(192&o)&&((u=(15&c)<<18|(63&a)<<12|(63&s)<<6|63&o)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,f=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),n+=f}return i}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,i;if(e>=0?(r=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var i,n,a=0;a<t.length;a++){if((i=t.charCodeAt(a))>55295&&i<57344){if(!n){i>56319||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&s(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),y.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),y.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&s(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,i.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,o,t)},writePackedSVarint:function(e,t){this.writeMessage(e,c,t)},writePackedBoolean:function(e,t){this.writeMessage(e,l,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,f,t)},writePackedFixed32:function(e,t){this.writeMessage(e,h,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,d,t)},writePackedFixed64:function(e,t){this.writeMessage(e,p,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,m,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},function(e,t,r){e.exports.VectorTile=r(51),e.exports.VectorTileFeature=r(6),e.exports.VectorTileLayer=r(7)},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.524 1.5a.77.77 0 0 0-.69.395l-5.5 9.87C1.022 12.307 1.395 13 2 13h11c.605 0 .978-.692.666-1.236l-5.5-9.869a.773.773 0 0 0-.642-.395zM7.5 3.9l4.127 7.47H3.373L7.5 3.9z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.538 2c-.294 0-.488.177-.615.385l-5.846 9.538C1 12 1 12.153 1 12.308c0 .538.385.692.692.692h11.616c.384 0 .692-.154.692-.692 0-.154 0-.231-.077-.385l-5.77-9.538C8.029 2.177 7.789 2 7.539 2z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 3.19l1.07 2.68.25.63h3l-2 1.75-.5.44.23.63 1 3.13-2.48-1.77-.57-.4-.57.4-2.52 1.77 1-3.13.21-.63-.5-.44-2-1.75h3l.25-.63L7.5 3.19M7.5.5l-2 5h-5l4 3.5-2 6 5-3.5 5 3.5-2-6 4-3.5h-5l-2-5z" fill="#010101"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0l-2 5h-5l4 3.5-2 6 5-3.5 5 3.5-2-6 4-3.5h-5l-2-5z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M12.7 2.3v10.4H2.3V2.3h10.4M13 1H2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M13 14H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7 1c-.6 0-1 .4-1 1v4H2c-.6 0-1 .4-1 1v1c0 .6.4 1 1 1h4v4c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V9h4c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1H9V2c0-.6-.4-1-1-1H7z" fill="#010101"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path data-name="Layer 7" d="M7.5 14.941l-.4-.495c-.973-1.189-4.9-6.556-4.9-9.16A5.066 5.066 0 0 1 7.036 0q.222-.01.445 0a5.066 5.066 0 0 1 5.286 4.836q.01.225 0 .45c0 2.213-2.669 6.111-4.678 8.851zM7.481.986a4.077 4.077 0 0 0-4.3 4.3c0 1.832 2.759 6.038 4.286 8.034 1.25-1.71 4.315-5.989 4.315-8.034a4.077 4.077 0 0 0-4.3-4.3z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73 1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M6.65 2C5.43 2 4.48 3.38 4.11 3.82a.49.49 0 0 0-.11.32v4.4a.44.44 0 0 0 .72.36 3 3 0 0 1 1.93-1.17C8.06 7.73 8.6 9 10.07 9a5.28 5.28 0 0 0 2.73-1.09.49.49 0 0 0 .2-.4V2.45a.44.44 0 0 0-.62-.45 5.75 5.75 0 0 1-2.31 1.06C8.6 3.08 8.12 2 6.65 2zM2.5 3a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM3 4v9.48a.5.5 0 0 1-1 0V4a.5.5 0 0 1 1 0z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M2 13.748c0 .138.112.25.25.25h3.749v-3h3v3h3.749a.25.25 0 0 0 .25-.25v-5.75H2v5.75zm11.93-7.17l-.932-.82V2a1 1 0 1 0-2 0v2L7.681 1.09a.25.25 0 0 0-.353-.011l-.011.011-6.25 5.463a.25.25 0 0 0 .18.42L3 7h10.747a.25.25 0 0 0 .183-.421z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M2.64 1.27L7.5 6.13l4.84-4.84A.92.92 0 0 1 13 1a1 1 0 0 1 1 1 .9.9 0 0 1-.27.66L8.84 7.5l4.89 4.89A.9.9 0 0 1 14 13a1 1 0 0 1-1 1 .92.92 0 0 1-.69-.27L7.5 8.87l-4.85 4.85A.92.92 0 0 1 2 14a1 1 0 0 1-1-1 .9.9 0 0 1 .27-.66L6.16 7.5 1.27 2.61A.9.9 0 0 1 1 2a1 1 0 0 1 1-1c.24.003.47.1.64.27z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0a7.5 7.5 0 1 1 0 15 7.5 7.5 0 0 1 0-15zm0 1.667a5.833 5.833 0 1 0 0 11.666 5.833 5.833 0 0 0 0-11.666z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M14 7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M14 7a1.5 1.5 0 0 0-1.15-1.45l-1.39-3.24A.5.5 0 0 0 11 2H4a.5.5 0 0 0-.44.28L2.15 5.54A1.5 1.5 0 0 0 1 7v3.5h1v1a1 1 0 1 0 2 0v-1h7v1a1 1 0 1 0 2 0v-1h1V7zM4.3 3h6.4l1.05 2.5h-8.5L4.3 3zM3 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm9 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M4 0C2.636 0 1 .743 1 2.746V12s0 1 1 1v1s0 1 1 1 1-1 1-1v-1h7v1s0 1 1 1 1-1 1-1v-1s1 0 1-1V2.746C14 .701 12.764 0 11.4 0H4zm.25 1.5h6.5a.25.25 0 1 1 0 .5h-6.5a.25.25 0 1 1 0-.5zM3 3h9c1 0 1 .967 1 .967V7s0 1-1 1H3C2 8 2 7 2 7V4s0-1 1-1zm0 7a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm9 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M3 2v11h5v-3h3v3h1V2H3zm4 10H4v-2h3v2zm0-3H4V7h3v2zm0-3H4V4h3v2zm4 3H8V7h3v2zm0-3H8V4h3v2z"></path></svg>'},function(e){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 2c-.676-.01-.676 1.01 0 1H9v1.266L6.197 6.6 5.223 4H5.5c.676.01.676-1.01 0-1h-2c-.676-.01-.676 1.01 0 1h.652l.891 2.375A3.45 3.45 0 0 0 3.5 6C1.573 6 0 7.573 0 9.5S1.573 13 3.5 13 7 11.427 7 9.5c0-.67-.2-1.291-.53-1.824l2.821-2.35.463 1.16C8.71 7.094 8 8.211 8 9.5c0 1.927 1.573 3.5 3.5 3.5S15 11.427 15 9.5 13.427 6 11.5 6c-.283 0-.554.043-.818.107L10 4.402V2.5a.5.5 0 0 0-.5-.5h-2zm-4 5a2.48 2.48 0 0 1 1.555.553L3.18 9.115c-.511.427.128 1.195.64.77l1.875-1.563c.188.352.305.75.305 1.178C6 10.887 4.887 12 3.5 12S1 10.887 1 9.5 2.113 7 3.5 7zm8 0C12.887 7 14 8.113 14 9.5S12.887 12 11.5 12 9 10.887 9 9.5c0-.877.447-1.642 1.125-2.088l.91 2.274c.246.623 1.18.25.93-.372l-.908-2.27C11.2 7.02 11.348 7 11.5 7z"></path></svg>'},function(e,t,r){"use strict";function i(e){return{x:e.lng*Le*Ie,y:Math.log(Math.tan(e.lat*Le/2+Math.PI/4))*Ie}}function n(e){return void 0===e}function a(e){return"string"==typeof e}function s(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function o(e){if(e instanceof Date)return e;if("number"==typeof e){const t=e;return(e=new Date(0)).setUTCMilliseconds(t),e}return new Date(e)}function c(e){u(e),ze=e}function u(e){if(n(e))throw new $e("setup","authRequired");if(!s(e))throw new $e("setup","authObjectRequired");e.username=e.user,function(e){if(n(e))throw new $e("setup","apiKeyRequired");if(!a(e))throw new $e("setup","apiKeyStringRequired");if(""===e)throw new $e("setup","nonValidApiKey")}(e.apiKey),function(e){if(n(e))throw new $e("setup","usernameRequired");if(!a(e))throw new $e("setup","usernameStringRequired");if(""===e)throw new $e("setup","nonValidUsername")}(e.username)}function f(e){l(e),qe=e}function l(e){if(e){if(!s(e))throw new $e("setup","configObjectRequired");!function(e){if(!a(e))throw new $e("setup","serverURLStringRequired")}(e.serverURL)}}function h(e,t){const r=e.columns.concat(t.columns);return{columns:r.filter((e,t)=>r.indexOf(e)===t)}}function d(e,t,r){const i=t+r;if(Ze.has(e,i))return Ze.get(e,i);const n={},a=p(e,t,e.VERTEX_SHADER),s=p(e,r,e.FRAGMENT_SHADER);if(n.program=e.createProgram(),e.attachShader(n.program,a),e.attachShader(n.program,s),e.linkProgram(n.program),e.deleteShader(a),e.deleteShader(s),!e.getProgramParameter(n.program,e.LINK_STATUS))throw new Error("Unable to link the shader program: "+e.getProgramInfoLog(n.program));return n.programID=He++,Ze.set(e,i,n),n}function p(e,t,r){if(Ye.has(e,t))return Ye.get(e,t);const i=e.createShader(r);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(i);throw e.deleteShader(i),new Error("An error occurred compiling the shaders: "+r+"\nSource:\n"+t)}return Ye.set(e,t,i),i}function m(e,t,r,i){let n={};const a=e=>(void 0===n[e]&&(n[e]=Object.keys(n).length),`texture2D(propertyTex${n[e]}, featureID).a`);let s={};const o=new St;Object.keys(r).forEach(e=>{const t=r[e];t._setUID(o);const i=t._applyToShaderSource(a);s[e+"_preface"]=i.preface,s[e+"_inline"]=i.inline}),s.propertyPreface=Object.keys(n).map(e=>`uniform sampler2D propertyTex${n[e]};`).join("\n");const c=function(e,t,r){let i=t.vertexShader,n=t.fragmentShader;Object.keys(r).forEach(e=>{i=i.replace("$"+e,r[e]),n=n.replace("$"+e,r[e])});const a=d(e,i,n);return a.vertexAttribute=e.getAttribLocation(a.program,"vertex"),a.vertexPositionAttribute=e.getAttribLocation(a.program,"vertexPosition"),a.featureIdAttr=e.getAttribLocation(a.program,"featureID"),a.vertexScaleUniformLocation=e.getUniformLocation(a.program,"vertexScale"),a.vertexOffsetUniformLocation=e.getUniformLocation(a.program,"vertexOffset"),a.colorTexture=e.getUniformLocation(a.program,"colorTex"),a.colorStrokeTexture=e.getUniformLocation(a.program,"colorStrokeTex"),a.strokeWidthTexture=e.getUniformLocation(a.program,"strokeWidthTex"),a.widthTexture=e.getUniformLocation(a.program,"widthTex"),a.orderMinWidth=e.getUniformLocation(a.program,"orderMinWidth"),a.orderMaxWidth=e.getUniformLocation(a.program,"orderMaxWidth"),a.filterTexture=e.getUniformLocation(a.program,"filterTex"),a.devicePixelRatio=e.getUniformLocation(a.program,"devicePixelRatio"),a.resolution=e.getUniformLocation(a.program,"resolution"),a.overrideColor=e.getUniformLocation(a.program,"overrideColor"),a}(e,t,s);return Object.keys(n).map(t=>{n[t]=e.getUniformLocation(c.program,`propertyTex${n[t]}`)}),Object.values(r).forEach(t=>{t._postShaderCompile(c.program,e)}),c.textureIds||(c.textureIds=new Map),c.textureIds.set(i,n),c}function g(e,t){return new t(...e)}function b(e){return M(e)?Yn(e):"string"==typeof e?fa(e):Array.isArray(e)?en(e):e}function _(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1};if(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e))return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:1};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)/255};throw new Error("Invalid hexadecimal color")}function y(e){return{1:"first",2:"second",3:"third",4:"fourth"}[e]||String(e)}function v(e,t,r){return`${e}(): invalid ${y(r+1)} parameter '${t}'`}function x(e,t,r,i,n){E(e,t,r,n);const a=Array.isArray(i)?i.every(w):w(i);(void 0!==n.type||a)&&T(e,t,r,i,n)}function w(e){switch(e){case"number":case"number-array":case"number-property":case"category":case"category-array":case"category-property":return!1;default:return!0}}function E(e,t,r,i){if(!(i instanceof Rt))throw new Error(`${v(e,t,r)}\n        '${i}' is not of type carto.expressions.Base`)}function T(e,t,r,i,n){if(E(e,t,r,n),Array.isArray(i)){if(!i.some(e=>n.type===e))throw new Error(`${v(e,t,r)}\n            expected type was one of ${i.join()}, actual type was '${n.type}'`)}else n.type!==i&&function(e,t,r,i,n){throw new Error(`${v(e,t,r)}\nexpected type was '${i}', actual type was '${n}'`)}(e,t,r,i,n.type)}function A(e,t,r,i,n){E(e,t,r,n),n.isA(i)||function(e,t,r,i,n){throw new Error(`${v(e,t,r)}\n    '${n}' is not an instance of '${i.name}'`)}(e,t,r,i,n.type)}function C(e,t,r,i){M(i)||function(e,t,r,i){throw new Error(`${v(e,t,r)}\n    '${i}' is not a number`)}(e,t,r,i)}function S(e,t,r,i){"string"!=typeof i&&function(e,t,r,i){throw new Error(`${v(e,t,r)}\n    '${i}' is not a string`)}(e,t,r,i)}function R(e,t,r,i){Array.isArray(i)||function(e,t,r,i){throw new Error(`${v(e,t,r)}\n    '${i}' is not an array`)}(e,t,r,i)}function D(e,t,r,i){if(i.isFeatureDependent())throw new Error(`${v(e,t,r)}\n        parameter cannot be feature dependent`)}function F(e,t,r){return Math.min(Math.max(e,t),r)}function M(e){return Number.isFinite(e)||e===1/0||e===-1/0||Number.isNaN(e)}function L(e,t,r){return class extends Rt{constructor(r,i){r=b(r),i=b(i),E(e,"value",0,r),E(e,"list",1,i),x(e,"value",0,"category",r),x(e,"list",1,"category-array",i);let n={value:r};i.elems.map((e,t)=>{n[`arg${t}`]=e}),super(n),this.list=i,this.inlineMaker=t(this.list.elems),this.type="number"}eval(e){return r(this.value.eval(e),this.list.eval(e))}_compile(t){super._compile(t),T(e,"value",0,"category",this.value),T(e,"list",1,"category-array",this.list)}}}function I(e,t,r,i){return class extends Rt{constructor(i,n){if(Number.isFinite(i)&&Number.isFinite(n))return Yn(r(i,n));const a=function(e,t){if(e.type&&t.type)return"number"===e.type&&"number"===t.type?Pt:"number"===e.type&&"color"===t.type?kt:"color"===e.type&&"number"===t.type?kt:"color"===e.type&&"color"===t.type?Bt:"category"===e.type&&"category"===t.type?Ot:"image"===e.type&&"color"===t.type||"image"===e.type&&"color"===t.type||"image"===e.type&&"image"===t.type||"color"===e.type&&"image"===t.type?Nt:It;{if(!e.type&&!t.type)return;const r=e.type||t.type;if("color"===r)return kt}}(i=b(i),n=b(n));if(!(void 0===a||a!==It&&a&t))throw new Error(`${e}(): invalid parameter types\n'x' type was ${i.type}, 'y' type was ${n.type}`);super({a:i,b:n}),this.type=P(a)}get value(){return this.eval()}eval(e){return r(this.a.eval(e),this.b.eval(e))}_compile(r){super._compile(r);const[n,a]=[this.a,this.b],s=function(e,t){return e.type&&t.type?"number"===e.type&&"number"===t.type?Pt:"number"===e.type&&"color"===t.type?kt:"color"===e.type&&"number"===t.type?kt:"color"===e.type&&"color"===t.type?Bt:"category"===e.type&&"category"===t.type?Ot:"image"===e.type&&"color"===t.type||"image"===e.type&&"color"===t.type||"image"===e.type&&"image"===t.type||"color"===e.type&&"image"===t.type?Nt:It:void 0}(n,a);if(s===It||!(s&t))throw new Error(`${e}(): invalid parameter types\n'x' type was ${n.type}, 'y' type was ${a.type}`);this.type=P(s),this.inlineMaker=(e=>i(e.a,e.b))}}}function P(e){switch(e){case Pt:return"number";case kt:case Bt:return"color";case Ot:return"number";case Nt:return"image";default:return}}function k(e,t){if(!("number"===e.type&&"number"===t.type||"color"===e.type&&"color"===t.type))throw new Error(`blend(): invalid parameter types\n\t'a' type was '${e.type}'\n\t'b' type was ${t.type}'`)}function B(e,t){const r=e.replace("cluster","").toLowerCase();return class extends Rt{constructor(i){A(e,"property",0,rr,i),super({property:i}),this._aggName=r,this.type=t}get name(){return this.property.name}get aggName(){return this._aggName}get numCategories(){return this.property.numCategories}eval(e){return e[We.aggColumn(this.property.name,r)]}_compile(r){super._compile(r),T(e,"property",0,t,this.property)}_applyToShaderSource(e){return{preface:"",inline:`${e(We.aggColumn(this.property.name,r))}`}}_postShaderCompile(){}_getMinimumNeededSchema(){return{columns:[We.aggColumn(this.property.name,r)]}}}}function O(e,t){function r(t,r,i){if(E(e,t,r,i),"number"!==i.type&&"category"!==i.type&&void 0!==i.type)throw new Error(`${e}(): invalid parameter\n\t${t} type was: '${i.type}'`)}return class extends Rt{constructor(i,n,a,s){[i,n,a,s]=[i,n,a,s].map(b);const o={h:i,s:n,l:a};t&&(x(e,"a",3,"number",s),o.a=s),r("h",0,i),r("s",1,n),r("l",2,a),super(o),this.type="color"}get value(){return this.eval()}eval(e){const r=(t,r=!1)=>"category"===t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,i,n)=>{const a={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?this.a.eval(e):1},s=(1-Math.abs(2*n-1))*i;return a.r=F(a.r,0,1),a.g=F(a.g,0,1),a.b=F(a.b,0,1),a.r=255*((a.r-.5)*s+n),a.g=255*((a.g-.5)*s+n),a.b=255*((a.b-.5)*s+n),a})(F(r(this.h,!0),0,1),F(r(this.s),0,1),F(r(this.l),0,1))}_compile(e){super._compile(e),r("h",0,this.h),r("s",1,this.s),r("l",2,this.l),t&&T("hsla","a",3,"number",this.a);const i=(e,t=!1)=>"category"===e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSLtoRGB(vec3(\n                    ${e.h}${i(this.h,!0)},\n                    clamp(${e.s}${i(this.s)}, 0., 1.),\n                    clamp(${e.l}${i(this.l)}, 0., 1.)\n                )), ${t?`clamp(${e.a}, 0., 1.)`:"1."})`,"\n    #ifndef HSL2RGB\n    #define HSL2RGB\n    vec3 HSLtoRGB(vec3 HSL) {\n      float R = abs(HSL.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSL.x * 6. - 2.);\n      float B = 2. - abs(HSL.x * 6. - 4.);\n      float C = (1. - abs(2. * HSL.z - 1.)) * HSL.y;\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return (RGB - 0.5) * C + HSL.z;\n    }\n    #endif\n    ")}}}function N(e,t){function r(t,r,i){if(E(e,t,r,i),"number"!==i.type&&"category"!==i.type&&void 0!==i.type)throw new Error(`${e}(): invalid parameter\n\t${t} type was: '${i.type}'`)}return class extends Rt{constructor(i,n,a,s){const o={h:i=b(i),s:n=b(n),v:a=b(a)};t&&(s=b(s),x(e,"a",3,"number",s),o.a=s),r("h",0,i),r("s",1,n),r("v",2,a),super(o),this.type="color"}get value(){return this.eval()}eval(e){const r=(t,r=!1)=>"category"===t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,i,n)=>{const a={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?F(this.a.eval(e),0,1):1};return a.r=F(a.r,0,1),a.g=F(a.g,0,1),a.b=F(a.b,0,1),a.r=((a.r-1)*i+1)*n*255,a.g=((a.g-1)*i+1)*n*255,a.b=((a.b-1)*i+1)*n*255,a})(F(r(this.h,!0),0,1),F(r(this.s),0,1),F(r(this.v),0,1))}_compile(e){super._compile(e),r("h",0,this.h),r("s",1,this.s),r("v",2,this.v),t&&T("hsva","a",3,"number",this.a);const i=(e,t=!1)=>"category"===e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSVtoRGB(vec3(\n                    ${e.h}${i(this.h,!0)},\n                    clamp(${e.s}${i(this.s)}, 0.,1.),\n                    clamp(${e.v}${i(this.v)}, 0.,1.)\n                )), ${t?`clamp(${e.a}, 0.,1.)`:"1."})`,"\n    #ifndef HSV2RGB\n    #define HSV2RGB\n    vec3 HSVtoRGB(vec3 HSV) {\n      float R = abs(HSV.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSV.x * 6. - 2.);\n      float B = 2. - abs(HSV.x * 6. - 4.);\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return ((RGB - 1.) * HSV.y + 1.) * HSV.z;\n    }\n    #endif\n    ")}}}function U(e,t,r){const i=class extends Rt{constructor(e){super({m:e=b(e)})}eval(e){return r(this.m.eval(e))}_compile(r){if(super._compile(r),"number"!==this.m.type)throw new Error(`Blending cannot be performed by '${this.m.type}'`);this.type="number",this._setGenericGLSL(t=>e(t.m),t)}};return i.type="interpolator",i}function $(e){return function({x:e,y:t,z:r,a:i}){const n=Sr,a=Rr,s=Dr,o=e=>e>=.008856451679035631?Math.pow(e,.333333333333333):841/108*e+4/29;return{l:116*o(t/a)-16,a:500*(o(e/n)-o(t/a)),b:200*(o(t/a)-o(r/s)),alpha:i}}(function(e){const{r:t,g:r,b:i,a:n}=function({r:e,g:t,b:r,a:i}){const n=e=>e<=.0404482362771076?e/12.92:Math.pow((e+.055)/1.055,2.4);return{r:n(e),g:n(t),b:n(r),a:i}}(e);return{x:.41239558896741424*t+.3575834307637148*r+.18049264738170157*i,y:.21258623078559555*t+.7151703037034108*r+.07220049864333623*i,z:.019297215491746945*t+.11918386458084854*r+.9504971251315798*i,a:n}}(e))}function z(e){return function({x:e,y:t,z:r,a:i}){const n=F(3.2406*e-1.5372*t-.4986*r,0,1),a=F(-.9689*e+1.8758*t+.0415*r,0,1),s=F(.0557*e-.204*t+1.057*r,0,1);return function({r:e,g:t,b:r,a:i}){const n=e=>e<=.0031306684425005883?12.92*e:1.055*Math.pow(e,.4166666666666667)-.055;return{r:n(e),g:n(t),b:n(r),a:i}}({r:n,g:a,b:s,a:i})}(function({l:e,a:t,b:r,alpha:i}){const n=e=>e>=.20689655172413793?e*e*e:108/841*(e-4/29);return{x:Sr*n((e+16)/116+t/500),y:Rr*n((e+16)/116),z:Dr*n((e+16)/116-r/200),a:i}}(e))}function q(e,t,r){const i=$({r:e.r,g:e.g,b:e.b,a:e.a}),n=$({r:t.r,g:t.g,b:t.b,a:t.a});return z({l:(1-r)*i.l+r*n.l,a:(1-r)*i.a+r*n.a,b:(1-r)*i.b+r*n.b,alpha:(1-r)*i.alpha+r*n.alpha})}function V(e,t,r,i){switch(!0){case e.isA(er):return function(e,t,r){let i=G(e,t);e.isQuantitative()&&i.push(r);e.isQualitative()&&(r=i[t]);return X(t,i,r)}(t,r,i);case e.isA(Mr):return function(e,t,r){let i=G(e,t);e.isQualitative()&&(r=i[i.length-1]);return X(t,i,r)}(t,r,i);default:return function(e,t,r){let i=G(t,e.numCategories);t.isQualitative()&&(i.pop(),r=i[e.numCategories]);if(void 0===e.numCategories)return i;return X(e.numCategories,i,r)}(e,t,i)}}function G(e,t){return e.subPalettes[t]?e.subPalettes[t]:e.getLongestSubPalette()}function W(e,t,r,i){return e.type===Pr.CATEGORY?function(e,t,r,i){switch(!0){case e.isA(Cr)&&t<r.length:case e.isA(rr):return r;case t<r.length:return X(t,r,r[t]);case t>r.length:return j(r,i);default:return r=j(r,i),X(t,r,i)}}(e,r,t.colors,i):function(e,t){let r;if(e<t.length)return X(e,t,r=t[e]);if(e===t.length)return X(e,t,r=t[t.length-1]);return t}(e.numCategories,t.colors)}function j(e,t){return[...e,t]}function X(e,t,r){const i=[];for(let n=0;n<t.length;n++)n<e?i.push(t[n]):n===e&&i.push(r);return i}function H(e,t){return class extends Rt{constructor(r,i,n,a){[r,i,n,a]=[r,i,n,a].map(b),x(e,"r",0,"number",r),x(e,"g",1,"number",i),x(e,"b",2,"number",n);const s={r:r,g:i,b:n};t&&(x(e,"a",3,"number",a),s.a=a),super(s),this.type="color"}get value(){return this.eval()}eval(e){return{r:this.r.eval(e),g:this.g.eval(e),b:this.b.eval(e),a:t?this.a.eval(e):1}}_compile(r){super._compile(r),T(e,"r",0,"number",this.r),T(e,"g",1,"number",this.g),T(e,"b",2,"number",this.b),t&&T("rgba","a",3,"number",this.a),this.inlineMaker=(e=>`vec4(${e.r}/255., ${e.g}/255., ${e.b}/255., ${t?e.a:"1."})`)}}}function Y(e,t,r){return class extends Rt{constructor(t){t=b(t),x(e,"x",0,"number",t),super({a:t}),this.type="number"}get value(){return this.eval()}eval(e){return t(this.a.eval(e))}_compile(t){if(super._compile(t),T(e,"x",0,"number",this.a),"number"!==this.a.type)throw new Error(`Unary operation cannot be performed to '${this.a.type}'`);this.inlineMaker=(e=>r(e.a))}}}function Z(e,t,r,i){return class extends Rt{constructor(t){super({property:b("count"===e?Yn(0):t),_impostor:Yn(0)}),this._isViewport=!0}isFeatureDependent(){return!1}get value(){return i(this)}eval(){return i(this)}_compile(e){super._compile(e),this.property._compile(e),this.type="number",super.inlineMaker=(e=>e._impostor)}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_resetViewportAgg(){t(this)}accumViewportAgg(e){r(this,this.property.eval(e))}_preDraw(...e){this._impostor.expr=this.eval(),super._preDraw(...e)}}}function K(e){return class extends Rt{constructor(e){super({_value:Yn(0)}),this.property=b(e)}isFeatureDependent(){return!1}get value(){return this._value.expr}eval(){return this._value.expr}_compile(t){if(super._compile(t),this.property._compile(t),this.type="number",super.inlineMaker=(e=>e._value),void 0===t.properties[this.property.name][e])throw new Error(`Metadata ${e} for property ${this.property.name} is not defined`);this._value.expr=t.properties[this.property.name][e]}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_getColumnName(){return this.property.aggName?We.aggColumn(this.property.name,this.property.aggName):this.property.name}}}function Q(e,t){if(":"!==t.operator)throw new Error("Invalid syntax");t.left.name.length&&"@"===t.left.name[0]&&(t.left.name="__cartovl_variable_"+t.left.name.substr(1));const r=t.left.name;if(!r)throw new Error("Invalid syntax");if(r.startsWith("__cartovl_variable_"))e.variables[t.left.name.substr("__cartovl_variable_".length)]=b(J(t.right));else if("resolution"===r){const i=J(t.right);e[r]=i}else{const i=J(t.right);e[r]=b(i)}}function J(e){if("CallExpression"===e.type)return function(e){const t=e.callee.name.toLowerCase();if(_s.includes(t))return e.arguments.map(e=>J(e))[0];const r=e.arguments.map(e=>J(e));if(ys[t])return ys[t](...r);throw new Error(`Invalid function name '${e.callee.name}'`)}(e);if("Literal"===e.type)return e.value;if("ArrayExpression"===e.type)return e.elements.map(e=>J(e));if("BinaryExpression"===e.type)return function(e){const t=J(e.left),r=J(e.right);switch(e.operator){case"*":return an(t,r);case"/":return sn(t,r);case"+":return on(t,r);case"-":return cn(t,r);case"%":return fn(t,r);case"^":return un(t,r);case">":return ln(t,r);case">=":return hn(t,r);case"<":return dn(t,r);case"<=":return pn(t,r);case"==":return mn(t,r);case"!=":return gn(t,r);case"and":return bn(t,r);case"or":return _n(t,r);default:throw new Error(`Invalid binary operator '${e.operator}'`)}}(e);if("UnaryExpression"===e.type)return function(e){switch(e.operator){case"-":return an(-1,J(e.argument));case"+":return J(e.argument);default:throw new Error(`Invalid unary operator '${e.operator}'`)}}(e);if("Identifier"===e.type)return function(e){if(e.name.length&&"@"===e.name[0]&&(e.name="__cartovl_variable_"+e.name.substr(1)),e.name.startsWith("__cartovl_variable_"))return Sa(e.name.substr("__cartovl_variable_".length));if("#"===e.name[0])return new ur(e.name);if("$"===e.name[0])return ra(e.name.substring(1));if(Tr[e.name.toUpperCase()])return Tr[e.name.toUpperCase()];if(ys[e.name.toLowerCase()])return ys[e.name.toLowerCase()];if(mr.includes(e.name.toLowerCase()))return new gr(e.name.toLowerCase());throw new Error(`Invalid expression '${JSON.stringify(e)}'`)}(e);throw new Error(`Invalid expression '${JSON.stringify(e)}'`)}function ee(){bs.a.addBinaryOp(":",0),bs.a.addBinaryOp("^",11),bs.a.addBinaryOp("or",1),bs.a.addBinaryOp("and",2),bs.a.addIdentifierChar("@"),bs.a.addIdentifierChar("#"),bs.a.removeLiteral("true"),bs.a.removeLiteral("false")}function te(){bs.a.removeBinaryOp("and"),bs.a.removeBinaryOp("or"),bs.a.removeBinaryOp("^"),bs.a.removeBinaryOp(":"),bs.a.removeIdentifierChar("@"),bs.a.removeIdentifierChar("#"),bs.a.addLiteral("true"),bs.a.addLiteral("false")}function re(e){return e.default=!0,e}function ie(e,t,r,i,n,a){return function(s,o=500){if("string"==typeof s&&(s=function(e){ee();const t=b(J(bs()(e)));return te(),t}(s)),r[t.id]&&r[t.id][e])return void r[t.id][e].a.blendTo(s,o);const c=An(s,i[e],An(1,gn(ra(a),t.id),Ji(o)));n(t.id,e,c,r),i.replaceChild(i[e],c),i[e].notify()}}function ne(e,t,r){return{x:(e-r.center.x)/r.scale,y:(t-r.center.y)/r.scale}}function ae(e,t,r=Math.ceil){return function(e,t){const[r,i,n,a]=t,s=1<<e,o=e=>Math.min(Math.max(e,0),s-1),c=o(Math.floor(s*(r+1)*.5)),u=o(Math.ceil(s*(n+1)*.5)-1),f=o(Math.floor(s*(1-a)*.5)),l=o(Math.ceil(s*(1-i)*.5)-1);let h=[];for(let t=c;t<=u;++t)for(let r=f;r<=l;++r)h.push({x:t,y:r,z:e});return h}(r(e),t)}function se(e,t,r){return{center:{x:(e+.5)/Math.pow(2,r)*2-1,y:2*(1-(t+.5)/Math.pow(2,r))-1},scale:1/Math.pow(2,r)}}function oe(e){if(!Ys.includes(e))throw new Error(`Unrecognized event: ${e}. Available events: ${Ys.join(", ")}`)}function ce([e,t],[r,i]){return[e-r,t-i]}function ue([e,t],[r,i]){return e*r+t*i}function fe([e,t]){return[-t,e]}function le(e,t){let r=[];return e.map(e=>{let i=[];e.map(e=>{i.push([2*e.x/t-1,2*(1-e.y/t)-1])}),r.push(...function(e){function t(e){let t=0;for(let r=0;r<io;r++)t|=ro[r].inside(e)?0:1<<r;return t}function r(e,r,i){for(let n=0;n<io;n++){const a=1<<n;if(i&a){const s=ro[n].intersect(e,r);return i=t(s)&~a,[s,i]}}}let i=[];const n=[];let a=e[0],s=t(a);for(let o=1;o<e.length;++o){let c=e[o],u=t(c);const f=u,l=c;for(;;){if(!(s|u)){i.push(...a),u!==f?(i.push(...c),o<e.length-1&&(n.push(i),i=[])):o===e.length-1&&i.push(...c);break}if(s&u)break;s?[a,s]=r(a,c,s):[c,u]=r(a,c,u)}a=l,s=f}(i=function(e){const t=[];let r,i;for(let n=0;n<e.length;n+=2){const a=e[n],s=e[n+1];a===r&&s===i||(t.push(a,s),r=a,i=s)}return t}(i)).length>0&&n.push(i);return n}(i))}),r}function he(e,t){let r,i=null,n=[];return e.forEach(e=>{let a=function(e){let t=0;for(let r=0;r<e.length;r++){let i=(r+1)%e.length;t+=e[r].x*e[i].y,t-=e[i].x*e[r].y}return t/2}(e);if(0===a)return;void 0===r&&(r=a>0);const s=r?a>0:a<0,o=function(e,t){return e.map(e=>{let r=e.x,i=e.y;return[r=2*r/t-1,i=2*(1-i/t)-1]})}(e,t);s&&(i&&n.push(i),i=new to),i=function(e,t,r){let i={};for(let t=0;t<io;t++){const r=[],n={},a=(e,t,r=-1)=>{let a=0;t>=0&&(a=i[t]||0),r>=0&&(a|=1<<r),a&&(n[e]=a)};for(let i=0;i<e.length-1;i++){const n=e[i],s=e[i+1],o=ro[t].inside(n),c=ro[t].inside(s);if(o&&c)a(r.length,i+1),r.push(s);else if(o){const e=ro[t].intersect(n,s);a(r.length,i+1,t),r.push(e)}else if(c){const e=ro[t].intersect(n,s);a(r.length,i,t),r.push(e),a(r.length,i+1),r.push(s)}}r.length&&(n[0]&&(n[r.length]=n[0]),r.push(r[0])),e=r,i=n}e.length>=4&&(r&&t.holes.push(t.flat.length/2),e.forEach(e=>{t.flat.push(e[0],e[1])}),Object.keys(i).forEach(e=>{t.clipped.push(2*Number(e)),t.clippedType.push(i[e])}));return t}(o,i,!s)}),i&&n.push(i),n}function de(e,t){return me([-(t[1]-e[1]),t[0]-e[0]])}function pe(e,t,r){const i=me([e[0]-t[0],e[1]-t[1]]),n=me([r[0]-t[0],r[1]-t[1]]),a=-i[1]*n[0]+i[0]*n[1];if(0!==a)return[(i[0]+n[0])/a,(i[1]+n[1])/a]}function me(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function ge(e,t,r,i){if(_e(t,r)||_e(r,i)||_e(i,t))return!1;const n=be(e,t,r)<0,a=be(e,r,i)<0,s=be(e,i,t)<0;return n===a&&a===s}function be(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function _e(e,t){return e.x===t.x&&e.y===t.y}function ye(e,t,r){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n<=r*r}function ve(e){return e.type?`(${yo[e.type](e)})`:xe(e)}function xe(e){return isFinite(e)?String(e):`'${e.replace(/\'/g,"''")}'`}function we(e){return e.match(/^[a-z\d_]+$/)||(e=`"${e.replace(/\"/g,'""')}"`),e}function Ee(e,...t){return t.map(e=>ve(e)).join(e)}function Te(e,t={}){const r=new bo(t),i={preaggregation:new _o(t).getFilter(e.filter),aggregation:r.getFilters(e.filter)};return i.preaggregation||i.aggregation?i:null}function Ae(e,t){return`${e}=${encodeURIComponent(t)}`}function Ce(e,t=[]){return`${e}?${t.join("&")}`}function Se(e,t){let r=`${e.serverURL}/api/v1/map`;return t&&(r+=t),r}r.r(t);var Re={};r.r(Re),r.d(Re,"validation",function(){return Be});var De={};r.r(De),r.d(De,"colorShaderGLSL",function(){return yt}),r.d(De,"filterShaderGLSL",function(){return vt}),r.d(De,"widthShaderGLSL",function(){return xt});var Fe={};r.r(Fe),r.d(Fe,"symbolShaderGLSL",function(){return At});var Me={};r.r(Me),r.d(Me,"transition",function(){return Ji}),r.d(Me,"array",function(){return en}),r.d(Me,"nin",function(){return rn}),r.d(Me,"in",function(){return tn}),r.d(Me,"between",function(){return nn}),r.d(Me,"mul",function(){return an}),r.d(Me,"div",function(){return sn}),r.d(Me,"add",function(){return on}),r.d(Me,"sub",function(){return cn}),r.d(Me,"pow",function(){return un}),r.d(Me,"mod",function(){return fn}),r.d(Me,"greaterThan",function(){return ln}),r.d(Me,"greaterThanOrEqualTo",function(){return hn}),r.d(Me,"lessThan",function(){return dn}),r.d(Me,"lessThanOrEqualTo",function(){return pn}),r.d(Me,"equals",function(){return mn}),r.d(Me,"notEquals",function(){return gn}),r.d(Me,"and",function(){return bn}),r.d(Me,"or",function(){return _n}),r.d(Me,"gt",function(){return yn}),r.d(Me,"gte",function(){return vn}),r.d(Me,"lt",function(){return xn}),r.d(Me,"lte",function(){return wn}),r.d(Me,"eq",function(){return En}),r.d(Me,"neq",function(){return Tn}),r.d(Me,"blend",function(){return An}),r.d(Me,"buckets",function(){return Cn}),r.d(Me,"cielab",function(){return Sn}),r.d(Me,"clusterAvg",function(){return Rn}),r.d(Me,"clusterMax",function(){return Dn}),r.d(Me,"clusterMin",function(){return Fn}),r.d(Me,"clusterMode",function(){return Mn}),r.d(Me,"clusterSum",function(){return Ln}),r.d(Me,"constant",function(){return In}),r.d(Me,"image",function(){return Pn}),r.d(Me,"imageList",function(){return kn}),r.d(Me,"sprite",function(){return Bn}),r.d(Me,"sprites",function(){return On}),r.d(Me,"svg",function(){return Nn}),r.d(Me,"hex",function(){return Un}),r.d(Me,"hsl",function(){return $n}),r.d(Me,"hsla",function(){return zn}),r.d(Me,"hsv",function(){return qn}),r.d(Me,"hsva",function(){return Vn}),r.d(Me,"cubic",function(){return Gn}),r.d(Me,"ilinear",function(){return Wn}),r.d(Me,"linear",function(){return jn}),r.d(Me,"namedColor",function(){return Xn}),r.d(Me,"now",function(){return Hn}),r.d(Me,"number",function(){return Yn}),r.d(Me,"opacity",function(){return Zn}),r.d(Me,"asc",function(){return Kn}),r.d(Me,"desc",function(){return Qn}),r.d(Me,"noOrder",function(){return Jn}),r.d(Me,"width",function(){return ea}),r.d(Me,"reverse",function(){return ta}),r.d(Me,"property",function(){return ra}),r.d(Me,"prop",function(){return ra}),r.d(Me,"viewportQuantiles",function(){return ia}),r.d(Me,"globalQuantiles",function(){return na}),r.d(Me,"globalEqIntervals",function(){return aa}),r.d(Me,"viewportEqIntervals",function(){return sa}),r.d(Me,"ramp",function(){return oa}),r.d(Me,"rgb",function(){return ca}),r.d(Me,"rgba",function(){return ua}),r.d(Me,"category",function(){return fa}),r.d(Me,"time",function(){return la}),r.d(Me,"date",function(){return la}),r.d(Me,"top",function(){return ha}),r.d(Me,"fade",function(){return da}),r.d(Me,"animation",function(){return pa}),r.d(Me,"torque",function(){return ma}),r.d(Me,"log",function(){return ga}),r.d(Me,"sqrt",function(){return ba}),r.d(Me,"sin",function(){return _a}),r.d(Me,"cos",function(){return ya}),r.d(Me,"tan",function(){return va}),r.d(Me,"sign",function(){return xa}),r.d(Me,"abs",function(){return wa}),r.d(Me,"isNaN",function(){return Ea}),r.d(Me,"not",function(){return Ta}),r.d(Me,"floor",function(){return Aa}),r.d(Me,"ceil",function(){return Ca}),r.d(Me,"variable",function(){return Sa}),r.d(Me,"var",function(){return Sa}),r.d(Me,"viewportAvg",function(){return Ra}),r.d(Me,"viewportMax",function(){return Da}),r.d(Me,"viewportMin",function(){return Fa}),r.d(Me,"viewportSum",function(){return Ma}),r.d(Me,"viewportCount",function(){return La}),r.d(Me,"viewportPercentile",function(){return Ia}),r.d(Me,"viewportHistogram",function(){return Pa}),r.d(Me,"viewportFeatures",function(){return ka}),r.d(Me,"globalAvg",function(){return Ba}),r.d(Me,"globalMax",function(){return Oa}),r.d(Me,"globalMin",function(){return Na}),r.d(Me,"globalSum",function(){return Ua}),r.d(Me,"globalCount",function(){return $a}),r.d(Me,"globalPercentile",function(){return za}),r.d(Me,"xyz",function(){return qa}),r.d(Me,"zoom",function(){return Va}),r.d(Me,"placement",function(){return Ga}),r.d(Me,"HOLD",function(){return Wa}),r.d(Me,"TRUE",function(){return ja}),r.d(Me,"FALSE",function(){return Xa}),r.d(Me,"PI",function(){return Ha}),r.d(Me,"E",function(){return Ya}),r.d(Me,"BICYCLE",function(){return Za}),r.d(Me,"BUILDING",function(){return Ka}),r.d(Me,"BUS",function(){return Qa}),r.d(Me,"CAR",function(){return Ja}),r.d(Me,"CIRCLE",function(){return es}),r.d(Me,"CIRCLE_OUTLINE",function(){return ts}),r.d(Me,"CROSS",function(){return rs}),r.d(Me,"FLAG",function(){return is}),r.d(Me,"HOUSE",function(){return ns}),r.d(Me,"MARKER",function(){return as}),r.d(Me,"MARKER_OUTLINE",function(){return ss}),r.d(Me,"PLUS",function(){return os}),r.d(Me,"SQUARE",function(){return cs}),r.d(Me,"SQUARE_OUTLINE",function(){return us}),r.d(Me,"STAR",function(){return fs}),r.d(Me,"STAR_OUTLINE",function(){return ls}),r.d(Me,"TRIANGLE",function(){return hs}),r.d(Me,"TRIANGLE_OUTLINE",function(){return ds}),r.d(Me,"ALIGN_CENTER",function(){return ps}),r.d(Me,"ALIGN_BOTTOM",function(){return ms}),r.d(Me,"palettes",function(){return Tr}),r.d(Me,"Asc",function(){return _r}),r.d(Me,"Desc",function(){return yr});const Le=Math.PI/180,Ie=6378137,Pe=Ie*Math.PI;var ke={WM_R:Pe,WM_2R:2*Pe,projectToWebMercator:i,isUndefined:n,isString:a,isNumber:function(e){return"number"==typeof e},isObject:s,castDate:o,isSetsEqual:function(e,t){return e.size===t.size&&[...e].every(e=>t.has(e))}};const Be={layer:{"id-required":{messageRegex:/idRequired/,friendlyMessage:"`id` property required."},"id-string-required":{messageRegex:/idStringRequired/,friendlyMessage:"`id` property must be a string."},"non-valid-id":{messageRegex:/nonValidId/,friendlyMessage:"`id` property must be not empty."},"source-required":{messageRegex:/sourceRequired/,friendlyMessage:"`source` property required."},"non-valid-source":{messageRegex:/nonValidSource/,friendlyMessage:'The given object is not a valid source. See "carto.source.Base".'},"viz-required":{messageRegex:/vizRequired/,friendlyMessage:"`viz` property required."},"non-valid-viz":{messageRegex:/nonValidViz/,friendlyMessage:'The given object is not a valid viz. See "carto.Viz".'},"shared-viz":{messageRegex:/sharedViz/,friendlyMessage:"The given Viz object is already bound to another layer. Vizs cannot be shared between different layers"}},setup:{"auth-required":{messageRegex:/authRequired/,friendlyMessage:"`auth` property is required."},"auth-object-required":{messageRegex:/authObjectRequired/,friendlyMessage:"`auth` property must be an object."},"api-key-required":{messageRegex:/apiKeyRequired/,friendlyMessage:"`apiKey` property is required."},"api-key-string-required":{messageRegex:/apiKeyStringRequired/,friendlyMessage:"`apiKey` property must be a string."},"non-valid-api-key":{messageRegex:/nonValidApiKey/,friendlyMessage:"`apiKey` property must be not empty."},"username-required":{messageRegex:/usernameRequired/,friendlyMessage:"`username` property is required."},"username-string-required":{messageRegex:/usernameStringRequired/,friendlyMessage:"`username` property must be a string."},"non-valid-username":{messageRegex:/nonValidUsername/,friendlyMessage:"`username` property must be not empty."},"config-object-required":{messageRegex:/configObjectRequired/,friendlyMessage:"`config` property must be an object."},"server-url-string-required":{messageRegex:/serverURLStringRequired/,friendlyMessage:"`serverURL` property must be a string."}},source:{"non-valid-server-url":{messageRegex:/nonValidServerURL/,friendlyMessage:"`serverURL` property is not a valid URL."},"non-valid-template-url":{messageRegex:/nonValidTemplateURL/,friendlyMessage:"`templateURL` property is not a valid URL."},"metadata-required":{messageRegex:/metadataRequired/,friendlyMessage:"`metadata` property is required for MVT source."},"table-name-required":{messageRegex:/tableNameRequired/,friendlyMessage:"`tableName` property is required."},"table-name-string-required":{messageRegex:/tableNameStringRequired$/,friendlyMessage:"`tableName` property must be a string."},"non-valid-table-name":{messageRegex:/nonValidTableName$/,friendlyMessage:"`tableName` property must be not empty."},"query-required":{messageRegex:/queryRequired/,friendlyMessage:"`query` property is required."},"query-string-required":{messageRegex:/queryStringRequired$/,friendlyMessage:"`query` property must be a string."},"non-valid-query":{messageRegex:/nonValidQuery$/,friendlyMessage:"`query` property must be not empty."},"non-valid-sql-query":{messageRegex:/nonValidSQLQuery$/,friendlyMessage:"`query` property must be a SQL query."},"data-required":{messageRegex:/dataRequired/,friendlyMessage:"`data` property is required."},"data-object-required":{messageRegex:/dataObjectRequired$/,friendlyMessage:"`data` property must be an object."},"non-valid-geojson-data":{messageRegex:/nonValidGeoJSONData$/,friendlyMessage:"`data` property must be a GeoJSON object."},"multiple-feature-types":{messageRegex:/multipleFeatureTypes\[(.+)\]$/,friendlyMessage:"multiple types not supported: $0."},"first-polygon-external":{messageRegex:/firstPolygonExternal$/,friendlyMessage:"first polygon ring must be external."},"feature-has-cartodb_id":{messageRegex:/featureHasCartodbId$/,friendlyMessage:"`cartodb_id` is a reserved property so it can not be used"}},viz:{"non-valid-definition":{messageRegex:/nonValidDefinition$/,friendlyMessage:"viz definition should be a vizSpec object or a valid viz string."},"non-valid-expression":{messageRegex:/nonValidExpression\[(.+)\]$/,friendlyMessage:"`$0` parameter is not a valid viz Expresion."},"resolution-number-required":{messageRegex:/resolutionNumberRequired$/,friendlyMessage:"`resolution` must be a number."},"resolution-too-small":{messageRegex:/resolutionTooSmall\[(.+)\]$/,friendlyMessage:"`resolution` must be greater than $0."},"resolution-too-big":{messageRegex:/resolutionTooBig\[(.+)\]$/,friendlyMessage:"`resolution` must be less than $0."}}},Oe="unexpected error",Ne="generic";class Ue extends Error{constructor(e){super(e&&e.message||Oe),this.name="CartoError",this.originalError=e,this.type=e&&e.type||"",this.origin=e&&e.origin||Ne;const t=this._getExtraFields();this.message=t.friendlyMessage}_getExtraFields(){const e=this._getErrorList();for(let t in e){const r=e[t];if(!(r.messageRegex instanceof RegExp))throw new Error(`MessageRegex on ${t} is not a RegExp.`);if(r.messageRegex.test(this.message))return{friendlyMessage:this._replaceRegex(r)}}return{friendlyMessage:this.message||""}}_getErrorList(){return Re[this.origin]&&Re[this.origin][this.type]}_replaceRegex(e){if(!e.friendlyMessage)return this.message;const t=this.message&&this.message.match(e.messageRegex);return t&&t.length>1?e.friendlyMessage.replace("$0",t[1]):e.friendlyMessage}}class $e extends Ue{constructor(e,t){super({origin:"validation",type:e,message:t})}}let ze,qe;const Ve={columns:[]},Ge=new RegExp("^_cdb_agg_[a-zA-Z0-9]+_"),We={isAggregated:function(e){return e.startsWith("_cdb_agg_")},getBase:function(e){return e.replace(Ge,"")},getAggFN:function(e){let t=e.substr("_cdb_agg_".length);return t.substr(0,t.indexOf("_"))},aggColumn:(e,t)=>`_cdb_agg_${t}_${e}`};var je={column:We,equals:function(e,t){return!(!e||!t)&&e.columns.length===t.columns.length&&e.columns.every(e=>t.columns.includes(e))},union:h,IDENTITY:Ve};class Xe{constructor(){this.caches=new WeakMap}get(e,t){if(this.caches.has(e)){return this.caches.get(e)[t]}}set(e,t,r){if(this.caches.has(e)){this.caches.get(e)[t]=r}else{let i={};i[t]=r,this.caches.set(e,i)}}has(e,t){return void 0!==this.get(e,t)}}let He=1;const Ye=new Xe,Ze=new Xe;var Ke=r(18),Qe=r.n(Ke),Je=r(19),et=r.n(Je);var tt=r(12),rt=r.n(tt),it=r(13),nt=r.n(it);var at=r(16),st=r.n(at),ot=r(17),ct=r.n(ot);var ut=r(14),ft=r.n(ut),lt=r(15),ht=r.n(lt);var dt=r(11),pt=r.n(dt),mt=r(2),gt=r.n(mt),bt=r(3),_t=r.n(bt);const yt={vertexShader:`${_t.a}`,fragmentShader:`${gt.a}`.replace("$style_inline","$color_inline").replace("$style_preface","$color_preface")},vt={vertexShader:`${_t.a}`,fragmentShader:`${gt.a}`.replace("$style_inline","vec4($filter_inline)").replace("$style_preface","$filter_preface")},xt={vertexShader:`${_t.a}`,fragmentShader:`${gt.a}`.replace("$style_inline","vec4(encodeWidth($width_inline))").replace("$style_preface",`${pt.a}`)};var wt=r(9),Et=r.n(wt),Tt=r(10);const At={vertexShader:`${r.n(Tt).a}`,fragmentShader:`${Et.a}`};var Ct={renderer:{createPointShader:e=>new class{constructor(e){Object.assign(this,d(e,ct.a,st.a)),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.colorStrokeTexture=e.getUniformLocation(this.program,"colorStrokeTex"),this.strokeWidthTexture=e.getUniformLocation(this.program,"strokeWidthTex"),this.widthTexture=e.getUniformLocation(this.program,"widthTex"),this.orderMinWidth=e.getUniformLocation(this.program,"orderMinWidth"),this.orderMaxWidth=e.getUniformLocation(this.program,"orderMaxWidth"),this.filterTexture=e.getUniformLocation(this.program,"filterTex"),this.devicePixelRatio=e.getUniformLocation(this.program,"devicePixelRatio")}}(e),createTriShader:e=>new class{constructor(e){Object.assign(this,d(e,`${ht.a}`,`${ft.a}`)),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.normalAttr=e.getAttribLocation(this.program,"normal"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.colorStrokeTexture=e.getUniformLocation(this.program,"strokeColorTex"),this.strokeWidthTexture=e.getUniformLocation(this.program,"strokeWidthTex"),this.filterTexture=e.getUniformLocation(this.program,"filterTex"),this.normalScale=e.getUniformLocation(this.program,"normalScale")}}(e),createLineShader:e=>new class{constructor(e){Object.assign(this,d(e,nt.a,rt.a)),this.vertexPositionAttribute=e.getAttribLocation(this.program,"vertexPosition"),this.featureIdAttr=e.getAttribLocation(this.program,"featureID"),this.normalAttr=e.getAttribLocation(this.program,"normal"),this.vertexScaleUniformLocation=e.getUniformLocation(this.program,"vertexScale"),this.vertexOffsetUniformLocation=e.getUniformLocation(this.program,"vertexOffset"),this.colorTexture=e.getUniformLocation(this.program,"colorTex"),this.widthTexture=e.getUniformLocation(this.program,"widthTex"),this.filterTexture=e.getUniformLocation(this.program,"filterTex"),this.normalScale=e.getUniformLocation(this.program,"normalScale")}}(e)},styler:De,symbolizer:Fe,AABlender:class{constructor(e){Object.assign(this,d(e,et.a,Qe.a)),this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),this.readTU=e.getUniformLocation(this.program,"aaTex")}}};class St{constructor(){this._ids=new Map}getID(e){if(this._ids.has(e))return this._ids.get(e);const t=this._ids.size;return this._ids.set(e,t),t}}class Rt{constructor(e){this.childrenNames=Object.keys(e),Object.keys(e).map(t=>{this[t]=b(e[t])}),this._getChildren().map(e=>{e.parent=this}),this.preface="",this._shaderBindings=new Map}loadImages(){return Promise.all(this._getChildren().map(e=>e.loadImages()))}_bind(e){return this._compile(e),this}_setUID(e){this._uid=e.getID(this),this._getChildren().map(t=>t._setUID(e))}_dataReady(){this._getChildren().map(e=>e._dataReady())}isFeatureDependent(){return this._getChildren().some(e=>e.isFeatureDependent())}_prefaceCode(e){return e?`\n${this._buildGLSLCode(e)}\n`:""}_buildGLSLCode(e){return`\n            #ifndef DEF_${this._uid}\n            #define DEF_${this._uid}\n            ${e}\n            #endif`}_getDependencies(){return this._getChildren().map(e=>e._getDependencies()).reduce((e,t)=>e.concat(t),[])}_resolveAliases(e){this._getChildren().map(t=>t._resolveAliases(e))}_compile(e){this._getChildren().map(t=>t._compile(e))}_setGenericGLSL(e,t){this.inlineMaker=e,this.preface=t||""}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};return t.map((e,t)=>{r[this.childrenNames[t]]=e.inline}),{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+this.preface),inline:this.inlineMaker(r,e)}}_postShaderCompile(e,t){this.childrenNames.forEach(r=>this[r]._postShaderCompile(e,t))}_getBinding(e){return this._shaderBindings.has(e)||this._shaderBindings.set(e,{}),this._shaderBindings.get(e)}_resetViewportAgg(){this._getChildren().forEach(e=>e._resetViewportAgg())}accumViewportAgg(e){this._getChildren().forEach(t=>t.accumViewportAgg(e))}_setTimestamp(e){this.childrenNames.forEach(t=>this[t]._setTimestamp(e))}_preDraw(...e){this.childrenNames.forEach(t=>this[t]._preDraw(...e))}isAnimated(){return this._getChildren().some(e=>e.isAnimated())}replaceChild(e,t){this[this.childrenNames.find(t=>this[t]===e)]=t,t.parent=this,t.notify=e.notify}notify(){this.parent.notify()}blendTo(e,t=500){e=b(e);const r=this.parent,i=An(this,e,Ji(t));return r.replaceChild(this,i),i.notify(),e}_blendFrom(e,t=500,r=null){if(this.default&&e.default)return;e=b(e);const i=this.parent,n=An(e,this,Ji(t),r);i.replaceChild(this,n),n.notify()}_getChildren(){return this.childrenNames.map(e=>this[e])}_getMinimumNeededSchema(){return this._getChildren().map(e=>e._getMinimumNeededSchema()).reduce(h,Ve)}eval(e){throw new Error("Unimplemented")}isA(e){return this instanceof e}}class Dt extends Rt{constructor(e){if(C("transition","duration",0,e),e<0)throw new Error(v("transition","duration",0)+"duration must be greater than or equal to 0");super({}),this.aTime=Date.now(),this.bTime=this.aTime+Number(e),this.type="number"}eval(){const e=Date.now();return this.mix=(e-this.aTime)/(this.bTime-this.aTime),Math.min(this.mix,1)}isAnimated(){return!this.mix||this.mix<=1}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float anim${this._uid};\n`),inline:`anim${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`anim${this._uid}`)}_preDraw(e,t,r){const i=Date.now();this.mix=(i-this.aTime)/(this.bTime-this.aTime),r.uniform1f(this._getBinding(e).uniformLocation,this.mix>1?1:this.mix)}}const Ft=L("in",function(e){return 0===e.length?()=>"0.":t=>`(${e.map((e,r)=>`(${t.value} == ${t[`arg${r}`]})`).join(" || ")})? 1.: 0.`},(e,t)=>t.some(t=>t===e)?1:0),Mt=L("nin",function(e){return 0===e.length?()=>"1.":t=>`(${e.map((e,r)=>`(${t.value} != ${t[`arg${r}`]})`).join(" && ")})? 1.: 0.`},(e,t)=>t.some(t=>t===e)?0:1);class Lt extends Rt{constructor(e,t,r){e=b(e),t=b(t),r=b(r),x("between","value",0,"number",e),x("between","lowerLimit",1,"number",t),x("between","upperLimit",2,"number",r),super({value:e,lowerLimit:t,upperLimit:r}),this.type="number"}eval(e){const t=this.value.eval(e),r=this.lowerLimit.eval(e),i=this.upperLimit.eval(e);return t>=r&&t<=i?1:0}_compile(e){super._compile(e),T("between","value",0,"number",this.value),T("between","lowerLimit",1,"number",this.lowerLimit),T("between","upperLimit",2,"number",this.upperLimit),this.inlineMaker=(e=>`((${e.value} >= ${e.lowerLimit} &&  ${e.value} <= ${e.upperLimit}) ? 1. : 0.)`)}}const It=0,Pt=1,kt=2,Bt=4,Ot=8,Nt=16,Ut=I("mul",Pt|kt|Bt|Nt,(e,t)=>e*t,(e,t)=>`(${e} * ${t})`),$t=I("div",Pt|kt|Bt|Nt,(e,t)=>e/t,(e,t)=>`(${e} / ${t})`),zt=I("add",Pt|Bt|Nt,(e,t)=>e+t,(e,t)=>`(${e} + ${t})`),qt=I("sub",Pt|Bt|Nt,(e,t)=>e-t,(e,t)=>`(${e} - ${t})`),Vt=I("mod",Pt,(e,t)=>e%t,(e,t)=>`mod(${e}, ${t})`),Gt=I("pow",Pt,(e,t)=>Math.pow(e,t),(e,t)=>`pow(${e}, ${t})`),Wt=I("greaterThan",Pt,(e,t)=>e>t?1:0,(e,t)=>`(${e}>${t}? 1.:0.)`),jt=I("greaterThanOrEqualTo",Pt,(e,t)=>e>=t?1:0,(e,t)=>`(${e}>=${t}? 1.:0.)`),Xt=I("lessThan",Pt,(e,t)=>e<t?1:0,(e,t)=>`(${e}<${t}? 1.:0.)`),Ht=I("lessThanOrEqualTo",Pt,(e,t)=>e<=t?1:0,(e,t)=>`(${e}<=${t}? 1.:0.)`),Yt=I("equals",Pt|Ot,(e,t)=>e===t?1:0,(e,t)=>`(${e}==${t}? 1.:0.)`),Zt=I("notEquals",Pt|Ot,(e,t)=>e!==t?1:0,(e,t)=>`(${e}!=${t}? 1.:0.)`),Kt=I("or",Pt,(e,t)=>Math.min(e+t,1),(e,t)=>`min(${e} + ${t}, 1.)`),Qt=I("and",Pt,(e,t)=>Math.min(e*t,1),(e,t)=>`min(${e} * ${t}, 1.)`);class Jt extends Rt{constructor(e,t,r,i){e=b(e),t=b(t),r=b(r),E("blend","a",0,e),E("blend","b",1,t),E("blend","mix",2,r),e.type&&t.type&&k(e,t),x("blend","mix",2,"number",r);const n=r;i&&(r=i(r)),super({a:e,b:t,mix:r}),this.originalMix=n,e.type&&t.type&&(this.type=e.type)}eval(e){const t=F(this.mix.eval(e),0,1);return function(e,t,r){return e*(1-r)+t*r}(this.a.eval(e),this.b.eval(e),t)}replaceChild(e,t){e===this.mix&&(this.originalMix=t),super.replaceChild(e,t)}_compile(e){super._compile(e),k(this.a,this.b),T("blend","mix",1,"number",this.mix),this.type=this.a.type,this.inlineMaker=(e=>`mix(${e.a}, ${e.b}, clamp(${e.mix}, 0., 1.))`)}_preDraw(...e){super._preDraw(...e),this.originalMix.isA(Dt)&&!this.originalMix.isAnimated()&&(this.parent.replaceChild(this,this.b),this.notify())}}class er extends Rt{constructor(e,t){let r;if(e=b(e),t=b(t),e.type){if("number"!==e.type&&"category"!==e.type)throw new Error(`buckets(): invalid first parameter type\n\t'input' type was ${e.type}`);r=e.type}t.elems.map((e,t)=>{if(e.type){if(r&&r!==e.type)throw new Error(`buckets(): invalid ${y(t+1)} parameter type`+`\n\texpected type was ${r}\n\tactual type was ${e.type}`);if("number"!==e.type&&"category"!==e.type)throw new Error(`buckets(): invalid ${y(t+1)} parameter type\n\ttype was ${e.type}`)}});let i={input:e};t.elems.map((e,t)=>{i[`arg${t}`]=e}),super(i),this.numCategories=t.elems.length+1,this.list=t,this.type="category"}eval(e){const t=this.input.eval(e);let r=0;if("category"===this.input.type)for(r=0;r<this.list.elems.length;r++)if(t===this.list.elems[r].eval(e))return r;if("number"===this.input.type)for(r=0;r<this.list.elems.length;r++)if(t<this.list.elems[r].eval(e))return r;return r}_compile(e){if(super._compile(e),"number"!==this.input.type&&"category"!==this.input.type)throw new Error(`buckets(): invalid first parameter type\n\t'input' type was ${this.input.type}`);this.list.elems.map((e,t)=>{if(this.input.type!==e.type)throw new Error(`buckets(): invalid ${y(t+1)} parameter type`+`\n\texpected type was ${this.input.type}\n\tactual type was ${e.type}`);if("number"!==e.type&&"category"!==e.type)throw new Error(`buckets(): invalid ${y(t+1)} parameter type\n\ttype was ${e.type}`)})}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};t.map((e,t)=>{r[this.childrenNames[t]]=e.inline});const i=`buckets${this._uid}`,n="category"===this.input.type?"==":"<",a=`float ${i}(float x){\n            ${this.list.elems.map((e,t)=>`${t>0?"else":""} if (x${n}(${r[`arg${t}`]})){\n                return ${t}.;\n            }`).join("")}\n            return ${this.numCategories-1}.;\n        }`;return{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+a),inline:`${i}(${r.input})`}}}class tr extends Rt{constructor(e){S("category","categoryName",0,e),super({}),this.expr=e,this.type="category"}get value(){return this.expr}eval(){return this.expr}isAnimated(){return!1}_compile(e){this._metadata=e}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float cat${this._uid};\n`),inline:`cat${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`cat${this._uid}`)}_preDraw(e,t,r){const i=this._metadata.categoryToID.get(this.expr);r.uniform1f(this._getBinding(e).uniformLocation,i)}}class rr extends Rt{constructor(e){if(S("property","name",0,e),""===e)throw new Error("property(): invalid parameter, zero-length string");super({}),this.name=e}isFeatureDependent(){return!0}get value(){return this.eval()}eval(e){if(!e)throw new Error("A property needs to be evaluated in a feature");return e[this.name]}_compile(e){const t=e.properties[this.name];if(!t)throw new Error(`Property '${this.name}' does not exist`);this.type=t.type,"category"===this.type&&(this.numCategories=t.categories.length),super._setGenericGLSL((e,t)=>t(this.name))}_applyToShaderSource(e){return{preface:"",inline:e(this.name)}}_getMinimumNeededSchema(){return{columns:[this.name]}}}const ir=B("clusterAvg","number"),nr=B("clusterMax","number"),ar=B("clusterMin","number"),sr=B("clusterMode","category"),or=B("clusterSum","number");class cr extends Rt{constructor(e){C("constant","x",0,e),super({}),this.expr=e,this.type="number",this.inlineMaker=(()=>`(${e.toFixed(20)})`)}get value(){return this.eval()}eval(){return this.expr}}class ur extends Rt{constructor(e){S("hex","hexadecimalColor",0,e),super({}),this.type="color";try{this.color=_(e)}catch(e){throw new Error(v("hex","hexadecimalColor",0)+"\nInvalid hexadecimal color string")}}get value(){return this.eval()}eval(){return this.color}_compile(e){super._compile(e),this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${this.color.a.toFixed(4)})`)}}const fr=O("hsl",!1),lr=O("hsla",!0),hr=N("hsv",!1),dr=N("hsva",!0);class pr extends Rt{constructor(e,t,r){e=b(e),void 0===t&&void 0===r&&(t=Na(e),r=Oa(e)),t=b(t),r=b(r),E("linear","input",0,e),E("linear","min",1,t),E("linear","max",2,r),super({input:e,min:t,max:r}),"time"!==this.min.type&&(x("linear","input",0,"number",this.input),x("linear","min",1,"number",this.min),x("linear","max",2,"number",this.max)),this.type="number"}eval(e){if("date"===this.input.type){const t=this.input.eval(e),r=this.min.eval().getTime(),i=this.max.eval().getTime(),n=this._metadata,a=n.properties[this.input.name].min.getTime(),s=n.properties[this.input.name].max.getTime()-a,o=(r-a)/s;return(t-o)/((i-a)/s-o)}const t=this.input.eval(e),r=this.min.eval(e);return(t-r)/(this.max.eval(e)-r)}_compile(e){if(super._compile(e),"date"===this.input.type){const t=this.min.eval().getTime(),r=this.max.eval().getTime();this._metadata=e;const i=e.properties[this.input.name].min.getTime(),n=e.properties[this.input.name].max.getTime()-i,a=(t-i)/n,s=(r-i)/n;this.inlineMaker=(e=>`((${e.input}-(${a.toFixed(20)}))/(${(s-a).toFixed(20)}))`)}else T("linear","input",0,"number",this.input),T("linear","min",1,"number",this.min),T("linear","max",2,"number",this.max),this.inlineMaker=(e=>`((${e.input}-${e.min})/(${e.max}-${e.min}))`)}}const mr=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];class gr extends Rt{constructor(e){if(S("namedColor","colorName",0,e),!mr.includes(e.toLowerCase()))throw new Error(v("namedColor","colorName",0)+`\nInvalid color name:  "${e}"`);super({}),this.type="color",this.name=e,this.color=this._nameToRGBA()}get value(){return this.eval()}eval(){return this.color}_compile(e){super._compile(e),this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${1..toFixed(4)})`)}_nameToRGBA(){const e=document.createElement("div");e.style.backgroundColor=this.name,document.body.appendChild(e);const t=getComputedStyle(e).backgroundColor;document.body.removeChild(e);const r=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/.exec(t);return{r:Number(r[1]),g:Number(r[2]),b:Number(r[3]),a:r[4]||1}}}class br extends Rt{constructor(e){C("number","x",0,e),super({}),this.expr=e,this.type="number"}get value(){return this.eval()}eval(){return this.expr}isAnimated(){return!1}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float number${this._uid};`),inline:`number${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`number${this._uid}`)}_preDraw(e,t,r){r.uniform1f(this._getBinding(e).uniformLocation,this.expr)}}class _r extends Rt{constructor(e){super({}),A("asc","by",0,vr,e),this.type="orderer"}}class yr extends Rt{constructor(e){super({}),A("desc","by",0,vr,e),this.type="orderer"}}class vr extends Rt{constructor(){super({}),this.type="propertyReference"}}var xr=r(4);class wr extends Rt{constructor(e,t){super({}),this.type="palette",this.name=e,this.subPalettes=new Proxy(t,{get:(e,t)=>{if(Number.isFinite(Number(t))&&Array.isArray(e[t]))return e[t].map(_)}}),this.tags=t.tags}getLongestSubPalette(){const e=this.subPalettes;for(let t=20;t>=0;t--)if(e[t])return e[t]}isQualitative(){return this.tags.includes("qualitative")}isQuantitative(){return this.tags.includes("quantitative")}}const Er={};Object.keys(xr).map(e=>{Er[`${e.toUpperCase()}`]=new wr(e,xr[e])});var Tr=Er;let Ar=0;class Cr extends Rt{constructor(e,t){let r=[];for(let i=0;i<t-1;i++)e[`arg${i}`]=Yn(0),r.push(e[`arg${i}`]);super(e),this.classifierUID=Ar++,this.numCategories=t,this.buckets=t,this.breakpoints=r,this.type="category"}eval(e){const t=this.input.eval(e),r=this.breakpoints.findIndex(e=>t<=e.expr);return-1===r?this.breakpoints.length:r}_genBreakpoints(){}getBreakpointList(){return this._genBreakpoints(),this.breakpoints.map(e=>e.expr)}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};t.map((e,t)=>{r[this.childrenNames[t]]=e.inline});const i=`classifier${this.classifierUID}`,n=`float ${i}(float x){\n            ${this.breakpoints.map((e,t)=>`${t>0?"else":""} if (x<(${r[`arg${t}`]})){\n                return ${t.toFixed(2)};\n            }`).join("")}\n            return ${this.breakpoints.length.toFixed(1)};\n        }`;return{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+n),inline:`${i}(${r.input})`}}_preDraw(e,t,r){this._genBreakpoints(),super._preDraw(e,t,r)}_getColumnName(){return this.input.aggName?We.aggColumn(this.input.name,this.input.aggName):this.input.name}}const Sr=.950456,Rr=1,Dr=1.088754;class Fr extends Rt{constructor(e){R("imageList","imageList",0,e),e.forEach((e,t)=>x("imageList",`imageList[${t}]`,0,"image",e));const t={};e.forEach((e,r)=>{t[`image${r}`]=e}),super(t),this.numImages=e.length,this.type="image"}_applyToShaderSource(){return{preface:this._prefaceCode(`\n                uniform sampler2D atlas${this._uid};\n\n                vec4 atlas${this._uid}Fn(vec2 imageUV, float cat) {\n                    return texture2D(atlas${this._uid}, imageUV/16. + vec2(mod(cat, 16.), floor(cat/16.))/16. ).rgba;\n                }\n            `),inline:`atlas${this._uid}Fn`}}_postShaderCompile(e,t){this._getBinding(e).texLoc=t.getUniformLocation(e,`atlas${this._uid}`)}_preDraw(e,t,r){this.init=!0;for(let e=0;e<this.numImages;e++){this.init=this.init&&this[`image${e}`].canvas}if(this.init&&!this.texture){const e=4096,i=256;r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let n=0,a=0;for(let t=0;t<this.numImages;t++){const s=this[`image${t}`];r.texSubImage2D(r.TEXTURE_2D,0,n,a,r.RGBA,r.UNSIGNED_BYTE,s.canvas),(n+=i)+i>e&&(n=0,a+=i),s.canvas=null}r.generateMipmap(r.TEXTURE_2D)}this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e).texLoc,t.freeTexUnit),t.freeTexUnit++)}}class Mr extends Rt{constructor(e,t){t=b(t),A("top","property",0,rr,e),x("top","buckets",1,"number",t),D("top","buckets",1,t),super({property:e,buckets:t}),this.type="category"}eval(e){const t=this.property.eval(e),r=Math.round(this.buckets.eval());let i;return[...this._meta.properties[this.property.name].categories].sort((e,t)=>t.frequency-e.frequency).map((e,n)=>{n===t&&(i=n<r?n+1:0)}),i}_compile(e){D("top","buckets",1,this.buckets),super._compile(e),T("top","property",0,"category",this.property),T("top","buckets",1,"number",this.buckets),this._meta=e,this._textureBuckets=null}get numCategories(){return Math.round(this.buckets.eval())+1}_applyToShaderSource(e){const t=this.property._applyToShaderSource(e);return{preface:this._prefaceCode(t.preface+`uniform sampler2D topMap${this._uid};\n`),inline:`(255.*texture2D(topMap${this._uid}, vec2(${t.inline}/1024., 0.5)).a)`}}_postShaderCompile(e,t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),this.property._postShaderCompile(e),this._getBinding(e)._texLoc=t.getUniformLocation(e,`topMap${this._uid}`)}_preDraw(e,t,r){this.property._preDraw(e,t),r.activeTexture(r.TEXTURE0+t.freeTexUnit);let i=Math.round(this.buckets.eval());if(i>this.property.numCategories&&(i=this.property.numCategories),this._textureBuckets!==i){this._textureBuckets=i,r.bindTexture(r.TEXTURE_2D,this.texture);const e=1024;let t=new Uint8Array(4*e);[...this._meta.properties[this.property.name].categories].sort((e,t)=>t.frequency-e.frequency).map((e,r)=>{r<i&&(t[4*this._meta.categoryToID.get(e.name)+3]=r+1)}),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,1,0,r.RGBA,r.UNSIGNED_BYTE,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)}r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e)._texLoc,t.freeTexUnit),t.freeTexUnit++}}const Lr={PALETTE:"palette",COLOR_ARRAY:"color-array",NUMBER_ARRAY:"number-array",IMAGE:"image"},Ir={COLOR:"color",NUMBER:"number"},Pr={NUMBER:"number",CATEGORY:"category"},kr=256,Br=255;const Or=H("rgb",!1),Nr=H("rgba",!0);class Ur extends Rt{constructor(e){super({}),this.type="time",this.date=o(e),this.inlineMaker=(()=>void 0)}get value(){return this.eval()}eval(){return this.date}isAnimated(){return!1}}const $r=.15,zr=void 0;class qr extends Rt{constructor(e=zr,t=zr){let r=b(e===zr?$r:e),i=t===zr?r:b(t);x("fade","param1",0,"number",r),x("fade","param2",1,"number",i),super({fadeIn:r,fadeOut:i}),this.type="fade",this.inlineMaker=(e=>({in:e.fadeIn,out:e.fadeOut}))}}let Vr=new Set,Gr=new Set;class Wr extends Rt{constructor(e,t=10,r=new qr){t=b(t);const i=e=b(e);e.isA(rr)&&(e=jn(e,Na(e),Oa(e))),x("animation","input",0,"number",e),x("animation","duration",1,"number",t),D("animation","duration",1,t),x("animation","fade",2,"fade",r),super({_input:e,progress:Yn(0),fade:r,duration:t}),this.type="number",this._originalInput=i,this._paused=!1}isAnimated(){return!this.paused}_dataReady(){if(Vr.has(this)&&(Vr.delete(this),Gr.add(this)),Gr.has(this)){if((Vr=new Set([...Vr].filter(e=>{for(;e.parent;)e=e.parent;return!!e._getRootExpressions}))).size>0)return;[...Gr.values()].map(e=>{"default"===e._paused&&e.play()}),Gr.clear()}}_postShaderCompile(e,t){Vr.add(this),this._paused="default",super._postShaderCompile(e,t)}_setTimestamp(e){if(super._setTimestamp(e),this._paused&&void 0===this._lastTime)return;let t=0;const r=1/this.duration.value;void 0!==this._lastTime&&(t=e-this._lastTime),this._lastTime=e,this._paused||(this.progress.expr=(this.progress.expr+r*t)%1)}eval(e){const t=this._input.eval(e);if(Number.isNaN(t))return 0;const r=this.progress.value,i=this.duration.value,n=this.fade.fadeIn.eval(e),a=this.fade.fadeOut.eval(e);return 1-F(Math.abs(t-r)*i/(t>r?n:a),0,1)}getProgressValue(){const e=this.progress.eval(),t=this._input.min.eval(),r=this._input.max.eval();if(!(t instanceof Date))return e*(r-t)+t;const i=t.getTime(),n=r.getTime();return new Date((1-e)*i+n*e)}setTimestamp(e){const t=o(e),r=this._input.min.eval(),i=this._input.max.eval();if(t.getTime()<r)throw new RangeError("animation.setTimestamp requires the date parameter to be higher than the lower limit");if(t.getTime()>i)throw new RangeError("animation.setTimestamp requires the date parameter to be lower than the higher limit");this.progress.expr=(t.getTime()-r)/(i-r)}getProgressPct(){return this.progress.value}setProgressPct(e){if((e=Number.parseFloat(e))<0||e>1)throw new TypeError(`animation.setProgressPct requires a number between 0 and 1 as parameter but got: ${e}`);this.progress.expr=e}pause(){this._paused=!0}play(){this._paused=!1}stop(){this.progress.expr=0,this._paused=!0}_compile(e){this._originalInput._compile(e),this.duration._compile(e),T("animation","input",0,["number","date"],this._originalInput),T("animation","duration",1,"number",this.duration),super._compile(e),T("animation","input",0,"number",this._input),T("animation","fade",2,"fade",this.fade),D("animation","duration",1,this.duration),this.preface="\n            #ifndef ANIMATION\n            #define ANIMATION\n\n            float animation(float _input, float progress, float duration, float fadeIn, float fadeOut){\n                float x = 0.;\n\n                // Check for NaN\n                if (_input <= 0.0 || 0.0 <= _input){\n                    x = 1. - clamp(abs(_input - progress) * duration / (_input > progress ? fadeIn: fadeOut), 0., 1.);\n                }\n\n                return x;\n            }\n\n            #endif\n        ",this.inlineMaker=(e=>`animation(${e._input}, ${e.progress}, ${e.duration}, ${e.fade.in}, ${e.fade.out})`)}}const jr=Y("log",e=>Math.log(e),e=>`log(${e})`),Xr=Y("sqrt",e=>Math.sqrt(e),e=>`sqrt(${e})`),Hr=Y("sin",e=>Math.sin(e),e=>`sin(${e})`),Yr=Y("cos",e=>Math.cos(e),e=>`cos(${e})`),Zr=Y("tan",e=>Math.tan(e),e=>`tan(${e})`),Kr=Y("sign",e=>Math.sign(e),e=>`sign(${e})`),Qr=Y("abs",e=>Math.abs(e),e=>`abs(${e})`),Jr=Y("isNaN",e=>Number.isNaN(e)?1:0,e=>`((${e} <= 0.0 || 0.0 <= ${e}) ? 0. : 1.)`),ei=Y("not",e=>1-e,e=>`(1.0 - ${e})`),ti=Y("floor",e=>Math.floor(e),e=>`floor(${e})`),ri=Y("ceil",e=>Math.ceil(e),e=>`ceil(${e})`);class ii extends Rt{constructor(){super({})}}const ni=Z("avg",e=>{e._sum=0,e._count=0},(e,t)=>{Number.isNaN(t)||(e._count++,e._sum+=t)},e=>e._sum/e._count),ai=Z("max",e=>{e._value=Number.NEGATIVE_INFINITY},(e,t)=>{Number.isNaN(t)||(e._value=Math.max(e._value,t))},e=>e._value),si=Z("min",e=>{e._value=Number.POSITIVE_INFINITY},(e,t)=>{Number.isNaN(t)||(e._value=Math.min(e._value,t))},e=>e._value),oi=Z("sum",e=>{e._value=0},(e,t)=>{Number.isNaN(t)||(e._value=e._value+t)},e=>e._value),ci=Z("count",e=>{e._value=0},e=>{e._value++},e=>e._value);const ui=K("avg"),fi=K("max"),li=K("min"),hi=K("sum"),di=K("count");class pi extends Rt{constructor(e,t){e=b(e),t=b(t),x("placement","x",0,"number",e),x("placement","y",1,"number",t),super({x:e,y:t}),this.inlineMaker=(e=>`vec2(${e.x}, ${e.y})`),this.type="placement"}eval(e){return[this.x.eval(e),this.y.eval(e)]}_compile(e){super._compile(e),T("placement","x",0,"number",this.x),T("placement","y",1,"number",this.y)}}class mi extends Rt{constructor(e){S("image","url",0,e),super({}),this.type="image",this.canvas=null,this._url=e,this._promise=new Promise((e,t)=>{this.image=new window.Image,this.image.onload=(()=>{this.canvas=function(e){const t=document.createElement("canvas");t.width=256,t.height=256;const r=t.getContext("2d"),i=Math.max(e.width,e.height),n=e.width/i*256,a=e.height/i*256;return r.drawImage(e,1+(256-n)/2,1+(256-a)/2,n-2,a-2),t}(this.image),this.image=null,e()}),this.image.onerror=t,this.image.crossOrigin="anonymous",this.image.src=this._url})}loadImages(){return this.count=this.count+1||1,this._promise}eval(){}_compile(e){super._compile(e)}_free(e){this.texture&&e.deleteTexture(this.texture)}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform sampler2D texSprite${this._uid};`),inline:`texture2D(texSprite${this._uid}, imageUV).rgba`}}_postShaderCompile(e,t){this._getBinding(e)._texLoc=t.getUniformLocation(e,`texSprite${this._uid}`)}_preDraw(e,t,r){!this.init&&this.canvas&&(this.init=!0,r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.canvas),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.generateMipmap(r.TEXTURE_2D),this.canvas=null),this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e)._texLoc,t.freeTexUnit),t.freeTexUnit++)}}class gi extends mi{constructor(e){super(`data:image/svg+xml,${encodeURIComponent(e)}`)}}var bi=r(40),_i=r.n(bi),yi=r(39),vi=r.n(yi),xi=r(38),wi=r.n(xi),Ei=r(37),Ti=r.n(Ei),Ai=r(36),Ci=r.n(Ai),Si=r(35),Ri=r.n(Si),Di=r(34),Fi=r.n(Di),Mi=r(33),Li=r.n(Mi),Ii=r(32),Pi=r.n(Ii),ki=r(31),Bi=r.n(ki),Oi=r(30),Ni=r.n(Oi),Ui=r(29),$i=r.n(Ui),zi=r(28),qi=r.n(zi),Vi=r(27),Gi=r.n(Vi),Wi=r(26),ji=r.n(Wi),Xi=r(25),Hi=r.n(Xi),Yi=r(24),Zi=r.n(Yi),Ki=r(23),Qi={bicycle:_i.a,building:vi.a,bus:wi.a,car:Ti.a,circle:Ci.a,circleOutline:Ri.a,cross:Fi.a,house:Li.a,flag:Pi.a,marker:Bi.a,markerOutline:Ni.a,plus:$i.a,square:qi.a,squareOutline:Gi.a,star:ji.a,starOutline:Hi.a,triangle:Zi.a,triangleOutline:r.n(Ki).a};const Ji=(...e)=>new Dt(...e),en=(...e)=>new class extends Rt{constructor(e){if(e=e||[],Array.isArray(e)||(e=[e]),!(e=e.map(b)).length)throw new Error("array(): invalid parameters: must receive at least one argument");let t="";for(let r of e)if(t=r.type,void 0!==r.type)break;if(-1===["number","category","color","time",void 0].indexOf(t))throw new Error(`array(): invalid parameters type: ${t}`);e.map((e,r)=>{if(E("array",`item[${r}]`,r,e),e.type!==t&&void 0!==e.type)throw new Error(`array(): invalid ${y(r+1)} parameter type, invalid argument type combination`)}),super({}),this.type=t+"-array",this.elems=e;try{this.elems.map(e=>e.value)}catch(e){throw new Error("Arrays must be formed by constant expressions, they cannot depend on feature properties")}}get value(){return this.elems.map(e=>e.value)}eval(){return this.elems.map(e=>e.eval())}_resolveAliases(e){this.elems.map(t=>t._resolveAliases(e))}_compile(e){super._compile(e);const t=this.elems[0].type;if(-1===["number","category","color","time"].indexOf(t))throw new Error(`array(): invalid parameters type: ${t}`);this.elems.map((e,r)=>{if(E("array",`item[${r}]`,r,e),e.type!==t)throw new Error(`array(): invalid ${y(r)} parameter, invalid argument type combination`)})}}(...e),tn=(...e)=>new Ft(...e),rn=(...e)=>new Mt(...e),nn=(...e)=>new Lt(...e),an=(...e)=>new Ut(...e),sn=(...e)=>new $t(...e),on=(...e)=>new zt(...e),cn=(...e)=>new qt(...e),un=(...e)=>new Gt(...e),fn=(...e)=>new Vt(...e),ln=(...e)=>new Wt(...e),hn=(...e)=>new jt(...e),dn=(...e)=>new Xt(...e),pn=(...e)=>new Ht(...e),mn=(...e)=>new Yt(...e),gn=(...e)=>new Zt(...e),bn=(...e)=>new Qt(...e),_n=(...e)=>new Kt(...e),yn=ln,vn=hn,xn=dn,wn=pn,En=mn,Tn=gn,An=(...e)=>new Jt(...e),Cn=(...e)=>new er(...e),Sn=(...e)=>new class extends Rt{constructor(e,t,r){e=b(e),t=b(t),r=b(r),E("cielab","l",0,e),E("cielab","a",1,t),E("cielab","b",2,r),x("cielab","l",0,"number",e),x("cielab","a",1,"number",t),x("cielab","b",2,"number",r),super({l:e,a:t,b:r}),this.type="color"}_compile(e){super._compile(e),T("cielab","l",0,"number",this.l),T("cielab","a",1,"number",this.a),T("cielab","b",2,"number",this.b),this._setGenericGLSL(e=>`vec4(xyztosrgb(cielabtoxyz(\n                vec3(\n                    clamp(${e.l}, 0., 100.),\n                    clamp(${e.a}, -128., 128.),\n                    clamp(${e.b}, -128., 128.)\n                )\n            )), 1)`,"\n        #ifndef cielabtoxyz_fn\n        #define cielabtoxyz_fn\n\n        const mat3 XYZ_2_RGB = (mat3(\n            3.2404542,-1.5371385,-0.4985314,\n           -0.9692660, 1.8760108, 0.0415560,\n            0.0556434,-0.2040259, 1.0572252\n       ));\n       const float SRGB_GAMMA = 1.0 / 2.2;\n\n       vec3 rgb_to_srgb_approx(vec3 rgb) {\n        return pow(rgb, vec3(SRGB_GAMMA));\n    }\n        float f1(float t){\n            const float sigma = 6./29.;\n            if (t>sigma){\n                return t*t*t;\n            }else{\n                return 3.*sigma*sigma*(t-4./29.);\n            }\n        }\n        vec3 cielabtoxyz(vec3 c) {\n            const float xn = 95.047/100.;\n            const float yn = 100./100.;\n            const float zn = 108.883/100.;\n            return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                        yn*f1((c.x+16.)/116.),\n                        zn*f1((c.x+16.)/116.  - c.z/200. )\n                    );\n        }\n        vec3 xyztorgb(vec3 c){\n            return c *XYZ_2_RGB;\n        }\n\n        vec3 xyztosrgb(vec3 c) {\n            return rgb_to_srgb_approx(xyztorgb(c));\n        }\n        #endif\n        ")}}(...e),Rn=(...e)=>new ir(...e),Dn=(...e)=>new nr(...e),Fn=(...e)=>new ar(...e),Mn=(...e)=>new sr(...e),Ln=(...e)=>new or(...e),In=(...e)=>new cr(...e),Pn=(...e)=>new mi(...e),kn=(...e)=>new Fr(...e),Bn=(...e)=>g(e,mi),On=(...e)=>g(e,Fr),Nn=(...e)=>new gi(...e),Un=(...e)=>new ur(...e),$n=(...e)=>new fr(...e),zn=(...e)=>new lr(...e),qn=(...e)=>new hr(...e),Vn=(...e)=>new dr(...e),Gn=(...e)=>new class extends(U(e=>`cubicEaseInOut(${e})`,"\n    #ifndef CUBIC\n    #define CUBIC\n    float cubicEaseInOut(float p){\n        if (p < 0.5) {\n            return 4. * p * p * p;\n        }else {\n            float f = ((2. * p) - 2.);\n            return 0.5 * f * f * f + 1.;\n        }\n    }\n    #endif\n",e=>e)){}(...e),Wn=(...e)=>new class extends(U(e=>e,void 0,e=>e)){}(...e),jn=(...e)=>new pr(...e),Xn=(...e)=>new gr(...e),Hn=(...e)=>new class extends Rt{constructor(){super({now:Yn(0)})}eval(){return this.now.expr}isAnimated(){return!0}_compile(e){super._compile(e),this.type="number",super.inlineMaker=(e=>e.now)}_preDraw(...e){this.now._preDraw(...e)}_setTimestamp(e){this.now.expr=e}}(...e),Yn=(...e)=>new br(...e),Zn=(...e)=>new class extends Rt{constructor(e,t){Number.isFinite(t)&&(t=Yn(t)),x("opacity","color",0,"color",e),x("opacity","alpha",1,"number",t),super({color:e,alpha:t}),this.type="color"}get value(){return this.eval()}eval(e){const t=this.color.eval(e),r=this.alpha.eval(e);return t.a=r,t}_compile(e){super._compile(e),T("opacity","color",0,"color",this.color),T("opacity","alpha",1,"number",this.alpha),this.inlineMaker=(e=>`vec4((${e.color}).rgb, ${e.alpha})`)}}(...e),Kn=(...e)=>new _r(...e),Qn=(...e)=>new yr(...e),Jn=(...e)=>new class extends Rt{constructor(){super({}),this.type="orderer"}}(...e),ea=(...e)=>new vr(...e),ta=(...e)=>new class extends wr{constructor(e){super(e.name,e.subPalettes),this.type="palette",this._originalPalette=e,this.tags=e.tags,this.subPalettes=new Proxy(e.subPalettes,{get:(e,t)=>Number.isFinite(Number(t))&&Array.isArray(e[t])?this._reversePalette(e[t]):e[t]})}getLongestSubPalette(){return this._reversePalette(this._originalPalette.getLongestSubPalette())}_reversePalette(e){if(this.isQualitative()){const t=[...e],r=t.pop();return[...t.reverse(),r]}return[...e].reverse()}}(...e),ra=(...e)=>new rr(...e),ia=(...e)=>new class extends Cr{constructor(e,t){A("viewportQuantiles","input",0,rr,e&&(e.property||e)),C("viewportQuantiles","buckets",1,t);let r={input:e};r._histogram=Pa(e),super(r,t)}_compile(e){super._compile(e),T("viewportQuantiles","input",0,"number",this.input)}_genBreakpoints(){const e=this._histogram.value,t=e.length,r=e[0].x[0],i=e[t-1].x[1];let n=0;const a=e.map(({y:e})=>n+=e);let s=0;const o=a[t-1];let c=[];this.breakpoints.map((e,n)=>{for(;s<t&&!(a[s]>(n+1)/this.buckets*o);s++);const u=s/t*(i-r)+r;c.push(u),e.expr=u})}}(...e),na=(...e)=>new class extends Cr{constructor(e,t){A("globalQuantiles","input",0,rr,e&&(e.property||e)),C("globalQuantiles","buckets",1,t),super({input:e},t)}_compile(e){super._compile(e);const t=e.sample.map(e=>e[this.input.name]);T("globalQuantiles","input",0,"number",this.input),t.sort((e,t)=>e-t),this.breakpoints.map((e,r)=>{e.expr=t[Math.floor((r+1)/this.buckets*t.length)]})}}(...e),aa=(...e)=>new class extends Cr{constructor(e,t){A("globalEqIntervals","input",0,rr,e&&(e.property||e)),C("globalEqIntervals","buckets",1,t),super({input:e},t)}_compile(e){super._compile(e),T("globalEqIntervals","input",0,"number",this.input);const{min:t,max:r}=e.properties[this.input.name];this.min=t,this.max=r,this.breakpoints.map((e,i)=>{e.expr=t+(i+1)/this.buckets*(r-t)})}}(...e),sa=(...e)=>new class extends Cr{constructor(e,t){A("viewportEqIntervals","input",0,rr,e&&(e.property||e)),C("viewportEqIntervals","buckets",1,t);let r={input:e};r._min=Fa(e),r._max=Da(e),super(r,t)}_compile(e){super._compile(e),T("viewportEqIntervals","input",0,"number",this.input)}_genBreakpoints(){const e=this._min.eval(),t=this._max.eval();this.breakpoints.map((r,i)=>{r.expr=e+(i+1)/this.buckets*(t-e)})}}(...e),oa=(...e)=>new class extends Rt{constructor(e,t){e=b(e),t=b(t),E("ramp","input",0,e),x("ramp","input",0,Object.values(Pr),e),x("ramp","palette",1,Object.values(Lr),t),t.type===Lr.IMAGE&&(A("ramp","palette",1,Fr,t),x("ramp","input",0,Pr.CATEGORY,e)),super({input:e}),this.minKey=0,this.maxKey=1,this.palette=t,this.type=t.type===Lr.NUMBER_ARRAY?Ir.NUMBER:Ir.COLOR;try{t.type===Lr.NUMBER_ARRAY?this.palette.floats=this.palette.eval():t.type===Lr.COLOR_ARRAY&&(this.palette.colors=this.palette.eval())}catch(e){throw new Error("Palettes must be formed by constant expressions, they cannot depend on feature properties")}}loadImages(){return Promise.all([this.input.loadImages(),this.palette.loadImages()])}_setUID(e){super._setUID(e),this.palette._setUID(e)}eval(e){const t=this._computeTextureIfNeeded(),r=(this.input.eval(e)-this.minKey)/(this.maxKey-this.minKey);return this.type===Ir.NUMBER?this._getValue(t,t.length-1,r):this._getColorValue(t,r)}_getValue(e,t,r){const i=F(Math.floor(t*r),0,t),n=F(Math.ceil(t*r),0,t),a=t*r-Math.floor(t*r);return Math.round(a*e[n]+(1-a)*e[i])}_getColorValue(e,t){const r=Math.round(t*Br);return{r:Math.round(e[4*r+0]),g:Math.round(e[4*r+1]),b:Math.round(e[4*r+2]),a:Math.round(e[4*r+3])/Br}}_compile(e){super._compile(e),this.input.isA(rr)&&this.input.type===Pr.NUMBER&&(this.input=new pr(this.input),this.input._compile(e)),T("ramp","input",0,Object.values(Pr),this.input),this.palette.type===Lr.IMAGE&&(T("ramp","input",0,Pr.CATEGORY,this.input),A("ramp","palette",1,Fr,this.palette)),this._texCategories=null,this._GLtexCategories=null}_free(e){this.texture&&e.deleteTexture(this.texture)}_applyToShaderSource(e){const t=this.input._applyToShaderSource(e);if(this.palette.type===Lr.IMAGE){const r=this.palette._applyToShaderSource(e);return{preface:t.preface+r.preface,inline:`${r.inline}(imageUV, ${t.inline})`}}return{preface:this._prefaceCode(t.preface+`\n                uniform sampler2D texRamp${this._uid};\n                uniform float keyMin${this._uid};\n                uniform float keyWidth${this._uid};`),inline:this.palette.type===Lr.NUMBER_ARRAY?`(texture2D(texRamp${this._uid}, vec2((${t.inline}-keyMin${this._uid})/keyWidth${this._uid}, 0.5)).a)`:`texture2D(texRamp${this._uid}, vec2((${t.inline}-keyMin${this._uid})/keyWidth${this._uid}, 0.5)).rgba`}}_getColorsFromPalette(e,t){if(t.type===Lr.IMAGE)return t.colors;const r=new gr("gray");return t.type===Lr.PALETTE?V(e,t,this.maxKey,r.eval()):W(e,t,this.maxKey,r.eval())}_postShaderCompile(e,t){if(this.palette.type===Lr.IMAGE)return this.palette._postShaderCompile(e,t),void super._postShaderCompile(e,t);this.input._postShaderCompile(e,t),this._getBinding(e).texLoc=t.getUniformLocation(e,`texRamp${this._uid}`),this._getBinding(e).keyMinLoc=t.getUniformLocation(e,`keyMin${this._uid}`),this._getBinding(e).keyWidthLoc=t.getUniformLocation(e,`keyWidth${this._uid}`)}_computeTextureIfNeeded(){return this._texCategories=this.input.numCategories,this.input.type===Pr.CATEGORY&&(this.maxKey=this.input.numCategories-1),this.type===Ir.COLOR?this._computeColorRampTexture():this._computeNumericRampTexture()}_computeColorRampTexture(){const e=new Uint8Array(4*kr),t=this._getColorsFromPalette(this.input,this.palette);for(let r=0;r<kr;r++){const i=t[Math.floor(r/(kr-1)*(t.length-1))],n=t[Math.ceil(r/(kr-1)*(t.length-1))],a=[i.r/(kr-1),i.g/(kr-1),i.b/(kr-1),i.a],s=[n.r/(kr-1),n.g/(kr-1),n.b/(kr-1),n.a],o=r/(kr-1)*(t.length-1)-Math.floor(r/(kr-1)*(t.length-1)),c=q({r:a[0],g:a[1],b:a[2],a:a[3]},{r:s[0],g:s[1],b:s[2],a:s[3]},o);e[4*r+0]=Math.round(c.r*Br),e[4*r+1]=Math.round(c.g*Br),e[4*r+2]=Math.round(c.b*Br),e[4*r+3]=Math.round(c.a*Br)}return e}_computeNumericRampTexture(){const e=new Float32Array(kr),t=this.palette.floats;for(let r=0;r<kr;r++){const i=t[Math.floor(r/(kr-1)*(t.length-1))],n=t[Math.ceil(r/(kr-1)*(t.length-1))],a=r/(kr-1)*(t.length-1)-Math.floor(r/(kr-1)*(t.length-1));e[r]=(1-a)*i+a*n}return e}_computeGLTextureIfNeeded(e){const t=this._computeTextureIfNeeded();this._GLtexCategories!==this.input.numCategories&&(this._GLtexCategories=this.input.numCategories,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),this.type===Ir.COLOR?(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,kr,1,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,kr,1,0,e.ALPHA,e.FLOAT,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))}_preDraw(e,t,r){this.input._preDraw(e,t,r),this.palette.type!==Lr.IMAGE?(r.activeTexture(r.TEXTURE0+t.freeTexUnit),this._computeGLTextureIfNeeded(r),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e).texLoc,t.freeTexUnit),r.uniform1f(this._getBinding(e).keyMinLoc,this.minKey),r.uniform1f(this._getBinding(e).keyWidthLoc,this.maxKey-this.minKey),t.freeTexUnit++):this.palette._preDraw(e,t,r)}}(...e),ca=(...e)=>new Or(...e),ua=(...e)=>new Nr(...e),fa=(...e)=>new tr(...e),la=(...e)=>new Ur(...e),ha=(...e)=>new Mr(...e),da=(...e)=>new qr(...e),pa=(...e)=>new Wr(...e),ma=(...e)=>g(e,Wr),ga=(...e)=>new jr(...e),ba=(...e)=>new Xr(...e),_a=(...e)=>new Hr(...e),ya=(...e)=>new Yr(...e),va=(...e)=>new Zr(...e),xa=(...e)=>new Kr(...e),wa=(...e)=>new Qr(...e),Ea=(...e)=>new Jr(...e),Ta=(...e)=>new ei(...e),Aa=(...e)=>new ti(...e),Ca=(...e)=>new ri(...e),Sa=(...e)=>(function(e){if(S("variable","name",0,e),""===e)throw new Error("variable(): invalid parameter, zero-length string");let t;const r=r=>{if(!r[e])throw new Error(`variable() name '${e}' doesn't exist`);t=r[e]},i=()=>[t];let n={set:(e,r,i)=>{if("parent"===r)e[r]=i;else if("notify"===r)e[r]=i;else{if(!t||!t[r])return!1;t[r]=i}return!0},get:(e,n)=>"parent"===n?e[n]:"_resolveAliases"===n?r:"_getDependencies"===n?i:"notify"===n?e[n]:"blendTo"===n?e[n]:t&&t[n]?(a=t[n])&&"[object Function]"==={}.toString.call(a)?t[n].bind(t):t[n]:e[n]};var a;return new Proxy(new ii,n)})(...e),Ra=(...e)=>new ni(...e),Da=(...e)=>new ai(...e),Fa=(...e)=>new si(...e),Ma=(...e)=>new oi(...e),La=(...e)=>new ci(...e),Ia=(...e)=>new class extends Rt{constructor(e,t){super({property:b(e),percentile:b(t),impostor:Yn(0)}),this._isViewport=!0}isFeatureDependent(){return!1}get value(){return this.eval()}eval(e){if(null===this._value){this._array.sort((e,t)=>e-t);const t=F(Math.floor(this.percentile.eval(e)/100*this._array.length),0,this._array.length-1);this._value=this._array[t]}return this._value}_compile(e){super._compile(e),this.property._compile(e),this.type="number",super.inlineMaker=(e=>e.impostor)}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_resetViewportAgg(){this._value=null,this._array=[]}accumViewportAgg(e){const t=this.property.eval(e);this._array.push(t)}_preDraw(...e){this.impostor.expr=this.eval(),super._preDraw(...e)}}(...e),Pa=(...e)=>new class extends Rt{constructor(e,t=1,r=1e3){super({x:b(e),weight:b(t)}),this._size=r,this._isViewport=!0,this.inlineMaker=(()=>null)}_resetViewportAgg(){this._cached=null,this._histogram=new Map}accumViewportAgg(e){const t=this.x.eval(e),r=this.weight.eval(e),i=this._histogram.get(t)||0;this._histogram.set(t,i+r)}get value(){if(null===this._cached){if(!this._histogram)return null;if("number"===this.x.type){const e=[...this._histogram];let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i++){const n=e[i][0];t=Math.min(t,n),r=Math.max(r,n)}const i=Array(this._size).fill(0),n=r-t,a=this._size-1;for(let r=0;r<e.length;r++){const s=e[r][1];i[Math.min(Math.floor(this._size*(e[r][0]-t)/n),a)]+=s}this._cached=i.map((e,r)=>({x:[t+r/this._size*n,t+(r+1)/this._size*n],y:e}))}else this._cached=[...this._histogram].map(([e,t])=>({x:this._metatada.IDToCategory.get(e),y:t}))}return this._cached}_compile(e){this._metatada=e,super._compile(e)}}(...e),ka=(...e)=>new class extends Rt{constructor(...e){super(function(e){let t=0;const r={};return e.forEach(e=>{r["p"+ ++t]=e}),r}(e=e.map(e=>b(e)))),this.expr=[],this.type="featureList",this._isViewport=!0,this._requiredProperties=e,this._FeatureProxy=null}_compile(){throw new Error("viewportFeatures cannot be used in visualizations")}isFeatureDependent(){return!1}get value(){return this.expr}eval(){return this.expr}_resetViewportAgg(e){if(!this._FeatureProxy){if(!this._requiredProperties.every(e=>e.isA(rr)))throw new Error("viewportFeatures arguments can only be properties");const t=this._getMinimumNeededSchema().columns;this._FeatureProxy=this.genViewportFeatureClass(t,e)}this.expr=[]}accumViewportAgg(e){this.expr.push(new this._FeatureProxy(e))}genViewportFeatureClass(e){const t=class{constructor(e){this._feature=e}};return e.forEach(e=>{Object.defineProperty(t.prototype,e,{get:function(){return this._feature[e]}})}),t}}(...e),Ba=(...e)=>new ui(...e),Oa=(...e)=>new fi(...e),Na=(...e)=>new li(...e),Ua=(...e)=>new hi(...e),$a=(...e)=>new di(...e),za=(...e)=>new class extends Rt{constructor(e,t){if(!Number.isFinite(t))throw new Error("Percentile must be a fixed literal number");super({_value:Yn(0)}),this.property=e,this.percentile=t}isFeatureDependent(){return!1}get value(){return this._value.expr}_compile(e){super._compile(e),this.property._compile(e),this.type="number",super.inlineMaker=(e=>e._value);const t=e.sample.map(e=>e[this.property.name]);t.sort((e,t)=>e-t),this._value.expr=t[Math.floor(this.percentile/100*t.length)]}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_getColumnName(){return this.property.aggName?We.aggColumn(this.property.name,this.property.aggName):this.property.name}}(...e),qa=(...e)=>new class extends Rt{constructor(e,t,r){super({x:e=b(e),y:t=b(t),z:r=b(r)})}_compile(e){if(super._compile(e),"number"!==this.x.type||"number"!==this.y.type||"number"!==this.z.type)throw new Error("XYZ() invalid parameters");this.type="color",this._setGenericGLSL(e=>`vec4(xyztosrgb((\n                vec3(\n                    clamp(${e.x}, -100000., 10000.),\n                    clamp(${e.y}, -12800., 12800.),\n                    clamp(${e.z}, -12800., 12800.)\n                )\n            )), 1)`,"\n        #ifndef cielabtoxyz_fn\n        #define cielabtoxyz_fn\n\n        const mat3 XYZ_2_RGB = (mat3(\n            3.2404542,-1.5371385,-0.4985314,\n           -0.9692660, 1.8760108, 0.0415560,\n            0.0556434,-0.2040259, 1.0572252\n       ));\n       const mat3 XYZ_2_RGB_T = (mat3(\n        3.2404542,-0.9692660,0.0556434,\n        -1.5371385, 1.8760108, -0.2040259,\n        -0.4985314,0.0415560, 1.0572252\n   ));\n       const float SRGB_GAMMA = 1.0 / 2.2;\n\n       vec3 rgb_to_srgb_approx(vec3 rgb) {\n        return pow(rgb, vec3(SRGB_GAMMA));\n    }\n        float f1(float t){\n            const float sigma = 6./29.;\n            if (t>sigma){\n                return t*t*t;\n            }else{\n                return 3.*sigma*sigma*(t-4./29.);\n            }\n        }\n        vec3 cielabtoxyz(vec3 c) {\n            const float xn = 95.047;\n            const float yn = 100.;\n            const float zn = 108.883;\n            return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                        yn*f1((c.x+16.)/116.),\n                        zn*f1((c.x+16.)/116.  - c.z/200. )\n                    );\n        }\n        vec3 xyztorgb(vec3 c){\n            return c * XYZ_2_RGB;\n        }\n\n        vec3 xyztosrgb(vec3 c) {\n            return rgb_to_srgb_approx(xyztorgb(c));\n        }\n        #endif\n        ")}}(...e),Va=(...e)=>new class extends Rt{constructor(){super({zoom:Yn(0)}),this.type="number"}eval(){return this.zoom.expr}_compile(e){super._compile(e),super.inlineMaker=(e=>e.zoom)}_preDraw(e,t,r){this.zoom.expr=t.zoom,this.zoom._preDraw(e,t,r)}}(...e),Ga=(...e)=>new pi(...e),Wa=new cr(Number.MAX_SAFE_INTEGER),ja=new cr(1),Xa=new cr(0),Ha=new cr(Math.PI),Ya=new cr(Math.E),Za=new gi(Qi.bicycle),Ka=new gi(Qi.building),Qa=new gi(Qi.bus),Ja=new gi(Qi.car),es=new gi(Qi.circle),ts=new gi(Qi.circleOutline),rs=new gi(Qi.cross),is=new gi(Qi.flag),ns=new gi(Qi.house),as=new gi(Qi.marker),ss=new gi(Qi.markerOutline),os=new gi(Qi.plus),cs=new gi(Qi.square),us=new gi(Qi.squareOutline),fs=new gi(Qi.star),ls=new gi(Qi.starOutline),hs=new gi(Qi.triangle),ds=new gi(Qi.triangleOutline),ps=new pi(In(0),In(0)),ms=new pi(In(0),In(1));var gs=r(0),bs=r.n(gs);const _s=[],ys={};Object.keys(Me).filter(e=>e[0]===e[0].toLowerCase()).map(e=>{ys[e.toLocaleLowerCase()]=Me[e]}),ys.true=ja,ys.false=Xa,ys.align_center=ps,ys.align_bottom=ms,ys.pi=Ha,ys.e=Ya,ys.hold=Wa,ys.bicycle=Za,ys.building=Ka,ys.bus=Qa,ys.car=Ja,ys.circle=es,ys.circleoutline=ts,ys.cross=rs,ys.flag=is,ys.house=ns,ys.marker=as,ys.markeroutline=ss,ys.star=fs,ys.staroutline=ls,ys.triangle=hs,ys.triangleoutline=ds;const vs=()=>re(ca(0,0,0)),xs=()=>re(Yn(1)),ws=()=>re(ca(0,0,0)),Es=()=>re(Yn(0)),Ts=()=>Jn(),As=()=>In(1),Cs=()=>{const e=Xa;return e._default=!0,e},Ss=()=>ms,Rs=()=>1,Ds=0,Fs=256,Ms=["color","width","strokeColor","strokeWidth","order","filter","symbol","symbolPlacement","resolution","variables"];class Ls{constructor(e){const t=this._getVizDefinition(e);this._checkVizSpec(t),Object.keys(t).forEach(e=>{this._defineProperty(e,t[e])}),Object.keys(t).includes("variables")||this._defineProperty("variables",{}),this.updated=!0,this._changeCallback=null,this._updateRootExpressions(),this._resolveAliases(),this._validateAliasDAG()}loadImages(){return Promise.all(this._getRootExpressions().map(e=>e.loadImages()))}_defineProperty(e,t){if(!Ms.includes(e))return;Object.defineProperty(this,e,{get:()=>this["_"+e],set:t=>{"resolution"!==e&&(t=b(t)),this["_"+e]=t,this._changed()}});let r=t;if("variables"===e){let e=!1;r=new Proxy({},{get:(e,t)=>e[t],set:(t,r,i)=>(i=b(i),t[r]=i,this["__cartovl_variable_"+r]=i,e&&this._changed(),!0)}),Object.keys(t).map(e=>{r[e]=t[e]}),e=!0}this["_"+e]=r}_getRootExpressions(){return[this.color,this.width,this.strokeColor,this.strokeWidth,this.order,this.filter,this.symbol,this.symbolPlacement,...Object.values(this.variables)]}_updateRootExpressions(){this._getRootExpressions().forEach(e=>{e.parent=this,e.notify=this._changed.bind(this)})}isAnimated(){return this.color.isAnimated()||this.width.isAnimated()||this.strokeColor.isAnimated()||this.strokeWidth.isAnimated()||this.filter.isAnimated()||this.symbol.isAnimated()||this.symbolPlacement.isAnimated()}onChange(e){this._changeCallback=e}_changed(){this._resolveAliases(),this._validateAliasDAG(),this._changeCallback&&this._changeCallback(this)}getMinimumNeededSchema(){return this._getRootExpressions().filter(e=>e&&e._getMinimumNeededSchema).map(e=>e._getMinimumNeededSchema()).reduce(je.union,je.IDENTITY)}setDefaultsIfRequired(e){if(this._appliedDefaults)return;let t=this._getDefaultGeomStyle(e);t&&(this._appliedDefaults=!0,this.color.default&&(this.color=t.COLOR_EXPRESSION()),this.width.default&&(this.width=t.WIDTH_EXPRESSION()),this.strokeColor.default&&(this.strokeColor=t.STROKE_COLOR_EXPRESSION()),this.strokeWidth.default&&(this.strokeWidth=t.STROKE_WIDTH_EXPRESSION()),this._updateRootExpressions())}_getDefaultGeomStyle(e){return"point"===e?{COLOR_EXPRESSION:()=>re(Un("#EE4D5A")),WIDTH_EXPRESSION:()=>re(Yn(7)),STROKE_COLOR_EXPRESSION:()=>re(Un("#FFF")),STROKE_WIDTH_EXPRESSION:()=>re(Yn(1))}:"line"===e?{COLOR_EXPRESSION:()=>re(Un("#4CC8A3")),WIDTH_EXPRESSION:()=>re(Yn(1.5)),STROKE_COLOR_EXPRESSION:()=>re(Un("#FFF")),STROKE_WIDTH_EXPRESSION:()=>re(Yn(1))}:"polygon"===e?{COLOR_EXPRESSION:()=>re(Un("#826DBA")),WIDTH_EXPRESSION:()=>re(Yn(1)),STROKE_COLOR_EXPRESSION:()=>re(Un("#FFF")),STROKE_WIDTH_EXPRESSION:()=>re(Yn(1))}:void 0}_resolveAliases(){[this.color,this.width,this.strokeColor,this.strokeWidth,this.filter,this.symbol,this.symbolPlacement].concat(Object.values(this.variables)).forEach(e=>e._resolveAliases(this.variables))}_validateAliasDAG(){const e=new Set,t=new Set,r=i=>{if(!e.has(i)){if(t.has(i))throw new Error("Viz contains a circular dependency");t.add(i),i._getDependencies().forEach(r),e.add(i)}},i=[...this.color._getDependencies(),...this.strokeColor._getDependencies(),...this.width._getDependencies(),...this.strokeWidth._getDependencies(),...this.filter._getDependencies(),...this.symbol._getDependencies(),...this.symbolPlacement._getDependencies()];for(;i.length;)r(i.pop())}compileShaders(e,t){this.color._bind(t),this.width._bind(t),this.strokeColor._bind(t),this.strokeWidth._bind(t),this.symbol._bind(t),this.filter._bind(t),this.colorShader=m(e,Ct.styler.colorShaderGLSL,{color:this.color},this),this.widthShader=m(e,Ct.styler.widthShaderGLSL,{width:this.width},this),this.strokeColorShader=m(e,Ct.styler.colorShaderGLSL,{color:this.strokeColor},this),this.strokeWidthShader=m(e,Ct.styler.widthShaderGLSL,{width:this.strokeWidth},this),this.filterShader=m(e,Ct.styler.filterShaderGLSL,{filter:this.filter},this),this.symbolPlacement._bind(t),this.symbol._default||(this.symbolShader=m(e,Ct.symbolizer.symbolShaderGLSL,{symbol:this.symbol,symbolPlacement:this.symbolPlacement},this))}replaceChild(e,t){if(Object.values(this.variables).includes(e)){const r=Object.keys(this.variables).find(t=>this.variables[t]===e);this.variables[r]=t,t.parent=this,t.notify=e.notify}else if(e===this.color)this.color=t,t.parent=this,t.notify=e.notify;else if(e===this.width)this.width=t,t.parent=this,t.notify=e.notify;else if(e===this.strokeColor)this.strokeColor=t,t.parent=this,t.notify=e.notify;else if(e===this.strokeWidth)this.strokeWidth=t,t.parent=this,t.notify=e.notify;else if(e===this.filter)this.filter=t,t.parent=this,t.notify=e.notify;else if(e===this.symbol)this.symbol=t,t.parent=this,t.notify=e.notify;else{if(e!==this.symbolPlacement)throw new Error("No child found");this.symbolPlacement=t,t.parent=this,t.notify=e.notify}}_getVizDefinition(e){if(ke.isUndefined(e))return this._setDefaults({});if(ke.isObject(e))return this._setDefaults(e);if(ke.isString(e))return this._setDefaults(function(e){ee();const t=bs()(function(e){const t={singleQuote:!1,doubleQuote:!1,blockComment:!1,lineComment:!1,escape:0};for(let r=0,i=(e=("_"+e+"_").split("")).length;r<i;r++)if(t.singleQuote)"\\"===e[r]?t.escape++:"'"===e[r]&&t.escape%2==0&&(t.singleQuote=!1,t.escape=0);else if(t.doubleQuote)"\\"===e[r]?t.escape++:'"'===e[r]&&t.escape%2==0&&(t.doubleQuote=!1,t.escape=0);else if(t.blockComment)"*"===e[r]&&"/"===e[r+1]&&(e[r+1]="",t.blockComment=!1),e[r]="";else if(t.lineComment)"\n"!==e[r+1]&&"\r"!==e[r+1]||(t.lineComment=!1),r+1<i&&(e[r]="");else if(t.doubleQuote='"'===e[r],t.singleQuote="'"===e[r],"/"===e[r]){if("*"===e[r+1]){e[r]="",t.blockComment=!0;continue}if("/"===e[r+1]){e[r]="",t.lineComment=!0;continue}}return e.join("").slice(1,-1)}(e));let r={variables:{}};return"Compound"===t.type?t.body.map(e=>Q(r,e)):Q(r,t),te(),r}(e));throw new $e("viz","nonValidDefinition")}_setDefaults(e){return ke.isUndefined(e.color)&&(e.color=vs()),ke.isUndefined(e.width)&&(e.width=xs()),ke.isUndefined(e.strokeColor)&&(e.strokeColor=ws()),ke.isUndefined(e.strokeWidth)&&(e.strokeWidth=Es()),ke.isUndefined(e.order)&&(e.order=Ts()),ke.isUndefined(e.filter)&&(e.filter=As()),ke.isUndefined(e.resolution)&&(e.resolution=Rs()),ke.isUndefined(e.symbol)&&(e.symbol=Cs()),ke.isUndefined(e.symbolPlacement)&&(e.symbolPlacement=Ss()),e.variables=e.variables||{},e}_checkVizSpec(e){if(e.width=b(e.width),e.strokeWidth=b(e.strokeWidth),e.symbolPlacement=b(e.symbolPlacement),e.symbol=b(e.symbol),e.filter=b(e.filter),!ke.isNumber(e.resolution))throw new $e("viz","resolutionNumberRequired");if(e.resolution<=Ds)throw new $e("viz",`resolutionTooSmall[${Ds}]`);if(e.resolution>=Fs)throw new $e("viz",`resolutionTooBig[${Fs}]`);if(!(e.color instanceof Rt))throw new $e("viz","nonValidExpression[color]");if(!(e.strokeColor instanceof Rt))throw new $e("viz","nonValidExpression[strokeColor]");if(!(e.width instanceof Rt))throw new $e("viz","nonValidExpression[width]");if(!(e.strokeWidth instanceof Rt))throw new $e("viz","nonValidExpression[strokeWidth]");if(!(e.order instanceof Rt))throw new $e("viz","nonValidExpression[order]");if(!(e.filter instanceof Rt))throw new $e("viz","nonValidExpression[filter]");if(!(e.symbol instanceof Rt))throw new $e("viz","nonValidExpression[symbol]");if(!(e.symbolPlacement instanceof Rt))throw new $e("viz","nonValidExpression[symbolPlacement]");for(let t in e)Ms.indexOf(t)}}class Is{constructor(e){if("string"==typeof(e=e||{}).container){const t=window.document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container}' not found.`);this._container=t}this._background=e.background||"",this._layers=[],this._repaint=!0,this.invalidateWebGLState=(()=>{}),this._canvas=this._createCanvas(),this._container.appendChild(this._canvas),this._gl=this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"),this._resizeCanvas(this._containerDimensions())}addLayer(e,t){let r;for(e.initialize(),r=0;r<this._layers.length&&this._layers[r].getId()!==t;r++);this._layers.splice(r,0,e),window.requestAnimationFrame(this.update.bind(this))}update(e){if(this.lastFrame===e)return;this.lastFrame=e,this._drawBackground(this._background);let t=!0,r=!1;this._layers.forEach(e=>{const i=e.hasDataframes(),n=e.getViz()&&e.getViz().isAnimated();(i||n)&&e.$paintCallback(),t=t&&i,r=r||n}),t&&!r||window.requestAnimationFrame(this.update.bind(this))}_drawBackground(e){switch(e){case"black":this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"red":this._gl.clearColor(1,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"green":this._gl.clearColor(0,1,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"blue":this._gl.clearColor(0,0,1,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}}_createCanvas(){const e=window.document.createElement("canvas");return e.className="canvas",e.style.position="absolute",e}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.offsetWidth||400,t=this._container.offsetHeight||300),{width:e,height:t}}_resizeCanvas(e){const t=window.devicePixelRatio||1;this._canvas.width=t*e.width,this._canvas.height=t*e.height,this._canvas.style.width=`${e.width}px`,this._canvas.style.height=`${e.height}px`}}var Ps=function(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}};const ks=Date.now(),Bs=.5,Os=1024;class Ns{constructor(e){if(e){if(this.gl=e.getContext("webgl"),!this.gl)throw new Error("WebGL 1 is unsupported");this._initGL(this.gl)}this._center={x:0,y:0},this._zoom=1,this.RTT_WIDTH=Os,this.dataframes=[]}_initGL(e){if(this.gl=e,!e.getExtension("OES_texture_float"))throw new Error("WebGL extension OES_texture_float is unsupported");const t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);if(t<Os)throw new Error(`WebGL parameter 'gl.MAX_RENDERBUFFER_SIZE' is below the requirement: ${t} < ${Os}`);this._initShaders(),this.auxFB=e.createFramebuffer(),this.bigTriangleVBO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.bigTriangleVBO);e.bufferData(e.ARRAY_BUFFER,new Float32Array([10,-10,0,10,-10,-10]),e.STATIC_DRAW),this.zeroTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.zeroTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this._AATex=e.createTexture(),this._AAFB=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,this.zeroTex)}getCenter(){return{x:this._center.x,y:this._center.y}}setCenter(e,t){this._center.x=e,this._center.y=t}getBounds(){const e=this.getCenter(),t=this.getZoom()*this.getAspect(),r=this.getZoom();return[e.x-t,e.y-r,e.x+t,e.y+r]}getZoom(){return this._zoom}setZoom(e){this._zoom=e}getAspect(){return this.gl?this.gl.canvas.width/this.gl.canvas.height:1}_runViewportAggregations(e){const t=e.getActiveDataframes(),r=e.viz,i=this._getViewportExpressions(r._getRootExpressions());if(!i.length)return;const n=t.length?t[0].metadata:{};i.forEach(e=>e._resetViewportAgg(n));const a=i.length,s=new Set,o=this.gl.canvas.width/this.gl.canvas.height;t.forEach(e=>{for(let t=0;t<e.numFeatures;t++){const c=e.properties[n.idProperty][t];if(s.has(c))continue;if(!this._isFeatureInViewport(e,t,o))continue;s.add(c);const u=this._featureFromDataFrame(e,t,n);if(!(r.filter.eval(u)<Bs))for(let e=0;e<a;e++)i[e].accumViewportAgg(u)}})}_isFeatureInViewport(e,t,r){return e.inViewport(t,1/this._zoom,this._center,r)}_getViewportExpressions(e){const t=[];return e.map(function e(r){r._isViewport?t.push(r):r._getChildren().map(e)}),t}_featureFromDataFrame(e,t,r){if(e.cachedFeatures||(e.cachedFeatures=[]),void 0!==e.cachedFeatures[t])return e.cachedFeatures[t];const i={},n=Object.keys(e.properties);for(let a=0;a<n.length;a++){const s=n[a];i[s]="category"===r.properties[s].type?r.IDToCategory.get(e.properties[s][t]):e.properties[s][t]}return e.cachedFeatures[t]=i,i}renderLayer(e){const t=e.getActiveDataframes(),r=e.viz,i=this.gl,n=this.getAspect(),a={zoom:i.drawingBufferHeight/(1024*this._zoom*(window.devicePixelRatio||1))};if(!t.length)return;r._getRootExpressions().map(e=>e._dataReady()),i.enable(i.CULL_FACE),i.disable(i.BLEND),i.disable(i.DEPTH_TEST),i.disable(i.STENCIL_TEST),i.depthMask(!1),i.bindFramebuffer(i.FRAMEBUFFER,this.auxFB),this._runViewportAggregations(e);const s=(e,t,n,s)=>{const o=n.textureIds.get(r);i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),i.viewport(0,0,Os,e.height),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(n.program),a.freeTexUnit=Object.keys(o).length,s._setTimestamp((Date.now()-ks)/1e3),s._preDraw(n.program,a,i),Object.keys(o).forEach((t,r)=>{i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e.getPropertyTexture(t)),i.uniform1i(o[t],r)}),i.enableVertexAttribArray(n.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(n.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(n.vertexAttribute)};if(t.map(e=>s(e,e.texColor,r.colorShader,r.color)),t.map(e=>s(e,e.texWidth,r.widthShader,r.width)),t.map(e=>s(e,e.texStrokeColor,r.strokeColorShader,r.strokeColor)),t.map(e=>s(e,e.texStrokeWidth,r.strokeWidthShader,r.strokeWidth)),t.map(e=>s(e,e.texFilter,r.filterShader,r.filter)),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.enable(i.BLEND),i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),"point"!==e.type){const e=(window.devicePixelRatio||1)>=2?1:2;i.bindFramebuffer(i.FRAMEBUFFER,this._AAFB);const[t,r]=[i.drawingBufferWidth,i.drawingBufferHeight];t===this._width&&r===this._height||(i.bindTexture(i.TEXTURE_2D,this._AATex),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t*e,r*e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._AATex,0),[this._width,this._height]=[t,r]),i.viewport(0,0,t*e,r*e),i.clear(i.COLOR_BUFFER_BIT)}const o=1/this._zoom,{orderingMins:c,orderingMaxs:u}=function(e){const t=e.viz.order;let r=[0],i=[1e3];return t.isA(_r)?(r=Array.from({length:64},(e,t)=>2*(63-t)),i=Array.from({length:64},(e,t)=>0===t?1e3:2*(63-t+1))):t.isA(yr)&&(r=Array.from({length:64},(e,t)=>2*t),i=Array.from({length:64},(e,t)=>63===t?1e3:2*(t+1))),{orderingMins:r,orderingMaxs:i}}(e),f=e=>t.forEach(t=>{let s=0,f=null;if(i.useProgram((f=r.symbol._default?"point"===t.type?this.finalRendererProgram:"line"===t.type?this.lineRendererProgram:this.triRendererProgram:r.symbolShader).program),r.symbol._default||i.uniform1i(f.overrideColor,void 0===r.color.default?1:0),i.uniform1f(f.orderMinWidth,c[e]),i.uniform1f(f.orderMaxWidth,u[e]),i.uniform2f(f.vertexScaleUniformLocation,o/n*t.scale,o*t.scale),i.uniform2f(f.vertexOffsetUniformLocation,o/n*(this._center.x-t.center.x),o*(this._center.y-t.center.y)),"line"===t.type||"polygon"===t.type?i.uniform2f(f.normalScale,1/i.canvas.clientWidth,1/i.canvas.clientHeight):"point"===t.type&&i.uniform1f(f.devicePixelRatio,window.devicePixelRatio||1),t.vertexScale=[o/n*t.scale,o*t.scale],t.vertexOffset=[o/n*(this._center.x-t.center.x),o*(this._center.y-t.center.y)],i.enableVertexAttribArray(f.vertexPositionAttribute),i.bindBuffer(i.ARRAY_BUFFER,t.vertexBuffer),i.vertexAttribPointer(f.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(f.featureIdAttr),i.bindBuffer(i.ARRAY_BUFFER,t.featureIDBuffer),i.vertexAttribPointer(f.featureIdAttr,2,i.FLOAT,!1,0,0),"line"!==t.type&&"polygon"!==t.type||(i.enableVertexAttribArray(f.normalAttr),i.bindBuffer(i.ARRAY_BUFFER,t.normalBuffer),i.vertexAttribPointer(f.normalAttr,2,i.FLOAT,!1,0,0)),i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,t.texColor),i.uniform1i(f.colorTexture,s),i.activeTexture(i.TEXTURE0+ ++s),i.bindTexture(i.TEXTURE_2D,t.texWidth),i.uniform1i(f.widthTexture,s),i.activeTexture(i.TEXTURE0+ ++s),i.bindTexture(i.TEXTURE_2D,t.texFilter),i.uniform1i(f.filterTexture,s),s++,r.symbol._default)"line"!==t.type&&(i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,t.texStrokeColor),i.uniform1i(f.colorStrokeTexture,s),i.activeTexture(i.TEXTURE0+ ++s),i.bindTexture(i.TEXTURE_2D,t.texStrokeWidth),i.uniform1i(f.strokeWidthTexture,s),s++);else{const e=r.symbolShader.textureIds.get(r);a.freeTexUnit=s+Object.keys(e).length,r.symbol._setTimestamp((Date.now()-ks)/1e3),r.symbol._preDraw(r.symbolShader.program,a,i),r.symbolPlacement._setTimestamp((Date.now()-ks)/1e3),r.symbolPlacement._preDraw(r.symbolShader.program,a,i),s=a.freeTexUnit,Object.keys(e).forEach(r=>{i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,t.getPropertyTexture(r)),i.uniform1i(e[r],s),s++}),i.uniform2f(f.resolution,i.canvas.width,i.canvas.height)}i.drawArrays("point"===t.type?i.POINTS:i.TRIANGLES,0,t.numVertex),i.disableVertexAttribArray(f.vertexPositionAttribute),i.disableVertexAttribArray(f.featureIdAttr),"line"!==t.type&&"polygon"!==t.type||i.disableVertexAttribArray(f.normalAttr)});c.map((e,t)=>{f(t)}),"point"!==e.type&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.useProgram(this._aaBlendShader.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._AATex),i.uniform1i(this._aaBlendShader.readTU,0),i.enableVertexAttribArray(this._aaBlendShader.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(this._aaBlendShader.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(this._aaBlendShader.vertexAttribute)),i.disable(i.CULL_FACE)}_initShaders(){this.finalRendererProgram=Ct.renderer.createPointShader(this.gl),this.triRendererProgram=Ct.renderer.createTriShader(this.gl),this.lineRendererProgram=Ct.renderer.createLineShader(this.gl),this._aaBlendShader=new Ct.AABlender(this.gl)}}let Us=null;class $s{constructor(e){this.map=e,this.renderer=new Ns,this.renderer._initGL(this.map._gl),this.invalidateWebGLState=(()=>{})}addLayer(e,t){this.map.addLayer(e,t)}needRefresh(){}getZoomLevel(){return 0}}let zs=0;const qs=new WeakMap;class Vs{constructor(e){this.renderer=new Ns,this.map=e,this.invalidateWebGLState=null,this.moveObservers={},this._emitter=Ps(),this._layers=[],this._paintedLayers=0,this._isRendererInitialized=!1,this._suscribeToMapEvents(e),this.invalidateWebGLState=(()=>{})}on(e,t){return this._emitter.on(e,t)}off(e,t){return this._emitter.off(e,t)}_suscribeToMapEvents(e){e.on("movestart",this.move.bind(this)),e.on("move",this.move.bind(this)),e.on("moveend",this.move.bind(this)),e.on("resize",this.move.bind(this)),e.on("mousemove",e=>{this._emitter.emit("mousemove",e)}),e.on("click",e=>{this._emitter.emit("click",e)})}_registerMoveObserver(e,t){this.moveObservers[e]=t}_unregisterMoveObserver(e){delete this.moveObservers[e]}addLayer(e,t){const r=`_cartovl_${zs++}`,i=e.getId();this._registerMoveObserver(r,e.requestData.bind(e)),this.map.setCustomWebGLDrawCallback(i,(t,r)=>{this._isRendererInitialized||(this._isRendererInitialized=!0,this.invalidateWebGLState=r,this.notifyObservers(),this.renderer._initGL(t)),e.initialize(),e.$paintCallback(),this._paintedLayers++,!this._layers.some(e=>e.getViz()&&e.getViz().isAnimated())&&this.map.repaint&&(this.map.repaint=!1),r()}),this.map.addLayer({id:i,type:"custom-webgl"},t),this._layers.push(e),this.move()}needRefresh(){this.map.repaint=!0}move(){const e=this.map.getCenter();this.renderer.setCenter(e.lng/180,ke.projectToWebMercator(e).y/ke.WM_R),this.renderer.setZoom(this.getZoom()),this.notifyObservers()}notifyObservers(){Object.keys(this.moveObservers).map(e=>this.moveObservers[e]())}getZoom(){const e=this.map.getBounds(),t=this.map.getCenter(),r=e.getNorthWest(),i=e.getSouthWest(),n=(ke.projectToWebMercator(r).y-ke.projectToWebMercator(i).y)/ke.WM_2R;return this.renderer.setCenter(t.lng/180,ke.projectToWebMercator(t).y/ke.WM_R),n}getZoomLevel(){return this.map.getZoom()}}class Gs{get value(){return this._viz[this._propertyName].eval(this._properties)}constructor(e,t,r,i,n,a){this._propertyName=e,this._feature=t,this._viz=r,this._properties=this._feature.properties,this.blendTo=ie(e,t,i,r,n,a),this.reset=function(e,t,r,i,n){return function(a=500){r[t.id]&&r[t.id][e]&&(r[t.id][e].replaceChild(r[t.id][e].mix,An(gn(ra(n),t.id),Ji(0),Ji(a))),i[e].notify(),r[t.id][e]=void 0)}}(e,t,i,r,a)}}class Ws{constructor(e,t,r,i,n){const a={};Object.keys(t.variables).map(s=>{a[s]=new Gs(`__cartovl_variable_${s}`,e,t,r,i,n)}),this.id=e.id,this.color=new Gs("color",e,t,r,i,n),this.width=new Gs("width",e,t,r,i,n),this.strokeColor=new Gs("strokeColor",e,t,r,i,n),this.strokeWidth=new Gs("strokeWidth",e,t,r,i,n),this.variables=a}reset(e=500){this.color.reset(e),this.width.reset(e),this.strokeColor.reset(e),this.strokeWidth.reset(e);for(let t in this.variables)this.variables[t].reset(e)}}class js{constructor(){this.dataframes=[],this.renderer=null,this.viz=null,this.type=null,this.customizedFeatures={},this.idProperty=null}addDataframe(e){this.type&&this._checkDataframeType(e),this.type=e.type,this.renderer&&e.bind(this.renderer),this.dataframes.push(e),this.idProperty=e.metadata.idProperty}getActiveDataframes(){return this.dataframes=this.dataframes.filter(e=>!e.freed),this.dataframes.filter(e=>e.active&&e.numVertex)}hasDataframes(){return this.getActiveDataframes().length>0}getNumFeatures(){return this.getActiveDataframes().map(e=>e.numFeatures).reduce((e,t)=>e+t,0)}_checkDataframeType(e){if(this.type!==e.type)throw new Error("Layer dataframes must always be of the same type")}getFeaturesAtPosition(e){return this.viz?[].concat(...this.getActiveDataframes().map(t=>t.getFeaturesAtPosition(e,this.viz))).map(this._generateApiFeature.bind(this)):[]}_generateApiFeature(e){return new Ws(e,this.viz,this.customizedFeatures,this.trackFeatureViz,this.idProperty)}trackFeatureViz(e,t,r,i){i[e]=i[e]||{},i[e][t]=r}freeDataframes(){this.dataframes.map(e=>e.free()),this.dataframes=[],this.type=null}}class Xs{}class Hs{constructor(e,t,r){this._checkId(e),this._checkSource(t),this._checkViz(r),this._oldDataframes=new Set,this._isInitialized=!1,this._init(e,t,r)}_init(e,t,r){r._boundLayer=this,this.state="init",this._id=e,this._emitter=Ps(),this._lastViewport=null,this._lastMNS=null,this._integrator=null,this._context=new Promise(e=>{this._contextInitialize=e}),this._integratorPromise=new Promise(e=>{this._integratorCallback=e}),this.metadata=null,this._renderLayer=new js,this.state="init",this._isLoaded=!1,this._fireUpdateOnNextRender=!1,this.update(t,r)}on(e,t){return this._emitter.on(e,t)}off(e,t){return this._emitter.off(e,t)}addTo(e,t){if(this._isCartoMap(e))this._addToCartoMap(e,t);else{if(!this._isMGLMap(e))throw new $e("layer","nonValidMap");this._addToMGLMap(e,t)}}async update(e,t){this._checkSource(e),this._checkViz(t),e=e._clone(),this._atomicChangeUID=this._atomicChangeUID+1||1;const r=this._atomicChangeUID,i=t.loadImages(),n=await e.requestMetadata(t);if(await this._integratorPromise,await i,await this._context,this._atomicChangeUID>r)throw new Error("Another atomic change was done before this one committed");if(this.metadata=n,e.bindLayer(this._onDataframeAdded.bind(this),this._onDataLoaded.bind(this)),this._source!==e&&this._freeSource(),this._source=e,this.requestData(),t.setDefaultsIfRequired(this.metadata.geomType),await this._context,this._atomicChangeUID>r)throw new Error("Another atomic change was done before this one committed");this._viz&&this._viz.onChange(null),t.setDefaultsIfRequired(this._renderLayer.type),this._viz=t,t.onChange(this._vizChanged.bind(this)),this._compileShaders(t,n)}async blendToViz(e,t=400,r=Gn){try{return this._checkViz(e),e.setDefaultsIfRequired(this.metadata.geomType),this._viz&&!this._source.requiresNewMetadata(e)&&(Object.keys(this._viz.variables).map(t=>{e.variables[t]||(e.variables[t]=this._viz.variables[t])}),Object.keys(e.variables).map(i=>{this._viz.variables[i]&&e.variables[i]._blendFrom(this._viz.variables[i],t,r)}),e.color._blendFrom(this._viz.color,t,r),e.strokeColor._blendFrom(this._viz.strokeColor,t,r),e.width._blendFrom(this._viz.width,t,r),e.strokeWidth._blendFrom(this._viz.strokeWidth,t,r),e.filter._blendFrom(this._viz.filter,t,r)),this._vizChanged(e).then(()=>{this._viz&&this._viz.onChange(null),e.setDefaultsIfRequired(this._renderLayer.type),this._viz=e,this._viz.onChange(this._vizChanged.bind(this))})}catch(e){return Promise.reject(e)}}initialize(){this._isInitialized||(this._isInitialized=!0,this._renderLayer.renderer=this._integrator.renderer,this._contextInitialize(),this._renderLayer.dataframes.forEach(e=>e.bind(this._integrator.renderer)),this.requestMetadata())}async requestMetadata(e){if(e=e||this._viz)return this._source.requestMetadata(e)}async requestData(){this.metadata&&(this._source.requestData(this._getZoom(),this._getViewport()),this._fireUpdateOnNextRender=!0)}hasDataframes(){return this._renderLayer.hasDataframes()}getId(){return this._id}getSource(){return this._source}getViz(){return this._viz}getNumFeatures(){return this._renderLayer.getNumFeatures()}getIntegrator(){return this._integrator}getFeaturesAtPosition(e){return this._renderLayer.getFeaturesAtPosition(e).map(this._addLayerIdToFeature.bind(this))}$paintCallback(){this._viz&&this._viz.colorShader&&(this._renderLayer.viz=this._viz,this._integrator.renderer.renderLayer(this._renderLayer),(this._viz.isAnimated()||this._fireUpdateOnNextRender||!ke.isSetsEqual(this._oldDataframes,new Set(this._renderLayer.getActiveDataframes())))&&(this._oldDataframes=new Set(this._renderLayer.getActiveDataframes()),this._fireUpdateOnNextRender=!1,this._fire("updated")),this._isLoaded||"dataLoaded"!==this.state||(this._isLoaded=!0,this._fire("loaded")))}_fire(e,t){try{return this._emitter.emit(e,t)}catch(e){}}_onDataframeAdded(e){e.setFreeObserver(()=>{this._integrator.invalidateWebGLState(),this._integrator.needRefresh()}),this._renderLayer.addDataframe(e),this._integrator.invalidateWebGLState(),this._viz&&this._viz.setDefaultsIfRequired(e.type),this._integrator.needRefresh(),this._fireUpdateOnNextRender=!0}_onDataLoaded(){this.state="dataLoaded",this._integrator.needRefresh()}_addLayerIdToFeature(e){return e.layerId=this._id,e}_isCartoMap(e){return e instanceof Is}_isMGLMap(){return!0}_addToCartoMap(e,t){this._integrator=function(e){return Us||(Us=new $s(e)),Us}(e),this._integrator.addLayer(this,t),this._integratorCallback(this._integrator)}_addToMGLMap(e,t){const r=/Style is not done loading/;try{this._onMapLoaded(e,t)}catch(i){if(!r.test(i))throw new Error(i);e.on("load",()=>{this._onMapLoaded(e,t)})}}_onMapLoaded(e,t){this._integrator=function(e){return qs.get(e)||qs.set(e,new Vs(e)),qs.get(e)}(e),this._integrator.addLayer(this,t),this._integratorCallback(this._integrator)}_compileShaders(e,t){e.compileShaders(this._integrator.renderer.gl,t)}async _vizChanged(e){if(await this._context,!this._source)throw new Error("A source is required before changing the viz");const t=this._source,r=e.loadImages(),i=await t.requestMetadata(e);if(await r,this._source!==t)throw new Error("A source change was made before the metadata was retrieved, therefore, metadata is stale and it cannot be longer consumed");return this.metadata=i,this._compileShaders(e,this.metadata),this._integrator.needRefresh(),this.requestData()}_checkId(e){if(ke.isUndefined(e))throw new $e("layer","idRequired");if(!ke.isString(e))throw new $e("layer","idStringRequired");if(""===e)throw new $e("layer","nonValidId")}_checkSource(e){if(ke.isUndefined(e))throw new $e("layer","sourceRequired");if(!(e instanceof Xs))throw new $e("layer","nonValidSource")}_checkViz(e){if(ke.isUndefined(e))throw new $e("layer","vizRequired");if(!(e instanceof Ls))throw new $e("layer","nonValidViz");if(e._boundLayer&&e._boundLayer!==this)throw new $e("layer","sharedViz")}_getViewport(){if(this._integrator)return this._integrator.renderer.getBounds()}_getZoom(){if(this._integrator)return this._integrator.getZoomLevel()}_freeSource(){this._source&&this._source.free(),this._renderLayer.freeDataframes()}}const Ys=["featureClick","featureClickOut","featureEnter","featureHover","featureLeave"];class Zs{constructor(e,t={autoChangePointer:!0}){e instanceof Hs&&(e=[e]),function(e){if(!Array.isArray(e))throw new Error("Invalid layer list, parameter must be an array of carto.Layer objects");if(!e.length)throw new Error("Invalid argument, layer list must not be empty");if(!e.every(e=>e instanceof Hs))throw new Error("Invalid layer, layer must be an instance of carto.Layer")}(e),this._init(e,t)}on(e,t){return oe(e),this._numListeners[e]=(this._numListeners[e]||0)+1,this._emitter.on(e,t)}off(e,t){return oe(e),this._numListeners[e]=this._numListeners[e]-1,this._emitter.off(e,t)}_init(e,t){return this._emitter=Ps(),this._layerList=e,this._prevHoverFeatures=[],this._prevClickFeatures=[],this._numListeners={},Promise.all(e.map(e=>e._context)).then(()=>{!function(e){if(!e.every(t=>t.getIntegrator()===e[0].getIntegrator()))throw new Error("Invalid argument, all layers must belong to the same map")}(e),this._subscribeToIntegratorEvents(e[0].getIntegrator())}).then(()=>{t.autoChangePointer&&this._setInteractiveCursor()})}_setInteractiveCursor(){const e=this._layerList[0].getIntegrator().map;e.__carto_interacivities||(e.__carto_interacivities=new Set),this.on("featureHover",t=>{t.features.length?e.__carto_interacivities.add(this):e.__carto_interacivities.delete(this),e.getCanvas().style.cursor=e.__carto_interacivities.size>0?"pointer":""})}_subscribeToIntegratorEvents(e){e.on("mousemove",this._onMouseMove.bind(this)),e.on("click",this._onClick.bind(this))}_onMouseMove(e){if(!this._numListeners.featureEnter&&!this._numListeners.featureHover&&!this._numListeners.featureLeave)return;const t=this._createFeatureEvent(e),r=t.features,i=this._getDiffFeatures(this._prevHoverFeatures,r),n=this._getDiffFeatures(r,this._prevHoverFeatures);i.length>0&&this._fireEvent("featureLeave",{coordinates:t.coordinates,position:t.position,features:i}),n.length>0&&this._fireEvent("featureEnter",{coordinates:t.coordinates,position:t.position,features:n}),this._prevHoverFeatures=t.features,this._fireEvent("featureHover",t)}_onClick(e){if(!this._numListeners.featureClick&&!this._numListeners.featureClickOut)return;const t=this._createFeatureEvent(e),r=this._getDiffFeatures(this._prevClickFeatures,t.features);r.length>0&&this._fireEvent("featureClickOut",{coordinates:t.coordinates,position:t.position,features:r}),this._prevClickFeatures=t.features,this._fireEvent("featureClick",t)}_createFeatureEvent(e){const t=this._getFeaturesAtPosition(e.lngLat);return{coordinates:e.lngLat,position:e.point,features:t}}_fireEvent(e,t){this._emitter.emit(e,t)}_getFeaturesAtPosition(e){const t=i(e),r=ne(t.x,t.y,{scale:Pe,center:{x:0,y:0}});return[].concat(...this._layerList.map(e=>e.getFeaturesAtPosition(r)))}_getDiffFeatures(e,t){const r=this._getFeatureIDs(t);return e.filter(e=>!r.includes(e.id))}_getFeatureIDs(e){return e.map(e=>e.id)}}var Ks=r(1),Qs=r(22),Js=r(21),eo={intersect:function(e,t,r,i){const n=e,a=r,s=ce(t,e),o=ce(i,r),c=fe(s),u=fe(o),f=ue(ce(a,n),u)/ue(s,u),l=ue(ce(n,a),c)/ue(o,c);if(f>=0&&f<=1&&l>=0&&l<=1)return[n[0]+f*s[0],n[1]+f*s[1]]},sub:ce,dot:ue,perpendicular:fe};class to{constructor(){this.flat=[],this.holes=[],this.clipped=[],this.clippedType=[]}}const ro=[{inside:e=>e[0]<=1,intersect:(e,t)=>eo.intersect(e,t,[1,-100],[1,100])},{inside:e=>e[1]<=1,intersect:(e,t)=>eo.intersect(e,t,[-100,1],[100,1])},{inside:e=>e[0]>=-1,intersect:(e,t)=>eo.intersect(e,t,[-1,-100],[-1,100])},{inside:e=>e[1]>=-1,intersect:(e,t)=>eo.intersect(e,t,[-100,-1],[100,-1])}],io=ro.length;var no=r(8),ao={decodeGeom:function(e,t){if("point"===e)return{vertices:t,breakpoints:[]};if("polygon"===e)return function(e){let t=[],r=[],i=[];return e.forEach(e=>{e.forEach(e=>{const i=no(e.flat,e.holes),n=i.length;for(let a=0;a<n;a++){const n=i[a];t.push(e.flat[2*n],e.flat[2*n+1]),r.push(0,0)}const a=e.flat;for(let i=0;i<a.length-2;i+=2){if(e.holes.includes((i+2)/2))continue;const n=[a[i+0],a[i+1]],o=[a[i+2],a[i+3]];if(s=(i=i)+2,(e=e).clipped.includes(i)&&e.clipped.includes(s)&&e.clippedType[e.clipped.indexOf(i)]&e.clippedType[e.clipped.indexOf(s)])continue;let c=de(o,n);if(isNaN(c[0])||isNaN(c[1]))continue;let u=c,f=c;r.push(-u[0],-u[1]),r.push(u[0],u[1]),r.push(-f[0],-f[1]),t.push(n[0],n[1]),t.push(n[0],n[1]),t.push(o[0],o[1]),r.push(u[0],u[1]),r.push(f[0],f[1]),r.push(-f[0],-f[1]),t.push(n[0],n[1]),t.push(o[0],o[1]),t.push(o[0],o[1])}}),i.push(t.length)}),{vertices:new Float32Array(t),breakpoints:i,normals:new Float32Array(r)};var n,a,s}(t);if("line"===e)return function(e){let t=[],r=[],i=[];return e.map(e=>{e.map(e=>{for(let i=0;i<e.length-2;i+=2){const n=[e[i+0],e[i+1]],a=[e[i+2],e[i+3]],s=de(a,n);let o=s,c=s;i>0&&(o=pe([e[i-2],e[i-1]],n,a)||o),i<e.length-4&&(c=pe(n,a,[e[i+4],e[i+5]])||c),r.push(-o[0],-o[1]),r.push(o[0],o[1]),r.push(-c[0],-c[1]),t.push(n[0],n[1]),t.push(n[0],n[1]),t.push(a[0],a[1]),r.push(o[0],o[1]),r.push(c[0],c[1]),r.push(-c[0],-c[1]),t.push(n[0],n[1]),t.push(a[0],a[1]),t.push(a[0],a[1])}}),i.push(t.length)}),{vertices:new Float32Array(t),breakpoints:i,normals:new Float32Array(r)}}(t);throw new Error(`Unimplemented geometry type: '${e}'`)}};const so=32;class oo{constructor({center:e,scale:t,geom:r,properties:i,type:n,active:a,size:s,metadata:o}){this.active=a,this.center=e,this.geom=r,this.properties=i,this.scale=t,this.type=n,this.decodedGeom=ao.decodeGeom(this.type,this.geom),this.numVertex="point"===n?s:this.decodedGeom.vertices.length/2,this.numFeatures="point"===n?s:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=o,this.propertyID={},this.propertyCount=0,"polygon"===this.type?(this._aabb=[],r.forEach(e=>{const t={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY};e.forEach(e=>{const r=e.flat,i=e.holes[0]||e.flat.length/2;for(let e=0;e<i;e++)t.minx=Math.min(t.minx,r[2*e+0]),t.miny=Math.min(t.miny,r[2*e+1]),t.maxx=Math.max(t.maxx,r[2*e+0]),t.maxy=Math.max(t.maxy,r[2*e+1])}),this._aabb.push(t)})):"line"===this.type&&(this._aabb=[],r.forEach(e=>{const t={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY};e.forEach(e=>{const r=e,i=e.length;for(let e=0;e<i;e++)t.minx=Math.min(t.minx,r[2*e+0]),t.miny=Math.min(t.miny,r[2*e+1]),t.maxx=Math.max(t.maxx,r[2*e+0]),t.maxy=Math.max(t.maxy,r[2*e+1])}),this._aabb.push(t)}))}setFreeObserver(e){this.freeObserver=e}bind(e){const t=e.gl;this.renderer=e;const r=this.decodedGeom.vertices,i=this.decodedGeom.breakpoints;this.addProperties(this.properties);const n=this.renderer.RTT_WIDTH,a=Math.ceil(this.numFeatures/n);this.height=a,this.vertexBuffer=t.createBuffer(),this.featureIDBuffer=t.createBuffer(),this.texColor=this._createStyleTileTexture(this.numFeatures),this.texWidth=this._createStyleTileTexture(this.numFeatures),this.texStrokeColor=this._createStyleTileTexture(this.numFeatures),this.texStrokeWidth=this._createStyleTileTexture(this.numFeatures),this.texFilter=this._createStyleTileTexture(this.numFeatures);const s=new Float32Array(r.length);let o=0;for(let e=0;e<r.length;e+=2){if(i.length)for(;e===i[o];)o++;else e>0&&o++;s[e+0]=o%n/(n-1),s[e+1]=a>1?Math.floor(o/n)/(a-1):.5}t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.decodedGeom.normals&&(this.normalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.bufferData(t.ARRAY_BUFFER,this.decodedGeom.normals,t.STATIC_DRAW)),t.bindBuffer(t.ARRAY_BUFFER,this.featureIDBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}getFeaturesAtPosition(e,t){switch(this.type){case"point":return this._getPointsAtPosition(e,t);case"line":return this._getLinesAtPosition(e,t);case"polygon":return this._getPolygonAtPosition(e,t);default:return[]}}inViewport(e,t,r,i){const{minx:n,miny:a,maxx:s,maxy:o}=this._getBounds(t,r,i);switch(this.type){case"point":{const t=this.geom[2*e+0],r=this.geom[2*e+1];return t>n&&t<s&&r>a&&r<o}case"line":case"polygon":{const t=this._aabb[e];return!(n>t.maxx||s<t.minx||a>t.maxy||o<t.miny)}default:return!1}}_getBounds(e,t,r){return this.vertexScale=[e/r*this.scale,e*this.scale],this.vertexOffset=[e/r*(t.x-this.center.x),e*(t.y-this.center.y)],{minx:(-1+this.vertexOffset[0])/this.vertexScale[0],maxx:(1+this.vertexOffset[0])/this.vertexScale[0],miny:(-1+this.vertexOffset[1])/this.vertexScale[1],maxy:(1+this.vertexOffset[1])/this.vertexScale[1]}}_getPointsAtPosition(e,t){e=ne(e.x,e.y,{center:this.center,scale:this.scale});const r=this.decodedGeom.vertices,i=[],n=2/this.renderer.gl.canvas.clientHeight/this.scale*this.renderer._zoom,a=Object.keys(this.properties),s=t.width,o=t.strokeWidth;for(let c=0;c<r.length;c+=2){const u=c/2,f={x:r[c],y:r[c+1]},l=this._getFeature(a,u);if(this._isFeatureFiltered(l,t.filter))continue;const h=s.eval(l),d=o.eval(l),p=Math.min(h+d,126)/2*n;if(!t.symbol._default){const e=t.symbolPlacement.eval();f.x+=e[0]*p,f.y+=e[1]*p}ye(e,f,p)&&i.push(this._getUserFeature(u))}return i}_getLinesAtPosition(e,t){return this._getFeaturesFromTriangles(e,t.width,t.filter)}_getPolygonAtPosition(e,t){return this._getFeaturesFromTriangles(e,t.strokeWidth,t.filter)}_getFeaturesFromTriangles(e,t,r){const i=ne(e.x,e.y,{center:this.center,scale:this.scale}),n=this.decodedGeom.vertices,a=this.decodedGeom.normals,s=this.decodedGeom.breakpoints,o=[],c=2/this.renderer.gl.canvas.clientHeight/this.scale*this.renderer._zoom,u=Object.keys(this.properties);let f,l=-1,h=e=>{const r=Math.min(t.eval(e),336);f=r/2*c};for(let e=0;e<n.length;e+=6){if(0===e||e>=s[l]){const t=this._getFeature(u,++l);if(this._isFeatureFiltered(t,r)){e=s[l]-6;continue}h(t)}ge(i,{x:n[e+0]+a[e+0]*f,y:n[e+1]+a[e+1]*f},{x:n[e+2]+a[e+2]*f,y:n[e+3]+a[e+3]*f},{x:n[e+4]+a[e+4]*f,y:n[e+5]+a[e+5]*f})&&(o.push(this._getUserFeature(l)),e=s[l]-6)}return o}_getFeature(e,t){const r={};return e.forEach(e=>{r[e]=this.properties[e][t]}),r}_isFeatureFiltered(e,t){return t.eval(e)<.5}_getUserFeature(e){let t;const r={};return Object.keys(this.properties).map(i=>{let n=this.properties[i][e];const a=this.metadata.properties[i];a&&"category"===a.type&&(n=this.metadata.IDToCategory.get(n)),i===this.metadata.idProperty&&(t=n),r[i]=n}),{id:t,properties:r}}_addProperty(e){Object.keys(this.propertyTex).length<so&&this.getPropertyTexture(e)}getPropertyTexture(e){if(this.propertyTex[e])return this.propertyTex[e];const t=this.properties[e],r=this.renderer.gl,i=this.renderer.RTT_WIDTH,n=Math.ceil(this.numFeatures/i);return this.height=n,this.propertyTex[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.propertyTex[e]),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,i,n,0,r.ALPHA,r.FLOAT,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),this.propertyTex[e]}addProperties(e){Object.keys(e).forEach(e=>{this._addProperty(e)})}_createStyleTileTexture(e){const t=this.renderer.gl,r=this.renderer.RTT_WIDTH,i=Math.ceil(e/r),n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),n}free(){if(this.propertyTex){const e=this.renderer.gl;this.propertyTex.map(t=>e.deleteTexture(t)),e.deleteTexture(this.texColor),e.deleteTexture(this.texStrokeColor),e.deleteTexture(this.texWidth),e.deleteTexture(this.texStrokeWidth),e.deleteTexture(this.texFilter),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.featureIDBuffer)}const e=this.freeObserver;Object.keys(this).map(e=>{this[e]=null}),this.freed=!0,e&&e(this)}}class co{constructor({properties:e,featureCount:t,sample:r,geomType:i,isAggregated:n,idProperty:a}={properties:{}}){this.properties=e,this.featureCount=t,this.sample=r,this.geomType=i,this.isAggregated=n,this.idProperty=a||"cartodb_id",this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,Object.values(e).map(e=>{e.categories=e.categories||[],e.categories.map(e=>this.categorizeString(e.name))})}categorizeString(e){return void 0===e&&(e=null),this.categoryToID.has(e)?this.categoryToID.get(e):(this.categoryToID.set(e,this.numCategories),this.IDToCategory.set(this.numCategories,e),this.numCategories++,this.numCategories-1)}propertyNames(e){const t=this.properties[e];return t.aggregations?Object.keys(t.aggregations).map(e=>t.aggregations[e]):[e]}}var uo=r(20);class fo{constructor(){this._cache=uo({max:256,length:()=>1,maxAge:36e5,dispose:(e,t)=>{t.then(e=>{e.empty||e.free()})}})}get(e,t){const r=this._cache.get(e);if(r)return r;const i=t(e);return this._cache.set(e,i),i}free(){this._cache.reset()}}class lo{constructor(e){Array.isArray(e)||(e=[e]),this._templateURLs=e,this._requestGroupID=0,this._oldDataframes=[],this._cache=new fo}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t}requestData(e,t,r,i=Math.ceil){const n=ae(e,t,i);this._getTiles(n,r)}free(){this._cache.free(),this._cache=new fo,this._oldDataframes=[]}_getTiles(e,t){this._requestGroupID++;let r=[],i=e.length;const n=this._requestGroupID;e.forEach(({x:e,y:a,z:s})=>{this._cache.get(`${e},${a},${s}`,()=>this._requestDataframe(e,a,s,t)).then(e=>{e.empty?i--:r.push(e),r.length===i&&n===this._requestGroupID&&(this._oldDataframes.forEach(e=>{e.active=!1}),r.map(e=>{e.active=!0}),this._oldDataframes=r,this._dataLoadedCallback())})})}_getTileUrl(e,t,r){const i=this._getSubdomainIndex(e,t);return this._templateURLs[i].replace("{x}",e).replace("{y}",t).replace("{z}",r)}_getSubdomainIndex(e,t){return Math.abs(e+t)%this._templateURLs.length}async _requestDataframe(e,t,r,i){const n=await fetch(this._getTileUrl(e,t,r)),a=await i(n,e,t,r);return a.empty||this._addDataframe(a),a}}const ho={point:1,line:2,polygon:3},po={UNKNOWN:"unknown",POINT:"point",LINE:"line",POLYGON:"polygon"},mo={1:po.POINT,2:po.LINE,3:po.POLYGON};class go extends Xs{constructor(e,t=new co,r={layerId:void 0,viewportZoomToSourceZoom:Math.ceil,maxZoom:void 0}){super(),this._templateURL=e,t instanceof co||(t=new co(t)),this._metadata=t,this._tileClient=new lo(e),this._options=r,this._options.viewportZoomToSourceZoom=this._options.viewportZoomToSourceZoom||Math.ceil}_clone(){return new go(this._templateURL,JSON.parse(JSON.stringify(this._metadata)),this._options)}bindLayer(e,t){this._tileClient.bindLayer(e,t)}async requestMetadata(){return this._metadata}requestData(e,t){return this._tileClient.requestData(e,t,this.responseToDataframeTransformer.bind(this),e=>void 0===this._options.maxZoom?this._options.viewportZoomToSourceZoom(e):Math.min(this._options.viewportZoomToSourceZoom(e),this._options.maxZoom))}async responseToDataframeTransformer(e,t,r,i){const n=await e.arrayBuffer();if(0===n.byteLength||"null"===e)return{empty:!0};const a=new Qs.VectorTile(new Js(n));if(Object.keys(a.layers).length>1&&!this._options.layerID)throw new Error(`LayerID parameter wasn't specified and the MVT tile contains multiple layers: ${JSON.stringify(Object.keys(a.layers))}`);const s=a.layers[this._options.layerID||Object.keys(a.layers)[0]];if(!s)throw new Error(`LayerID '${this._options.layerID}' doesn't exist on the MVT tile`);const{geometries:o,properties:c,numFeatures:u}=this._decodeMVTLayer(s,this._metadata,4096),f=se(t,r,i);return this._generateDataFrame(f,o,c,u,this._metadata.geomType)}_decodeMVTLayer(e,t,r){if(!e.length)return{properties:[],geometries:{},numFeatures:0};switch(t.geomType||(t.geomType=this._autoDiscoverType(e)),t.geomType){case po.POINT:return this._decode(e,t,r,new Float32Array(2*e.length));case po.LINE:return this._decode(e,t,r,[],le);case po.POLYGON:return this._decode(e,t,r,[],he);default:throw new Error("MVT: invalid geometry type")}}_autoDiscoverType(e){switch(e.feature(0).type){case ho.point:return po.POINT;case ho.line:return po.LINE;case ho.polygon:return po.POLYGON;default:throw new Error("MVT: invalid geometry type")}}_decode(e,t,r,i,n){let a=0;const{properties:s,propertyNames:o}=this._initializePropertyArrays(t,e.length);for(let c=0;c<e.length;c++){const u=e.feature(c);this._checkType(u,t.geomType);const f=u.loadGeometry();if(n){const e=n(f,r);i.push(e)}else{const e=2*f[0][0].x/r-1,t=2*(1-f[0][0].y/r)-1;if(e<-1||e>=1||t<-1||t>=1)continue;i[2*a+0]=e,i[2*a+1]=t}if(void 0===u.properties[this._metadata.idProperty])throw new Error(`MVT feature with undefined idProperty '${this._metadata.idProperty}'`);this._decodeProperties(o,s,u,a),a++}return{properties:s,geometries:i,numFeatures:a}}_checkType(e,t){const r=mo[e.type];if(r!==t)throw new Error(`MVT: mixed geometry types in the same layer. Layer has type: ${t} but feature was ${r}`)}_initializePropertyArrays(e,t){const r={},i=[];return Object.keys(e.properties).filter(t=>"geometry"!==e.properties[t].type).forEach(t=>{i.push(...e.propertyNames(t))}),i.forEach(e=>{r[e]=new Float32Array(t+Os)}),{properties:r,propertyNames:i}}_decodeProperties(e,t,r,i){const n=e.length;for(let a=0;a<n;a++){const n=e[a];t[n][i]=this.decodeProperty(n,r.properties[n])}}decodeProperty(e,t){if("string"==typeof t)return this._metadata.categorizeString(t);if("number"==typeof t)return t;if(null===t||void 0===t)return Number.NaN;throw new Error(`MVT decoding error. Feature property value of type '${typeof t}' cannot be decoded.`)}_generateDataFrame(e,t,r,i,n){return new oo({active:!1,center:e.center,geom:t,properties:r,scale:e.scale,size:i,type:n,metadata:this._metadata})}free(){this._tileClient.free()}}class bo{constructor(e){this._onlyAggregateFilters=e.exclusive}getFilters(e){let t={},r=this._and(e).filter(Boolean);for(let e of r){let r=e.property,i=t[r];if(i){if(!this._compatibleAndFilters(i,e.filters))return{};Object.assign(i[0],e.filters[0])}else t[r]=e.filters}return t}_and(e){return e.isA(Qt)?this._and(e.a).concat(this._and(e.b)).filter(Boolean):[this._or(e)].filter(Boolean)}_or(e){if(e.isA(Kt)){let t=this._basicCondition(e.a),r=this._basicCondition(e.b);if(t&&r&&t.property===r.property)return t.filters=t.filters.concat(r.filters),t}return this._basicCondition(e)}_removeBlend(e){return e.isA(Jt)&&e.originalMix.isA(Dt)?e.b:e}_basicCondition(e){return e=this._removeBlend(e),this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._in(e)||this._notIn(e)}_value(e){if((e=this._removeBlend(e)).isA(br)||e.isA(cr)||e.isA(tr))return e.expr}_between(e){if(e.isA(Lt)){let t=this._aggregation(e.value),r=t&&this._value(e.lowerLimit),i=t&&r&&this._value(e.upperLimit);if(i)return t.filters.push({greater_than_or_equal_to:r,less_than_or_equal_to:i}),t}}_in(e){if(e.isA(Ft)){let t=this._aggregation(e.value),r=e.list.elems.map(e=>this._value(e)).filter(e=>null!==e);if(t&&r.length>0&&r.length===e.list.elems.length)return t.filters.push({in:r}),t}}_notIn(e){if(e.isA(Mt)){let t=this._aggregation(e.value),r=e.list.elems.map(e=>this._value(e)).filter(e=>null!==e);if(t&&r.length>0&&r.length===e.list.elems.length)return t.filters.push({not_in:r}),t}}_equals(e){return this._cmpOp(e,Yt,"equal")}_notEquals(e){return this._cmpOp(e,Zt,"not_equal")}_lessThan(e){return this._cmpOp(e,Xt,"less_than","greater_than")}_lessThanOrEqualTo(e){return this._cmpOp(e,Ht,"less_than_or_equal_to","greater_than_or_equal_to")}_greaterThan(e){return this._cmpOp(e,Wt,"greater_than","less_than")}_greaterThanOrEqualTo(e){return this._cmpOp(e,jt,"greater_than_or_equal_to","less_than_or_equal_to")}_aggregation(e){if((e=this._removeBlend(e)).isA(ir)||e.isA(nr)||e.isA(ar)||e.isA(sr)||e.isA(or)){let t=this._property(e.property);if(t)return t.property=We.aggColumn(t.property,e.aggName),t}if(!this._onlyAggregateFilters)return this._property(e)}_property(e){if((e=this._removeBlend(e)).isA(rr))return{property:e.name,filters:[]}}_cmpOp(e,t,r,i){if(i=i||r,e.isA(t)){let t=this._aggregation(e.a),n=t&&this._value(e.b),a=r;if(n||(n=(t=this._aggregation(e.b))&&this._value(e.a),a=i),n){let e={};return e[a]=n,t.filters.push(e),t}}}_compatibleAndFilters(e,t){if(0===e.length||0===t.length)return!0;if(1===e.length&&1===t.length){const r=e[0],i=t[0];if(1===Object.keys(r).length&&1===Object.keys(i).length){const e=Object.keys(r)[0],t=Object.keys(i)[0],n=["less_than","less_than_or_equal_to"],a=["greater_than","greater_than_or_equal_to"];return n.includes(e)&&a.includes(t)||n.includes(t)&&a.includes(e)}}return!1}}class _o{getFilter(e){return this._filter(e)}_filter(e){return this._and(e)||this._or(e)||this._in(e)||this._notIn(e)||this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._blend(e)||null}_and(e){if(e.isA(Qt)){const t=[this._filter(e.a),this._filter(e.b)].filter(Boolean).reduce((e,t)=>e.concat(t),[]);if(t.length)return 1===t.length?t[0]:{type:"and",left:t[0],right:t[1]}}}_or(e){if(e.isA(Kt)){let t=this._filter(e.a),r=this._filter(e.b);if(t&&r)return{type:"or",left:t,right:r}}}_lessThan(e){return this._cmpOp(e,Xt,"lessThan")}_lessThanOrEqualTo(e){return this._cmpOp(e,Ht,"lessThanOrEqualTo")}_greaterThan(e){return this._cmpOp(e,Wt,"greaterThan")}_greaterThanOrEqualTo(e){return this._cmpOp(e,jt,"greaterThanOrEqualTo")}_equals(e){return this._cmpOp(e,Yt,"equals")}_notEquals(e){return this._cmpOp(e,Zt,"notEquals")}_cmpOp(e,t,r){if(e.isA(t)){let t=this._property(e.a)||this._value(e.a),i=this._property(e.b)||this._value(e.b);if(t&&i)return{type:r,left:t,right:i}}}_blend(e){if(e.isA(Jt)&&e.originalMix.isA(Dt))return this._filter(e.b)}_property(e){if(e.isA(rr))return{type:"property",property:e.name}}_value(e){if(e.isA(br)||e.isA(cr)||e.isA(tr))return{type:"value",value:e.expr}}_in(e){if(e.isA(Ft)){let t=this._property(e.value),r=e.list.elems.map(e=>this._value(e));if(t&&r.length>0&&r.length===e.list.elems.length)return{type:"in",property:t.property,values:r.map(e=>e.value)}}}_notIn(e){if(e.isA(Mt)){let t=this._property(e.value),r=e.list.elems.map(e=>this._value(e));if(t&&r.length>0&&r.length===e.list.elems.length)return{type:"notIn",property:t.property,values:r.map(e=>e.value)}}}_between(e){if(e.isA(Lt)){let t=this._property(e.value),r=this._value(e.lowerLimit),i=this._value(e.upperLimit);if(t&&r&&i)return{type:"between",property:t.property,lower:r.value,upper:i.value}}}}const yo={and:e=>Ee(" AND ",e.left,e.right),or:e=>Ee(" OR ",e.left,e.right),between:e=>`${we(e.property)} BETWEEN ${xe(e.lower)} AND ${xe(e.upper)}`,in:e=>`${we(e.property)} IN (${Ee(",",...e.values)})`,notIn:e=>`${we(e.property)} NOT IN (${Ee(",",...e.values)})`,equals:e=>Ee(" = ",e.left,e.right),notEquals:e=>Ee(" <> ",e.left,e.right),lessThan:e=>Ee(" < ",e.left,e.right),lessThanOrEqualTo:e=>Ee(" <= ",e.left,e.right),greaterThan:e=>Ee(" > ",e.left,e.right),greaterThanOrEqualTo:e=>Ee(" >= ",e.left,e.right),property:e=>we(e.property),value:e=>xe(e.value)},vo=1e3,xo=2e6,wo=2048;class Eo{constructor(e){this._source=e,this._exclusive=!0,this._MNS=null,this._promiseMNS=null,this.inProgressInstantiations={}}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t,this._mvtClient.bindLayer(e,t)}_getInstantiationID(e,t,r,i){return JSON.stringify({MNS:e,resolution:t,filtering:i.backendFilters?r:null,options:i})}async getMetadata(e){const t=e.getMinimumNeededSchema();this._checkAcceptableMNS(t);const r=e.resolution,i=Te(e,{exclusive:this._exclusive});if(t.columns.includes("cartodb_id")||t.columns.push("cartodb_id"),this._needToInstantiate(t,r,i)){const e=await this._repeatableInstantiate(t,r,i);this._updateStateAfterInstantiating(e)}return this.metadata}requiresNewMetadata(e){const t=e.getMinimumNeededSchema();this._checkAcceptableMNS(t);const r=e.resolution,i=Te(e,{exclusive:this._exclusive});return t.columns.includes("cartodb_id")||t.columns.push("cartodb_id"),this._needToInstantiate(t,r,i)}_checkAcceptableMNS(e){const t={};e.columns.map(e=>{const r=je.column.getBase(e),i=je.column.isAggregated(e);if(void 0===t[r])t[r]=i;else if(t[r]!==i)throw new Error(`Incompatible combination of cluster aggregation with un-aggregated property: '${r}'`)})}getData(e,t){if(this._mvtClient)return this._mvtClient.requestData(e,t)}_needToInstantiate(e,t,r){return!je.equals(this._MNS,e)||t!==this.resolution||JSON.stringify(r)!==JSON.stringify(this.filtering)&&this.metadata.featureCount>xo}_isInstantiated(){return!!this.metadata}_intantiationChoices(e){let t={backendFilters:!0};return e&&e.featureCount>=0&&(t.backendFilters=e.featureCount>xo||!e.backendFiltersApplied),t}async _instantiateUncached(e,t,r,i={backendFilters:!0},n=null){const a=this._getConfig(),s=await this._generateAggregation(e,t);let o=this._buildSelectClause(e),c=this._buildQuery(o);const u=`(${c}) AS tmp`;let f=i.backendFilters?r:null,l=!1;var h;if(f&&this._requiresAggregation(e)&&(s.filters=(h=f)&&h.aggregation,s.filters&&(l=!0),this._exclusive||(f=null)),f){const e=this._buildQuery(o,f);l=l||e!==c,c=e}let{url:d,metadata:p}=await this._getInstantiationPromise(u,a,s,c,o,n);return p.backendFiltersApplied=l,{MNS:e,resolution:t,filters:r,metadata:p,urlTemplate:d}}_updateStateAfterInstantiating({MNS:e,resolution:t,filters:r,metadata:i,urlTemplate:n}){this._mvtClient&&this._mvtClient.free(),this._mvtClient=new go(this._URLTemplates),this._mvtClient.bindLayer(this._addDataframe,this._dataLoadedCallback),this._mvtClient.decodeProperty=((e,t)=>{const r=je.column.getBase(e),i=this.metadata.properties[r];if(i)switch(i.type){case"date":{const e=new Date;e.setTime(1e3*t);const r=i.min;return(e-r)/(i.max.getTime()-r.getTime())}case"category":return this.metadata.categorizeString(t);case"number":return t;default:throw new Error(`Windshaft MVT decoding error. Feature property value of type '${typeof t}' cannot be decoded.`)}}),this.urlTemplate=n,this.metadata=i,this._mvtClient._metadata=i,this._MNS=e,this.filtering=r,this.resolution=t,this._checkLayerMeta(e)}async _instantiate(e,t,r,i,n){if(this.inProgressInstantiations[this._getInstantiationID(e,t,r,i)])return this.inProgressInstantiations[this._getInstantiationID(e,t,r,i)];const a=this._instantiateUncached(e,t,r,i,n);return this.inProgressInstantiations[this._getInstantiationID(e,t,r,i)]=a,a}async _repeatableInstantiate(e,t,r){let i=null;return async function(e,t,r){let i=r(e),n=t(await i);return JSON.stringify(e)===JSON.stringify(n)?i:r(n)}(this._intantiationChoices(this.metadata),e=>(i=e.metadata,this._intantiationChoices(e.metadata)),n=>this._instantiate(e,t,r,n,i))}_checkLayerMeta(e){if(!this._isAggregated()&&this._requiresAggregation(e))throw new Error("Aggregation not supported for this dataset")}_isAggregated(){return this.metadata&&this.metadata.isAggregated}_requiresAggregation(e){return e.columns.some(e=>je.column.isAggregated(e))}_generateAggregation(e,t){let r={columns:{},dimensions:{},placement:"centroid",resolution:t,threshold:1};return e.columns.forEach(e=>{"cartodb_id"!==e&&(je.column.isAggregated(e)?r.columns[e]={aggregate_function:je.column.getAggFN(e),aggregated_column:je.column.getBase(e)}:r.dimensions[e]=e)}),r}_buildSelectClause(e){const t=e.columns.map(e=>je.column.getBase(e)).concat(["the_geom","the_geom_webmercator","cartodb_id"]);return t.filter((e,r)=>t.indexOf(e)===r)}_buildQuery(e,t){return`SELECT ${e.join()} FROM ${this._source._query?`(${this._source._query}) as _cdb_query_wrapper`:this._source._tableName} ${t?function(e){let t;return(e=e&&e.preaggregation)&&Object.keys(e).length>0&&(t=ve(e)),t?"WHERE "+t:""}(t):""}`}_getConfig(){return{apiKey:this._source._apiKey,username:this._source._username,serverURL:this._source._serverURL}}free(){this._mvtClient&&this._mvtClient.free()}async _getInstantiationPromise(e,t,r,i,n,a=null){const s={buffersize:{mvt:1},layers:[{type:"mapnik",options:{sql:i,aggregation:r,dates_as_numbers:!0}}]};if(!a){const e=["the_geom","the_geom_webmercator"],t=n.filter(t=>!e.includes(t));s.layers[0].options.metadata={geometryType:!0,columnStats:{topCategories:32768,includeNulls:!0},sample:{num_rows:vo,include_columns:t}}}const o=await fetch(function(e,t){const r=JSON.stringify(t),i=Ae("api_key",e.apiKey),n=Ae("client",`vl-${Ks.a}`),a=[i,n,Ae("config",r)],s=Ce(Se(e),a);return s.length<wo?new Request(s,{method:"GET",headers:{Accept:"application/json"}}):new Request(Ce(Se(e),[i,n]),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:r})}(t,s)),c=await o.json();if(!o.ok)throw new Error(`Maps API error: ${JSON.stringify(c)}`);return this._URLTemplates=c.metadata.tilejson.vector.tiles,{url:function(e,t,r){const i=[Ae("api_key",r.apiKey)];if(e.cdn_url&&e.cdn_url.templates)return Ce(`${e.cdn_url.templates.https.url}/${r.username}/api/v1/map/${e.layergroupid}/${t}/{z}/{x}/{y}.mvt`,i);return Ce(Se(r,`/${e.layergroupid}/${t}/{z}/{x}/{y}.mvt`),i)}(c,0,t),metadata:a||this._adaptMetadata(c.metadata.layers[0].meta,r)}}_adaptMetadata(e,t){e.datesAsNumbers=e.dates_as_numbers;const{stats:r,aggregation:i,datesAsNumbers:n}=e,a=r.hasOwnProperty("featureCount")?r.featureCount:r.estimatedFeatureCount,s=function(e){switch(e){case"ST_MultiPolygon":case"ST_Polygon":return"polygon";case"ST_Point":return"point";case"ST_MultiLineString":case"ST_LineString":return"line";default:throw new Error(`Unimplemented geometry type ''${e}'`)}}(r.geometryType),o=r.columns;var c;Object.keys(t.columns).forEach(e=>{const t=je.column.getBase(e),r=je.column.getAggFN(e);o[t].aggregations||(o[t].aggregations={}),o[t].aggregations[r]=e}),Object.values(o).map(e=>{e.type="string"===(c=e.type)?"category":c}),Object.keys(o).forEach(e=>{const t=o[e];"category"===t.type&&t.categories?t.categories.forEach(e=>{e.name=e.category,delete e.category}):n&&n.includes(e)&&(t.type="date",["min","max","avg"].map(e=>{t[e]&&(t[e]=new Ur(1e3*t[e]).value)}))});return new co({properties:o,featureCount:a,sample:r.sample,geomType:s,isAggregated:i.mvt,idProperty:"cartodb_id"})}}const To="https://{user}.carto.com";class Ao extends Xs{constructor(){super(),this._client=new Eo(this)}initialize(e,t){this._auth=e||ze,this._config=t||qe,u(this._auth),l(this._config),this._apiKey=this._auth.apiKey,this._username=this._auth.username,this._serverURL=this._generateURL(this._auth,this._config)}bindLayer(...e){this._client.bindLayer(...e)}requiresNewMetadata(e){return this._client.requiresNewMetadata(e)}requestMetadata(e){return this._client.getMetadata(e)}requestData(e,t){return this._client.getData(e,t)}free(){this._client.free()}_generateURL(e,t){let r=t&&t.serverURL||To;return r=r.replace(/{user}/,e.username)}}class Co extends Ao{constructor(e,t,r){super(),this._checkTableName(e),this._tableName=e,this.initialize(t,r)}_clone(){return new Co(this._tableName,this._auth,this._config)}_checkTableName(e){if(ke.isUndefined(e))throw new $e("source","tableNameRequired");if(!ke.isString(e))throw new $e("source","tableNameStringRequired");if(""===e)throw new $e("source","nonValidTableName")}}const So=1e3;class Ro extends Xs{constructor(e,t={}){if(super(),this._checkData(e),this._type="",this._categoryStringToIDMap={},this._numCategories=0,this._numFields=new Set,this._catFields=new Set,this._dateFields=new Set,this._providedDateColumns=new Set(t.dateColumns),this._properties={},this._boundColumns=new Set,this._data=e,"FeatureCollection"===e.type)this._features=e.features;else{if("Feature"!==e.type)throw new $e("source","nonValidGeoJSONData");this._features=[e]}}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t}requestMetadata(e){return Promise.resolve(this._computeMetadata(e))}requestData(){if(this._dataframe){const e=this._decodeUnboundProperties();return this._dataframe.addProperties(e),void Object.keys(e).forEach(e=>{this._boundColumns.add(e)})}const e=new oo({active:!0,center:{x:0,y:0},geom:this._decodeGeometry(),properties:this._decodeUnboundProperties(),scale:1,size:this._features.length,type:this._getDataframeType(this._type),metadata:this._metadata});this._boundColumns=new Set(Object.keys(e.properties)),this._dataframe=e,this._addDataframe(e),this._dataLoadedCallback()}requiresNewMetadata(){return!1}_clone(){return new Ro(this._data,{dateColumns:Array.from(this._providedDateColumns)})}_checkData(e){if(ke.isUndefined(e))throw new $e("source","dataRequired");if(!ke.isObject(e))throw new $e("source","dataObjectRequired")}_computeMetadata(e){const t=[];this._addNumericColumnField("cartodb_id");const r=this._features.length,i=new Set(e.getMinimumNeededSchema().columns);for(let e=0;e<this._features.length;e++){const r=this._features[e].properties,n=Object.keys(r);for(let e=0,t=n.length;e<t;e++){const t=n[e];i.has(t)&&!this._boundColumns.has(t)&&this._addPropertyToMetadata(t,r[t])}this._sampleFeatureOnMetadata(r,t,this._features.length)}this._numFields.forEach(e=>{const t=this._properties[e];t.avg=t.sum/t.count});let n="";r>0&&(n=this._getDataframeType(this._features[0].geometry.type));return this._metadata=new co({properties:this._properties,featureCount:r,sample:t,geomType:n,idProperty:"cartodb_id"}),this._metadata}_sampleFeatureOnMetadata(e,t,r){if(r>So){const e=So/r;if(Math.random()>e)return}t.push(e)}_addNumericPropertyToMetadata(e,t){if(this._catFields.has(e)||this._dateFields.has(e))throw new Error(`Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._addNumericColumnField(e);const r=this._properties[e];r.min=Math.min(r.min,t),r.max=Math.max(r.max,t),r.sum+=t}_addNumericColumnField(e){this._numFields.has(e)||(this._numFields.add(e),this._properties[e]={type:"number",min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,avg:Number.NaN,sum:0,count:0})}_addDatePropertyToMetadata(e,t){if(this._catFields.has(e)||this._numFields.has(e))throw new Error(`Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._addDateColumnField(e);const r=this._properties[e],i=ke.castDate(t);r.min=r.min?ke.castDate(Math.min(r.min,i)):i,r.max=r.max?ke.castDate(Math.max(r.max,i)):i,r.sum+=t,r.count++}_addDateColumnField(e){this._dateFields.has(e)||(this._dateFields.add(e),this._properties[e]={type:"date",min:null,max:null,avg:null,sum:0,count:0})}_addPropertyToMetadata(e,t){return this._providedDateColumns.has(e)?this._addDatePropertyToMetadata(e,t):Number.isFinite(t)?this._addNumericPropertyToMetadata(e,t):void this._addCategoryPropertyToMetadata(e,t)}_addCategoryPropertyToMetadata(e,t){if(this._numFields.has(e)||this._dateFields.has(e))throw new Error(`Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._catFields.has(e)||(this._catFields.add(e),this._properties[e]={type:"category",categories:[]});const r=this._properties[e],i=r.categories.find(e=>e.name===t);i?i.frequency++:r.categories.push({name:t,frequency:1})}_decodeUnboundProperties(){const e={};[...this._numFields].concat([...this._catFields]).concat([...this._dateFields]).map(t=>{this._boundColumns.has(t)||(e[t]=new Float32Array(this._features.length+1024))});const t=[...this._catFields].filter(e=>!this._boundColumns.has(e)),r=[...this._numFields].filter(e=>!this._boundColumns.has(e)),i=[...this._dateFields].filter(e=>!this._boundColumns.has(e));for(let n=0;n<this._features.length;n++){const a=this._features[n];t.forEach(t=>{e[t][n]=this._getCategoryIDFromString(a.properties[t])}),r.forEach(t=>{"cartodb_id"!==t||Number.isFinite(a.properties.cartodb_id)||(a.properties.cartodb_id=-n),e[t][n]=Number(a.properties[t])}),i.forEach(t=>{const r=this._properties[t],i=ke.castDate(a.properties[t]).getTime(),s=r.min,o=r.max,c=(i-s.getTime())/(o.getTime()-s.getTime());e[t][n]=c})}return e}_getCategoryIDFromString(e){return void 0!==this._categoryStringToIDMap[e]?this._categoryStringToIDMap[e]:(this._categoryStringToIDMap[e]=this._numCategories,this._numCategories++,this._categoryStringToIDMap[e])}_getDataframeType(e){switch(e){case"Point":return"point";case"LineString":case"MultiLineString":return"line";case"Polygon":case"MultiPolygon":return"polygon";default:return""}}_decodeGeometry(){let e=null;const t=this._features.length;for(let r=0;r<t;r++){const i=this._features[r];if("Feature"===i.type){const n=i.geometry.type,a=i.geometry.coordinates;if(this._type){if(this._type!==n)throw new $e("source",`multipleFeatureTypes[${this._type}, ${n}]`)}else this._type=n;if("Point"===n){e||(e=new Float32Array(2*t));const i=this._computePointGeometry(a);e[2*r+0]=i.x,e[2*r+1]=i.y}else if("LineString"===n){e||(e=[]);const t=this._computeLineStringGeometry(a);e.push([t])}else if("MultiLineString"===n){e||(e=[]);const t=this._computeMultiLineStringGeometry(a);e.push(t)}else if("Polygon"===n){e||(e=[]);const t=this._computePolygonGeometry(a);e.push([t])}else if("MultiPolygon"===n){e||(e=[]);const t=this._computeMultiPolygonGeometry(a);e.push(t)}}}return e}_computePointGeometry(e){const t=ke.projectToWebMercator({lat:e[1],lng:e[0]});return ne(t.x,t.y,{scale:ke.WM_R,center:{x:0,y:0}})}_computeLineStringGeometry(e){let t=[];for(let r=0;r<e.length;r++){const i=this._computePointGeometry(e[r]);t.push(i.x,i.y)}return t}_computeMultiLineStringGeometry(e){let t=[];for(let r=0;r<e.length;r++){let i=this._computeLineStringGeometry(e[r]);i.length>0&&t.push(i)}return t}_computePolygonGeometry(e){let t={flat:[],holes:[],clipped:[]},r=0;for(let i=0;i<e.length;i++){for(let r=0;r<e[i].length;r++){const n=this._computePointGeometry(e[i][r]);t.flat.push(n.x,n.y)}if(!this._isClockWise(e[i])){if(!(i>0))throw new $e("source","firstPolygonExternal");t.holes.push(r+=e[i-1].length)}}return t}_computeMultiPolygonGeometry(e){let t=[];for(let r=0;r<e.length;r++){let i=this._computePolygonGeometry(e[r]);i.flat.length>0&&t.push(i)}return t}_isClockWise(e){let t,r=0,i=e[0];for(let n=0;n<e.length-1;n++)r+=((t=e[n+1])[1]-i[1])*(t[0]+i[0]),i=t;return r>=0}free(){}}class Do extends Ao{constructor(e,t,r){super(),this._checkQuery(e),this._query=e,this.initialize(t,r)}_clone(){return new Do(this._query,this._auth,this._config)}_checkQuery(e){if(ke.isUndefined(e))throw new $e("source","queryRequired");if(!ke.isString(e))throw new $e("source","queryStringRequired");if(""===e)throw new $e("source","nonValidQuery");if(!e.match(/\bSELECT\b/i))throw new $e("source","nonValidSQLQuery")}}r.d(t,"source",function(){return Fo}),r.d(t,"version",function(){return Ks.a}),r.d(t,"setDefaultAuth",function(){return c}),r.d(t,"setDefaultConfig",function(){return f}),r.d(t,"expressions",function(){return Me}),r.d(t,"Layer",function(){return Hs}),r.d(t,"Viz",function(){return Ls}),r.d(t,"Map",function(){return Is}),r.d(t,"Interactivity",function(){return Zs});const Fo={Dataset:Co,SQL:Do,GeoJSON:Ro,MVT:go}},function(e){function t(e){var r=this;if(r instanceof t||(r=new t),r.tail=null,r.head=null,r.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){r.push(e)});else if(arguments.length>0)for(var i=0,n=arguments.length;i<n;i++)r.push(arguments[i]);return r}function r(e,t,i,n){if(!(this instanceof r))return new r(e,t,i,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}e.exports=t,t.Node=r,t.create=t,t.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null},t.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},t.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},t.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)(i=this).tail=new r(arguments[e],i.tail,null,i),i.head||(i.head=i.tail),i.length++;var i;return this.length},t.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)(i=this).head=new r(arguments[e],null,i.head,i),i.tail||(i.tail=i.head),i.length++;var i;return this.length},t.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},t.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},t.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,i=0;null!==r;i++)e.call(t,r.value,i,this),r=r.next},t.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,i=this.length-1;null!==r;i--)e.call(t,r.value,i,this),r=r.prev},t.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},t.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},t.prototype.map=function(e,r){r=r||this;for(var i=new t,n=this.head;null!==n;)i.push(e.call(r,n.value,this)),n=n.next;return i},t.prototype.mapReverse=function(e,r){r=r||this;for(var i=new t,n=this.tail;null!==n;)i.push(e.call(r,n.value,this)),n=n.prev;return i},t.prototype.reduce=function(e,t){var r,i=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");i=this.head.next,r=this.head.value}for(var n=0;null!==i;n++)r=e(r,i.value,n),i=i.next;return r},t.prototype.reduceReverse=function(e,t){var r,i=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");i=this.tail.prev,r=this.tail.value}for(var n=this.length-1;null!==i;n--)r=e(r,i.value,n),i=i.prev;return r},t.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},t.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},t.prototype.slice=function(e,r){(r=r||this.length)<0&&(r+=this.length),(e=e||0)<0&&(e+=this.length);var i=new t;if(r<e||r<0)return i;e<0&&(e=0),r>this.length&&(r=this.length);for(var n=0,a=this.head;null!==a&&n<e;n++)a=a.next;for(;null!==a&&n<r;n++,a=a.next)i.push(a.value);return i},t.prototype.sliceReverse=function(e,r){(r=r||this.length)<0&&(r+=this.length),(e=e||0)<0&&(e+=this.length);var i=new t;if(r<e||r<0)return i;e<0&&(e=0),r>this.length&&(r=this.length);for(var n=this.length,a=this.tail;null!==a&&n>r;n--)a=a.prev;for(;null!==a&&n>e;n--,a=a.prev)i.push(a.value);return i},t.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var i=r.prev;r.prev=r.next,r.next=i}return this.head=t,this.tail=e,this}},function(e){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(e,t,r){(function(e,i){function n(e,r){var i={seen:[],stylize:s};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),l(r)?i.showHidden=r:r&&t._extend(i,r),m(i.showHidden)&&(i.showHidden=!1),m(i.depth)&&(i.depth=2),m(i.colors)&&(i.colors=!1),m(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=a),o(i,e,i.depth)}function a(e,t){var r=n.styles[t];return r?"["+n.colors[r][0]+"m"+e+"["+n.colors[r][1]+"m":e}function s(e){return e}function o(e,r,i){if(e.customInspect&&r&&v(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(i,e);return p(n)||(n=o(e,n,i)),n}var a=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(p(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(d(t))return e.stylize(""+t,"number");if(l(t))return e.stylize(""+t,"boolean");if(h(t))return e.stylize("null","null")}(e,r);if(a)return a;var s=Object.keys(r),b=function(e){var t={};return e.forEach(function(e){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),y(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(r);if(0===s.length){if(v(r))return e.stylize("[Function"+(r.name?": "+r.name:"")+"]","special");if(g(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(_(r))return e.stylize(Date.prototype.toString.call(r),"date");if(y(r))return c(r)}var x,E="",T=!1,A=["{","}"];(f(r)&&(T=!0,A=["[","]"]),v(r))&&(E=" [Function"+(r.name?": "+r.name:"")+"]");return g(r)&&(E=" "+RegExp.prototype.toString.call(r)),_(r)&&(E=" "+Date.prototype.toUTCString.call(r)),y(r)&&(E=" "+c(r)),0!==s.length||T&&0!=r.length?i<0?g(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),x=T?function(e,t,r,i,n){for(var a=[],s=0,o=t.length;s<o;++s)w(t,String(s))?a.push(u(e,t,r,i,String(s),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(u(e,t,r,i,n,!0))}),a}(e,r,i,b,s):s.map(function(t){return u(e,r,i,b,t,T)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(x,E,A)):A[0]+E+A[1]}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function u(e,t,r,i,n,a){var s,c,u;if((u=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?c=e.stylize(u.set?"[Getter/Setter]":"[Getter]","special"):u.set&&(c=e.stylize("[Setter]","special")),w(i,n)||(s="["+n+"]"),c||(e.seen.indexOf(u.value)<0?(c=h(r)?o(e,u.value,null):o(e,u.value,r-1)).indexOf("\n")>-1&&(c=a?c.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+c.split("\n").map(function(e){return"   "+e}).join("\n")):c=e.stylize("[Circular]","special")),m(s)){if(a&&n.match(/^\d+$/))return c;(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+c}function f(e){return Array.isArray(e)}function l(e){return"boolean"==typeof e}function h(e){return null===e}function d(e){return"number"==typeof e}function p(e){return"string"==typeof e}function m(e){return void 0===e}function g(e){return b(e)&&"[object RegExp]"===x(e)}function b(e){return"object"==typeof e&&null!==e}function _(e){return b(e)&&"[object Date]"===x(e)}function y(e){return b(e)&&("[object Error]"===x(e)||e instanceof Error)}function v(e){return"function"==typeof e}function x(e){return Object.prototype.toString.call(e)}function w(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var E=/%[sdj%]/g;t.format=function(e){if(!p(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(n(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,a=i.length,s=String(e).replace(E,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}}),o=i[r];r<a;o=i[++r])h(o)||!b(o)?s+=" "+o:s+=" "+n(o);return s},t.deprecate=function(r,n){if(m(e.process))return function(){return t.deprecate(r,n).apply(this,arguments)};if(!0===i.noDeprecation)return r;var a=!1;return function(){if(!a){if(i.throwDeprecation)throw new Error(n);a=!0}return r.apply(this,arguments)}};var T,A={};t.debuglog=function(e){if(m(T)&&(T=i.env.NODE_DEBUG||""),e=e.toUpperCase(),!A[e])if(new RegExp("\\b"+e+"\\b","i").test(T)){A[e]=function(){t.format.apply(t,arguments)}}else A[e]=function(){};return A[e]},t.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=l,t.isNull=h,t.isNullOrUndefined=function(e){return null==e},t.isNumber=d,t.isString=p,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=g,t.isObject=b,t.isDate=_,t.isError=y,t.isFunction=v,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(44);t.log=function(){},t.inherits=r(43),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}}).call(this,r(45),r(5))},function(e){function t(e){if(!(this instanceof t))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof t||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function r(e,t){return e===t||e!=e&&t!=t}function i(e,t){for(var i=0,a="_"+t,s=a;n.call(e,s);s=a+i++)if(r(e[s].key,t))return e[s]}var n=Object.prototype.hasOwnProperty;e.exports=t,t.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(r){"size"!==r&&e.call(t,this._data[r].value,this._data[r].key)},this)},t.prototype.has=function(e){return!!i(this._data,e)},t.prototype.get=function(e){var t=i(this._data,e);return t&&t.value},t.prototype.set=function(e,t){!function(e,t,i){for(var a=0,s="_"+t,o=s;n.call(e,o);o=s+a++)if(r(e[o].key,t))return void(e[o].value=i);e.size++,e[o]=new function(e,t,r){this.key=e,this.value=t,this._index=r}(t,i,o)}(this._data,e,t)},t.prototype.delete=function(e){var t=i(this._data,e);t&&(delete this._data[t._index],this._data.size--)},t.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(t.prototype,"size",{get:function(){return this._data.size},set:function(){},enumerable:!0,configurable:!0}),t.prototype.values=t.prototype.keys=t.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,r){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),e.exports="function"!=typeof Map||t.env.TEST_PSEUDOMAP?r(47):Map}).call(this,r(5))},function(e,t){t.read=function(e,t,r,i,n){var a,s,o=8*n-i-1,c=(1<<o)-1,u=c>>1,f=-7,l=r?n-1:0,h=r?-1:1,d=e[t+l];for(l+=h,a=d&(1<<-f)-1,d>>=-f,f+=o;f>0;a=256*a+e[t+l],l+=h,f-=8);for(s=a&(1<<-f)-1,a>>=-f,f+=i;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===a)a=1-u;else{if(a===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),a-=u}return(d?-1:1)*s*Math.pow(2,a-i)},t.write=function(e,t,r,i,n,a){var s,o,c,u=8*a-n-1,f=(1<<u)-1,l=f>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?h/c:h*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=f?(o=0,s=f):s+l>=1?(o=(t*c-1)*Math.pow(2,n),s+=l):(o=t*Math.pow(2,l-1)*Math.pow(2,n),s=0));n>=8;e[r+d]=255&o,d+=p,o/=256,n-=8);for(s=s<<n|o,u+=n;u>0;e[r+d]=255&s,d+=p,s/=256,u-=8);e[r+d-p]|=128*m}},function(e){"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),n=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-i*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},function(e,t,r){"use strict";function i(e,t,r){if(3===e){var i=new n(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}var n=r(7);e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},function(e,t,r){var i,n;void 0===(n="function"==typeof(i={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}})?i.call(t,r,t,e):i)||(e.exports=n)},function(e,t,r){e.exports=r(52)},function(e,t,r){var i,n;!function(){var a={Burg:{2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},BurgYl:{2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},RedOr:{2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},OrYel:{2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Peach:{2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},PinkYl:{2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Mint:{2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},BluGrn:{2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},DarkMint:{2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Emrld:{2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},ag_GrnYl:{2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},BluYl:{2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Teal:{2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},TealGrn:{2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Purp:{2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},PurpOr:{3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Sunset:{2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Magenta:{2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},SunsetDark:{2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},ag_Sunset:{2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},BrwnYl:{2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},ArmyRose:{2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Fall:{2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Geyser:{2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Temps:{2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},TealRose:{2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},Tropic:{2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Earth:{2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},Antique:{2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Bold:{2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Pastel:{2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Prism:{2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Safe:{2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Vivid:{2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]}},s={Blues:{tags:["quantitative"]},BrBG:{tags:["diverging"]},Greys:{tags:["quantitative"]},PiYG:{tags:["diverging"]},PRGn:{tags:["diverging"]},Purples:{tags:["quantitative"]},RdYlGn:{tags:["diverging"]},Spectral:{tags:["diverging"]},YlOrBr:{tags:["quantitative"]},YlGn:{tags:["quantitative"]},YlGnBu:{tags:["quantitative"]},YlOrRd:{tags:["quantitative"]}},o=r(53);for(var c in o){var u=o[c],f={};for(var l in u)f[l]=u[l];c in s&&(f.tags=s[c].tags),a["cb_"+c]=f}void 0===(n="function"==typeof(i=a)?i.call(t,r,t,e):i)||(e.exports=n)}()}])});